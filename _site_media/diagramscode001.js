var Earray=function(){},EarrayProt=function(){this.foreach=function(a){for(var b=0;b<this.length;b++)a.call(this[b])};this.remove=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)break;if(b===this.length-1)this.pop();else this[b]=this.pop()};this.removeAt=function(a){if(a>=this.length-1)this.pop();else this[a]=this.pop()}};EarrayProt.prototype=[];Earray.prototype=new EarrayProt;
var genericgui={getParams:function(){for(var a=arguments.length,b="",c=0;c<a;c++){var d=arguments[c];if(c!==0)b+=",";if(typeof d===Number)b+=""+d+"";else if(typeof d!=="object")b+="'"+d+"'"}return b},createNewDiv:function(a,b){var c=document.createElement("div");c.id=idManager.getNewId();if(a)c.innerHTML=a;if(b)c.className=b;return c},createEditablePropDiv:function(a,b,c){var d=this.createNewDiv();d.className=a.cssClass;var e=a.desc&&a.desc||"",g=a.btnText||"edit",f="";if(c){buttonMaker.createMovingBtn(d,
5);f="<span>"+e+'</span><span class="value">'+a.value+"</span>";c=this.getParams(a.par._modelId,b);f+=widgetGenerator.submitButton("genericgui.showEditForm",c,g);$(d).append($(f))}else{g=$("<a>").addClass("value").append(a.value).mouseover(function(){$(this).removeClass("normalLink").addClass("hoverLink")}).mouseout(function(){$(this).removeClass("hoverLink").addClass("normalLink")}).click(function(){genericgui.showEditForm(a.par._modelId,b)});$(d).append(a.desc).append(g)}return d},createForm:function(a){a=
a&&a||{};return wm.createWindow({width:a.width||500,height:a.height||500,top:a.top||100,left:a.left||100,className:"add",moveable:a.moveable||true,notResizable:a.notResizable||true})},showEditForm:function(a,b){if(this.attribForm)alert("only one window of editing attribute is allowed at time");else{var c=wm.createWindow({width:500,height:0,top:100,left:100,className:"add",moveable:true,notResizable:true});this.attribForm=c;value=modelManager.getModel(a).getParamValue(b);a=this.getParams(a,b);var d=
b.indexOf("."),e=b;if(d!==-1)e=b.substring(0,d);b=widgetGenerator[e](value);b+="<br/>";b+=widgetGenerator.submitButton("genericgui.saveObjAttrib",a);b+=widgetGenerator.cancelButton();c.appendChild(this.createNewDiv(b,"add"));$(c).find(".deleted").hide()}},saveObjAttrib:function(a,b){a=modelManager.getModel(a);var c=undefined,d=false;for(c=0;c<valueReader.noObjectValues.length;c++)if(b===valueReader.noObjectValues[c])d=true;c=valueReader.generic(b);if(d)c=c[b];if(d=language.checkAttrib(a,b,c))alert(d);
else{a.setClassAttrib(b,c);viewManager.redrawViews(a.id);this.destroyEditAttribForm()}viewManager.redrawAll()},destroyEditAttribForm:function(){if(this.attribForm){$(this.attribForm).remove();this.attribForm=undefined}else dbg("called destroyEditAttribForm when no cmv.attribForm was defined")}},classController={createNewClass:function(a){var b=factory.creator.createClassModel();modelManager.addModel(b);a.model=b;a=factory.creator.createClassView(a);viewManager.addView(b.id,a);a.redraw()},createNewInterface:function(a){var b=
factory.creator.createInterfaceModel();modelManager.addModel(b);a.model=b;a=factory.creator.createInterfaceView(a);viewManager.addView(b.id,a);a.redraw()},createNewState:function(a){return this._genericCreateNewModel("State",a)},createNewConditional:function(a){return this._genericCreateNewModel("Conditional",a)},_genericCreateNewModel:function(a,b){var c="create"+a;a=factory.creator.model[c]();modelManager.addModel(a);b.model=a;b=factory.creator.view[c](b);viewManager.addView(a.id,b);b.redraw()},
deleteModel:function(a){viewManager.deleteModel(a);modelManager.deleteModel(a);viewManager.redrawAll()},deleteProperty:function(a,b){modelManager.getModel(a).deleteProperty(b);viewManager.redrawViews(a)},deleteMethod:function(a,b){modelManager.getModel(a).deleteMethod(b);viewManager.redrawViews(a)},deleteConnectionByBtn:function(){},deleteConnection:function(a,b,c){a=modelManager.getModel(a);b=modelManager.getModel(b);a.removeConnection(c);b.removeConnection(c);viewManager.removeConnection(c)},addConnection:function(a,
b,c,d){a=modelManager.getModel(a);b=modelManager.getModel(b);a.addConnection({connected:b,type:c,id:d,stat:"child"});b.addConnection({connected:a,type:c,id:d,stat:"parent"})}},controller=classController,InterfaceView=function(a){a.type="interface";a=createBaseView(a);var b=genericgui.createEditablePropDiv({par:a,cssClass:"classNameDiv",value:"new class",desc:""},"interfaceName");a.content.appendChild(b);var c=genericgui.createNewDiv("","propertiesDiv");a.content.appendChild(c);a.divs={interfaceName:b,
properties:c};a.getOptions=function(){var d=$("<div>");d.append($(widgetGenerator.submitButton("factory.gui.addMethod",genericgui.getParams(this.id),"add method")));d.append("<br/>");d.append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),"delete")));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"iherit",wm.connectInheritance));return d};a.redraw=function(){var d=modelManager.getModel(this._modelId);$(this.divs.interfaceName).children(".value:first").html(d.attribs.interfaceName);
var e=$(this.divs.properties);e.html("");for(var g in d.attribs.methods){var f=d.attribs.methods[g];if(typeof f!==undefined){var i=this._modelId,h=modelManager.getType(f.type).name;f=defaults.prefixes[f.visibility]+f.name+"( "+drawParams(f)+") : "+h;f+="<br/>";i=getOnclickProperty("methods",f,i,g);e.append(i)}}};return a},createClassView=function(a){a.type="class";a=createBaseView(a);var b=genericgui.createEditablePropDiv({par:a,cssClass:"classNameDiv",value:"new class",desc:""},"className");a.content.appendChild(b);
var c=genericgui.createNewDiv("","propertiesDiv");a.content.appendChild(c);a.divs={properties:c,classname:b};a.getOptions=function(){var d=$("<div>");d.append($(widgetGenerator.submitButton("factory.gui.addProperty",genericgui.getParams(this.id),"addProperty")));d.append("<br/>");d.append($(widgetGenerator.submitButton("factory.gui.addMethod",genericgui.getParams(this.id),"add method")));d.append("<br/>");d.append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),
"delete")));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"implement interface",wm.connectInterface));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"iherit",wm.connectInheritance));return d};a.redraw=function(){var d=modelManager.getModel(this._modelId);$("#"+this.divs.classname.id+" > .value").html(d.attribs.className);var e=$(this.divs.properties);e.html("").append("<hr/>");for(var g in d.attribs.properties){var f=d.attribs.properties[g];if(typeof f!=="undefined"){var i=
this._modelId,h=modelManager.getType(f.type).name;h=defaults.prefixes[f.visibility]+f.name+" : "+h;i=getOnclickProperty("properties",h,i,g);e.append(i).append("<br/>")}}e.append("<hr/>");for(g in d.attribs.methods){f=d.attribs.methods[g];if(typeof f!==undefined){i=this._modelId;h=modelManager.getType(f.type).name;h=defaults.prefixes[f.visibility]+f.name+"( "+drawParams(f)+") : "+h;i=getOnclickProperty("methods",h,i,g);e.append(i).append("<br/>")}}};return a},drawParams=function(a){for(var b="",c=
0;c<a.parameters.length;c++){if(c>0)b+=",";var d=a.parameters[c],e=modelManager.getType(d.type).name;b+=d.name+" : "+e}return b},getOnclickProperty=function(a,b,c,d){b=$("<span>").append(b);b.mouseover(function(){$(this).removeClass("normalLink").addClass("hoverLink")});b.mouseout(function(){$(this).removeClass("hoverLink").addClass("normalLink")});b.get(0).onclick=function(i,h){return function(){return genericgui.showEditForm(i,a+"."+h)}}(c,d);var e=$("<span>").append("delete").addClass("normalBtn").mouseover(function(){$(this).removeClass("normalBtn").addClass("hoverLink")}).mouseout(function(){$(this).removeClass("hoverLink").addClass("normalBtn")});
if(a==="properties")e.click(function(){controller.deleteProperty(c,d)});else a==="methods"&&e.click(function(){controller.deleteMethod(c,d)});for(var g="",f=0;f<5;f++)g+="&nbsp;";return $("<span>").append(b).append(g).append(e)},classFactory={creator:{model:{},createClassModel:function(a){a||(a=idManager.getNewId());return new classModel({id:a,type:"class"})},createClassView:function(a){a.width=a.height=250;return createClassView(a)},createInterfaceModel:function(a){a||(a=idManager.getNewId());return new InterfaceModel({id:a})},
createInterfaceView:function(a){return InterfaceView(a)}},serializator:{serialize:function(){}},deserializator:{createClassModel:function(a){return new classModel({initial:a,id:a.id})},createClassView:function(a){return createClassView({initial:a,model:a.model,width:a.width,height:a.height,id:a.id})},createInterfaceModel:function(a){return new InterfaceModel({initial:a,model:a.model,id:a.id})},createInterfaceView:function(a){return factory.creator.createInterfaceView({initial:a,model:a.model,id:a.id})}},
gui:{addProperty:function(a){return this.genericAdd(a,"properties")},addMethod:function(a){return this.genericAdd(a,"methods")},genericAdd:function(a,b){a=modelManager.getModel(document.getElementById(a)._modelId);var c=[];for(var d in a.attribs[b])c.push(d);c.sort();for(var e=0,g=0;g<c.length;g++){e=parseInt(d[g])+1;if(a.attribs[b][e]===undefined)break}genericgui.showEditForm(a.id,b+"."+e)},createGui:function(a){var b=factory.gui.methods,c=BaseGui.createInput;$(a).append("Adding/removing class diagram objects:");
$(c("Add new class","factory.gui.newClass")).click(b.newClass).appendTo(a);$(c("Add new interface")).click(b.newInterface).appendTo(a)},methods:{newClass:function(){controller.createNewClass({top:200,left:100,moveable:true})},newInterface:function(){controller.createNewInterface({top:200,left:100,moveable:true})}}}},factory=classFactory,allowed_connections={implementation:[{0:"class",1:"interface"}],inheritance:[{0:"class",1:"class"}],asm:[{0:"state",1:"state"},{0:"conditional",1:"state"},{0:"state",
1:"conditional"}]},createBaseView=function(a){a.moveable=true;var b=wm.createWindow(a),c=$("#"+b.id+"> .movingDiv:first"),d=c.attr("onmousedown");c.removeAttr("onmousedown").mousedown(function(e){wm._forceInputs||b.hideInputs();d.call(this,e)});b.origClass=b.className;b._modelId=a.model.id;b.connections=new Earray;b.inner=genericgui.createNewDiv("","innerDiv");b.appendChild(b.inner);b.content=genericgui.createNewDiv();b.inner.appendChild(b.content);b.mouseIO=0;b.addConnection=function(e){this.connections.push(e)};
b.removeConnection=function(e){for(var g=0;g<this.connections.length;g++)if(this.connections[g].btn===e)break;if(g===this.connections.length-1)this.connections.pop();else this.connections[g]=this.connections.pop()};b.removeConnectionById=function(e,g){if(g)this.connections.removeAt(g);else{for(g=0;g<this.connections.length;g++)if(this.connections[g].id===e)break;g<this.connections.length&&this.connections.removeAt(g)}};b.callLater=function(e){return function(){if(e.optionsDiv){e.optionsDiv.remove();
e.optionsDiv=undefined}}};b.hideInputs=function(){if(this.optionsDiv)if(!this.interval)this.interval=setTimeout(this.callLater(this),1E3)};b.showInputs=function(){if(this.interval){clearTimeout(this.interval);this.interval=undefined}var e=toInt(this.style.left),g=toInt(this.style.top),f=toInt(this.style.width);toInt(this.style.height);if(this.optionsDiv){this.optionsDiv.remove();clearTimeout(this.interval);this.optionsDiv=this.interval=undefined}this.optionsDiv=$("<div>").append(this.getOptions()).append("<br/>").mouseover(function(){if(this.associatedView.interval){clearTimeout(this.associatedView.interval);
this.associatedView.interval=undefined}}).mouseout(function(){this.associatedView.interval=setTimeout(this.associatedView.callLater(this.associatedView),1E3)}).css({left:e+f,top:g,position:"absolute"}).appendTo("#main_div").fadeIn();this.optionsDiv.get(0).associatedView=this};b.onmouseover=function(){this.mouseIO+=1;var e=wm.__marked_info.type;if(e==="connecting"){this.origClass=this.className;this.className="over"}var g=wm._forceInputs;if(g!=="show")if(g!=="hide")if(!e&&e!=="resize")this.showInputs();
else e==="resize"&&this.hideInputs()};b.onmouseout=function(){this.mouseIO-=1;this.className=this.origClass;var e=wm.__marked_info.type,g=wm._forceInputs;if(g!=="show")if(g!=="hide")if(!e||e==="resize")this.hideInputs()};b.onclick=function(){if(wm.__marked_info.type==="connecting")if(wm.connectedFirstClass===this){viewManager.delete_wire(wm.__marked_info.obj);wm.__marked_info.obj=undefined;wm.__marked_info.type=wm.__marked_info.connection_type=""}else{for(var e=false,g=wm.connectedFirstClass,f=this,
i=allowed_connections[wm.__marked_info.connection_type],h=0;h<i.length;h++)if(i[h][0]===g.type&&i[h][1]===f.type){e=true;break}if(e)if(wm.connectedFirstClass!==this)if(!(wm.__marked_info.connection_type==="implementation"&&this.type!=="interface")){e=wm.__marked_info.obj;g=e.firstButton();f=this._modelId;i=wm.connectedFirstClass._modelId;h=idManager.getNewId();var j=wm.__marked_info.connection_type;g.connection_id=h;g.connection_type=j;this.addConnection({btn:e,id:h});e.parentLogic=this;wm.connectedFirstClass.addConnection({btn:g,
id:h});g.parentLogic=wm.connectedFirstClass;e.redraw();viewManager.addConnection(g);controller.addConnection(i,f,j,h);wm.__marked_info.obj=undefined;wm.__marked_info.type=wm.__marked_info.connection_type=""}}};b.toSerialize=function(){var e=baseToSerialize(this);e.connections=[];this.connections.foreach(function(){e.connections.push({id:this.id,btnid:this.btn.id})});e.modelId=this._modelId;e.type=this.type;return e};if(a.initial){b.style.top=a.initial.top;b.style.left=a.initial.left;b.style.width=
a.initial.width;b.style.height=a.initial.height;b._modelId=a.initial.modelId;b.type=a.initial.type;dbg(document.getElementById(a.initial.id));b.id=a.initial.id}return b},ClassDeserializer={deserializeModels:function(){for(var a=serialized_data.models,b=0;b<a.length;b++){var c=a[b],d;if(c.type==="class")d=factory.deserializator.createClassModel(c);else if(c.type==="interface")d=factory.deserializator.createInterfaceModel(c);else if(c.type==="state")d=factory.deserializator.model.createState(c);else if(c.type===
"conditional")d=factory.deserializator.model.createConditional(c);modelManager.addModel(d)}for(b=0;b<a.length;b++){c=a[b];var e=c.connections;d=modelManager.getModel(c.id);for(c=0;c<e.length;c++){var g=e[c];g={connected:modelManager.getModel(g.connected),type:g.type,stat:g.stat,id:g.id};d.addConnection(g)}}},deserializeViews:function(){for(var a=serialized_data.views,b=0;b<a.length;b++){var c=a[b];c.model=modelManager.getModel(c.modelId);c=c.type==="class"?factory.deserializator.createClassView(c):
c.type==="interface"?factory.deserializator.createInterfaceView(c):factory.deserializator.view["create_"+c.type](c);viewManager.addView(c._modelId,c);c.redraw();c.updatePos(parseInt(c.style.top),parseInt(c.style.left))}for(b=0;b<serialized_data.wires.length;b++){a=serialized_data.wires[b];a.orientation==="wide"?wm.createHorizontalWire(parseInt(a.left),parseInt(a.left)+parseInt(a.width),parseInt(a.top),a.id):wm.createVerticalWire(parseInt(a.top),parseInt(a.top)+parseInt(a.height),parseInt(a.left),
a.id)}for(b=0;b<serialized_data.buttons.length;b++){a=serialized_data.buttons[b];c=document.getElementById(a.conn.one.wire);var d=a.conn.one.pos,e=line2pos=undefined;if(a.conn.two){e=document.getElementById(a.conn.two.wire);line2pos=a.conn.two.pos}buttonMaker.createWireBtn(c,e,d,d,line2pos,a.id);a.label&&buttonMaker.createLabel({text:a.label.text,btn:document.getElementById(a.id),posRelative:{x:a.label.pos.x,y:a.label.pos.y},width:a.label.base.width,height:a.label.base.height})}for(b=0;b<serialized_data.buttons.length;b++){c=
serialized_data.buttons[b];a=document.getElementById(c.id);if(c.first)a.first=true;if(c.last)a.last=true;if(c.parentLogic)a.parentLogic=document.getElementById(c.parentLogic);if(c.connection_id)a.connection_id=c.connection_id;if(c.connection_type)a.connection_type=c.connection_type;a.nextBtn=document.getElementById(c.nextBtn);a.prevBtn=document.getElementById(c.prevBtn)}for(b=0;b<serialized_data.views.length;b++){c=serialized_data.views[b];for(d=0;d<c.connections.length;d++){e=c.connections[d];a=
document.getElementById(e.btnid);a.parentLogic.addConnection({btn:a,id:e.id});a.connection_id&&viewManager.addConnection(a)}}}},cs={checkPropertyName:function(a,b,c){if(a.length<=2)return"too short";if(c)for(c=0;c<b.idxs.properties;c++)if(b.attribs.properties[c].name===a)return"property with name "+a+" already exists in that class";return""},checkAttrib:function(){return""},getBaseTypes:function(){if(this._type_cache)return this._type_cache;for(var a=new Earray,b=["int","string","double","bool"],
c=0;c<b.length;c++){var d=new classModel({});d.attribs.className=b[c];a.push(d)}return this._type_cache=a}},FF_DEBUG=false,dbg=function(a){FF_DEBUG&&console.log(a)},language;
document.onclick=function(){var a=wm.__marked_info.type;if(a==="moving_wire"){wm.__marked_info.obj.redraw();wm.__marked_info.obj=wm.__marked_info.type=undefined}else if(a==="split_wire"||a==="delete_wire"||a==="cut_wire"||a==="add_label_wire"){wm.__marked_info.clicks+=1;if(wm.__marked_info.clicks===2||wm.__marked_info.clicks>2)tm.destroyToolTip()}else if(a==="down"){wm.__marked_info.obj=undefined;wm.__marked_info.type=undefined}};document.onmouseup=function(){};
var types={property:{text:"Property",attribName:"properties"}},wm={formShown:false,init:function(a,b){document.getElementById("main_div").getBoundingBox=function(){return{ne:{x:500,y:0},sw:{x:0,y:500}}};this.__colllisionNeighbours=b;this.__colllisionParent=a;this.__marked_info={obj:undefined,type:undefined}},markResized:function(a){obj=document.getElementById(a);a=wm.__marked_info.obj=obj;for(var b=document.getElementById("main_div"),c={top:0,left:0};a!==b;){c.top=parseInt(c.top)+parseInt(a.style.top);
c.left=parseInt(c.left)+parseInt(a.style.left);a=a.parentNode}wm.__marked_info.resizeDiff={top:c.top,left:c.left};wm.__marked_info.type="resize";document.onmousemove=resizer.resizeMarked;document.onmouseup=wm._stopResize},createWindow:function(a){var b=windowCreator._createBaseWindow(a.left,a.top,a.inner,a.parentEl,a.id);if(a.type)b.type=a.type;a.firstObjects&&$(b).append(a.firstObjects);a.moveable?buttonMaker.createMovingBtn(b):this._assignEvents(b);styleManager.setBaseWindowStyle(b,{width:a.width,
height:a.height,className:a.className});b.updatePos(parseInt(b.style.top),parseInt(b.style.left));a.notResizable||buttonMaker.createBtn(b);return b},getPrefixForProp:function(){},createHorizontalWire:function(a,b,c,d){return windowCreator._createJoiningElement(a,b,c,c,d)},createVerticalWire:function(a,b,c,d){return windowCreator._createJoiningElement(c,c,a,b,d)},getConnPoint:function(a){return{x:parseInt(a.style.left)+parseInt(a.style.width)-defaults.wireMovingButtonWidth-10,y:parseInt(a.style.top)+
parseInt(a.style.height)/2}},connectInterface:function(a,b){wm.__marked_info.connection_type="implementation";wm.connect(a,b)},connectInheritance:function(a,b){wm.__marked_info.connection_type="inheritance";wm.connect(a,b)},connectAsm:function(a,b){wm.__marked_info.connection_type="asm";wm.connect(a,b)},connect:function(a,b){if(wm.__marked_info.type!=="connecting"){var c=connector.startConnecting(document.getElementById(b)).line2.btns[0];c.onmousedown(a);a={x:15+a.pageX-(parseInt(c.conn.one.wire.style.left)+
parseInt(c.style.left)),y:a.pageY-(parseInt(c.conn.one.wire.style.top)+parseInt(c.style.top))};moveManager._move_wire_by_diff(c.conn.one.wire,a,c.place,c,0,"previous");wm.__marked_info.type="connecting";wm.connectedFirstClass=viewManager.getView(b)}},__marked_info:{},__over_info:{},__colllisionNeighbours:false,__colllisionParent:false,_forceInputs:undefined,_assignEvents:function(a){a.onmouseover=this._manageMouseOver;a.onmouseout=this._manageMouseOut;a.onmousedown=this._manageMouseDown;document.mouseup=
a.onmouseup=this._manageMouseUp},_stopResize:function(){wm.__marked_info.obj=undefined;document.onmousemove=document.onmouseup=undefined;wm.__marked_info.type=undefined},_manageMouseClick:function(){},_genericManageMouseDown:function(){},_manageMouseDown:function(a){return wm._genericManageMouseDown(a,this)},_manageMouseUp:function(){if(wm.__marked_info.type!=="connecting")if(wm.__marked_info.obj)if(wm.__marked_info.type!=="resize")if(wm.__marked_info.type!=="split_wire")if(wm.__marked_info.type!==
"delete_wire"){wm.__marked_info.obj=undefined;wm.__marked_info.type="";document.onmousemove=undefined}},_manageMouseOver:function(){},_manageMouseOut:function(){}},baseToSerialize=function(a){return{id:a.id,top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height}},collisionDetector={collideWithNeighbours:function(a){for(var b=0;b<defaults.classesDoesNotCollide.length;b++)if(a.className===defaults.classesDoesNotCollide[b])return false;b=this._getNeighbourDivs(a);a=a.getBoundingBox();
for(var c=0;c<b.length;c++)if(b[c].getBoundingBox){var d=b[c].getBoundingBox();if(this._collide(a,d))return true;if(this._collide(d,a))return true}return false},collideWithParent:function(a){for(var b=0;b<defaults.classesDoesNotCollide.length;b++)if(a.className===defaults.classesDoesNotCollide[b])return false;b=a.parentNode;b={ne:{x:parseInt(b.style.width),y:0},sw:{x:0,y:parseInt(b.style.height)}};a={ne:{x:parseInt(a.style.left)+parseInt(a.style.width),y:parseInt(a.style.top)},sw:{x:parseInt(a.style.left),
y:parseInt(a.style.top)+parseInt(a.style.height)}};if(a.ne.x>=b.ne.x)return true;if(a.ne.y<=b.ne.y)return true;if(a.sw.x<=b.sw.x)return true;if(a.sw.y>=b.sw.y)return true;return false},_getNeighbourDivs:function(a){return $(a).parent().children("div").not(".cres").not(".wire").not("#"+a.id).not(".propertiesDiv").not(".add")},_getBorderingDiv:function(a){return $(a).parent(":not(#main_div)")},_collide:function(a,b){if(a.ne.x>=b.sw.x&&a.ne.x<=b.ne.x){if(a.ne.y<=b.sw.y&&a.ne.y>=b.ne.y)return true;if(a.sw.y<=
b.sw.y&&a.sw.y>=b.ne.y)return true}if(a.sw.x>=b.sw.x&&a.sw.x<=b.ne.x){if(a.sw.y>=b.sw.y&&a.sw.y<=b.ne.y)return true;if(a.ne.y<=b.sw.y&&a.ne.y>=b.ne.y)return true}return false}},connection=function(){},connector={startConnecting:function(a){a=wm.getConnPoint(a);return connector._create_wire_points(a,{x:a.x+100,y:a.y+100})},connectToWdw:function(){},_getPlace:function(a){return{x:parseInt(a.style.left)+parseInt(a.style.width)/2,y:parseInt(a.style.top)+parseInt(a.style.height)/2}},_create_wire:function(a,
b){a=this._getPlace(a);b=this._getPlace(b);return connector._create_wire_points(a,b)},_create_wire_points:function(a,b){var c=wm.createHorizontalWire(a.x,b.x,a.y);a=wm.createVerticalWire(a.y,b.y,b.x);b=buttonMaker.createWireBtn(c,undefined,"topleft","topleft",undefined);var d=buttonMaker.createWireBtn(c,a,"widehigh","widehigh","topleft"),e=buttonMaker.createWireBtn(a,undefined,"widehigh","widehigh",undefined);b.first=true;b.nextBtn=d;d.prevBtn=b;d.nextBtn=e;e.prevBtn=d;e.last=true;return{line1:c,
line2:a}},addWire:function(a){var b=a.conn.one.wire;if(b.orientation!=="wide"){var c=a.nextBtn;if(a.last)c=a.prevBtn;return connector.addWire(c)}if(a.first||a.last)alert("cant split wires here");else{var d=a.conn.two.wire,e=undefined,g=e=40,f={x:undefined,y:undefined};c=a.nextBtn;var i=wire2place=undefined;if(b.orientation==="wide"){i=a.conn.one.pos;wire2place=c.conn.one.pos;f.y=parseInt(d.style.top)+parseInt(d.style.height)-parseInt(b.style.top);if(a.conn.two.pos==="topleft"){e=d;g=b}else{e=b;g=
d}f.y=parseInt(e.style.top)+parseInt(e.style.height)-parseInt(g.style.top);if(a.conn.one.pos==="widehigh"){e=d;g=b}else{e=b;g=d}f.x=parseInt(e.style.left)+parseInt(e.style.width)-parseInt(g.style.left)}e=f.y/2;g=f.x/2;if(b.orientation==="wide"){var h=wire3y=newWire3=undefined,j=newWire2y2=undefined;f=newWire3x2=undefined;if(a.conn.one.pos==="widehigh"){b.style.width=parseInt(b.style.width)-g;h=parseInt(b.style.left)+parseInt(b.style.width);f=parseInt(b.style.left)+parseInt(b.style.width);newWire3x2=
parseInt(d.style.left)}else{b.style.left=parseInt(b.style.left)+g;b.style.width=parseInt(b.style.width)-g;h=parseInt(b.style.left);f=parseInt(d.style.left);newWire3x2=parseInt(b.style.left)}moveManager._update_wire_buttons(b);if(a.conn.two.pos==="topleft"){d.style.top=parseInt(d.style.top)+e;d.style.height=parseInt(d.style.height)-e;wire3y=parseInt(d.style.top);j=parseInt(b.style.top);newWire2y2=j+e}else{d.style.height=parseInt(d.style.height)-e;wire3y=parseInt(d.style.top)+parseInt(d.style.height);
j=parseInt(d.style.top)+parseInt(d.style.height);newWire2y2=parseInt(b.style.top)}moveManager._update_wire_buttons(d);e=wm.createVerticalWire(j,newWire2y2,h);newWire3=wm.createHorizontalWire(f,newWire3x2,wire3y);f=a.conn.two.pos;b=buttonMaker.createWireBtn(e,newWire3,wire2place,wire2place,a.conn.one.pos==="widehigh"&&"topleft"||"widehigh");d=buttonMaker.createWireBtn(newWire3,d,i,i,f);if(a.last){a.last=undefined;newBtn4.last=true}c.prevBtn=d;d.prevBtn=b;d.nextBtn=c;b.nextBtn=d;b.prevBtn=a;a.conn.two.wire=
e;a.nextBtn=b}}},_create_assocation:function(){},_connect_assocation:function(){},connect:function(a,b){var c=this._create_wire(a,b);this._create_assocation(a,c.line1,b);this._create_assocation(b,c.line2,a);this.addWire(c.line1.btns[1])}},styleManager={setBaseWindowStyle:function(a,b){this._baseSetStyle(a,b.width,b.height);a.className=b.className||defaults.windowClassName},setWireStyle:function(a,b,c){this._baseSetStyle(a,b,c);a.className="wire"},_baseSetStyle:function(a,b,c){if(typeof b==="undefined")b=
defaults.windowWidth;if(typeof c==="undefined")c=defaults.windowHeight;a.style.position="absolute";a.style.width=b;a.style.height=c}},toInt=function(a){return parseInt(a,10)},buttonMaker={height:15,width:15,moveButton:function(a){var b=document.getElementById("r"+a.id);buttonMaker._setPos(a,b,"widehigh")},showLabelForm:function(a,b,c){a=document.getElementById(a);var d=genericgui.createForm({height:5});d.id=idManager.getNewId();var e="Enter label here: ";e+=widgetGenerator.input("idlabel",a.label_text||
defaults.wireLabel);e+="<br/>";e+=widgetGenerator.submitButton(b,genericgui.getParams(a.id,d.id),c||"Add label");e+=widgetGenerator.submitButton("buttonMaker.closeLabelForm",genericgui.getParams(d.id),"cancel");e+="<br/>";e+="<br/>";d.appendChild(genericgui.createNewDiv(e,"add",true))},addLabel:function(a,b){this.createLabel({btn:document.getElementById(a),text:$("#idlabel").val()});buttonMaker.closeLabelForm(b)},editLabel:function(a,b){a=document.getElementById(a);var c=$("#idlabel").val();a.label_text=
c;$(a.label).find(".inner:first").html(c);a.label.label_text=c;buttonMaker.closeLabelForm(b)},removeLabel:function(a){a=document.getElementById(a);delete a.btn.label;$(a).remove()},createLabel:function(a){var b=wm.createWindow({type:"label",width:a.width&&a.width||defaults.wireLabelWidth,height:a.height&&a.height||defaults.wireLabelHeight,top:100,left:100,className:"buttonlabel",moveable:true,notResizable:false});b.btn=a.btn;b.updateRelativePos=function(){this.posX=toInt(this.style.left)-this.btn.getAbsolutePos().x;
this.posY=toInt(this.style.top)-this.btn.getAbsolutePos().y};b.moveAfterFollowedBtn=function(){b.style.left=a.btn.getAbsolutePos().x+b.posX;b.style.top=a.btn.getAbsolutePos().y+b.posY};$(b).append($('<span class="inner">'+a.text+"</span>")).append($(widgetGenerator.submitButton("buttonMaker.removeLabel",genericgui.getParams(b.id),"delete"))).append($(widgetGenerator.submitButton("buttonMaker.showLabelForm",genericgui.getParams(a.btn.id,"buttonMaker.editLabel","save"),"edit")));b.label_text=a.text;
if(a.posRelative){b.posX=a.posRelative.x;b.posY=a.posRelative.y}else{b.posX=defaults.wireLabelDiffX;b.posY=defaults.wireLabelDiffY}b.moveAfterFollowedBtn();b.onmouseover=function(){wm._forceInputs||wm.__marked_info.type||$(this).find("input").show()};b.onmouseout=function(){wm._forceInputs||wm.__marked_info.type||$(this).find("input").hide()};a.btn.label=b;b.updateRelativePos();b.onmouseout();document.getElementById("main_div").appendChild(b)},closeLabelForm:function(a){$("#"+a).remove()},createBtn:function(a){var b=
this._getStyleTxt("silver",defaults.resizeButtonWidth,defaults.resizeButtonHeight),c='<div class="cres"';c+=' id="r'+a.id+'"';c+=' style="'+b+'"';c+='" onmousedown="wm.markResized(\''+a.id+"')\"";c+="</div>";$(a).append(c);this._setPos(a,document.getElementById("r"+a.id),"widehigh")},createWireBtn:function(a,b,c,d,e,g){g=this._createWireBtnHtml(a,g);$(a).append(g.txt);g=document.getElementById(g.id);g._parent=a;this._setPos(g._parent,g,c);g.place=c;g.conn={};g.conn.one={};g.conn.one.pos=d;g.conn.one.wire=
a;g.conn.two={};g.conn.two.pos=e;g.conn.two.wire=b;a.btns.push(g);g.getAbsolutePos=function(){return{x:toInt(this.style.left)+toInt(this.parentNode.style.left),y:toInt(this.style.top)+toInt(this.parentNode.style.top)}};g.getDataToCopy=function(f){for(var i=["first","last","parentLogic","label"],h=0;h<i.length;h++)if(this[i[h]])f[i[h]]=this[i[h]];if(this.first){f.connection_id=this.connection_id;f.connection_type=this.connection_type}};g.onmousedown=wm._manageMouseDown;g.onmouseup=function(){this.redraw();
if(wm.__marked_info.type==="moving_wire")wm.__marked_info.obj=wm.__marked_info.type=undefined};g.onmouseover=function(){var f=wm.__marked_info.type;if(f==="split_wire"||f==="delete_wire"||f==="cut_wire"||f==="add_label_wire"){f=defaults.wireMovingButtonWidth;var i=defaults.wireMovingButtonHeight,h=3;if(this.last){i=f=defaults.wireMovingButtonEndWidth;h=2}this.style.width=h*f;this.style.height=h*i}};g.onmouseout=function(){var f=wm.__marked_info.type;if(f==="split_wire"||f==="delete_wire"||f==="cut_wire"||
f==="add_label_wire")if(this.last){this.style.width=defaults.wireMovingButtonEndWidth;this.style.height=defaults.wireMovingButtonEndHeight}else{this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonHeight}};g.onclick=function(){var f=wm.__marked_info.type;if(f==="split_wire"){this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonHeight;connector.addWire(this);this.style.width=defaults.wireMovingButtonWidth;this.style.height=
defaults.wireMovingButtonWidth;tm.destroyToolTip()}else if(f==="delete_wire"){f=this.firstButton();var i=this.lastButton();controller.deleteConnection(f.parentLogic._modelId,i.parentLogic._modelId,f.connection_id);tm.destroyToolTip()}else if(f!=="change_connection_type")if(f==="add_label_wire"){this.label?alert("This button already has a label. To add new label, please remove the existing one."):buttonMaker.showLabelForm(this.id,"buttonMaker.addLabel");this.style.width=defaults.wireMovingButtonWidth;
this.style.height=defaults.wireMovingButtonWidth;tm.destroyToolTip()}else if(f==="cut_wire"){this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;if(!this.first&&!this.last)alert("can cut only first and last button");else{if(this.first){f=this;for(var h=0;h<2;h++)f=f.nextBtn;if(f.last){alert("too little boxes");return}}else{f=this;for(h=0;h<2;h++)f=f.prevBtn;if(f.first){alert("too little boxes");return}}var j=h=undefined;f=undefined;var k=0,l=0;if(this.conn.one.wire.orientation===
"high"){h="nextBtn";j="prevBtn";f="two";if(this.last){h="prevBtn";j="nextBtn";f="one"}k=toInt(this.conn.one.wire.style.height)}else{h="nextBtn";j="prevBtn";f="two";if(this.last){h="prevBtn";j="nextBtn";f="one"}l=toInt(this.conn.one.wire.style.width)}i=this[h];var m=this[h][h];if(this.conn.one.pos!=="widehigh"){k=-k;l=-l}moveManager._move_wire({x:l,y:k},m);k=buttonMaker.createWireBtn(i.conn[f].wire,undefined,i.conn[f].pos,i.conn[f].pos,undefined);this.getDataToCopy(k);k[h]=m;k[j]=undefined;m[j]=k;
for(h=0;h<this.parentLogic.connections.length;h++)if(this.parentLogic.connections[h].btn.id===this.id)break;this.parentLogic.connections[h]={btn:k};i.conn[f].wire.appendChild(k);buttonMaker._setPos(k.conn.one.wire,k,k.place);$(this.conn.one.wire).remove();$(i).remove();k.redraw()}}};g.onmousedown=function(f){if(wm.__marked_info.type!="resize")if(!wm.__marked_info.obj){wm.__marked_info.type="moving_wire";wm.__marked_info.obj=this;wm.__marked_info.top=this._parent.style.top;wm.__marked_info.left=this._parent.style.left;
wm.__marked_info.pageX=f.pageX;wm.__marked_info.pageY=f.pageY;wm.__marked_info.diffX=f.pageX-toInt(this.style.left);wm.__marked_info.diffY=f.pageY-toInt(this.style.top);document.onmousemove=moveManager.moveMarked}};g.toSerialize=function(){var f=baseToSerialize(this);f.parentNodeId=this.parentNode.id;f.conn={one:{wire:this.conn.one.wire.id,pos:this.conn.one.pos}};if(this.conn.two.wire)f.conn.two={wire:this.conn.two.wire.id,pos:this.conn.two.pos};if(this.nextBtn)f.nextBtn=this.nextBtn.id;if(this.prevBtn)f.prevBtn=
this.prevBtn.id;if(this.first){f.first=true;f.connection_id=this.connection_id;f.connection_type=this.connection_type}if(this.last)f.last=true;if(this.parentLogic)f.parentLogic=this.parentLogic.id;if(this.label){var i=this.label;f.label={text:i.label_text,pos:{x:i.posX,y:i.posY},base:baseToSerialize(this.label)}}return f};g.firstButton=function(){for(var f=this;!f.first;)f=f.prevBtn;return f};g.lastButton=function(){for(var f=this;!f.last;)f=f.nextBtn;return f};g.redraw=function(){var f=this.firstButton().connection_type,
i=this.lastButton();i.drawSign(f);buttonMaker._setPos(i.conn.one.wire,i,i.conn.one.pos);(f=moveManager._box_difference(this,{x:0,y:0}))&&f.wx>=0&&dbg("error during redrawing wire btn")};g.drawSign=function(f){this.style.width=this.style.height=1;f="/site_media/"+f+this.conn.one.pos.substring(0,3)+this.conn.one.wire.orientation.substring(0,3)+".png";var i=0,h=0;if(this.conn.one.wire.orientation==="wide"){i=-(defaults.arrowSize/2);h=0}else{i=0;h=-(defaults.arrowSize/2)}h=h.toString();i=i.toString();
f=$('<img src="'+f+'"/>').css({left:h,top:i,position:"absolute"});$(this).children().remove();this.appendChild(f.get(0));f.click(function(j){return function(k){return j.onclick(k)}}(this)).mouseover(function(j){return function(k){j.onmouseover(k)}}(this))};return g},createMovingBtn:function(a,b){var c=document.createElement("div");c.id=idManager.getNewId();c.className="movingDiv";c.style.height=b||defaults.movingBtnHeight;c.style.width="100%";c.style.left=0;c.style.top=0;c.getBoundingBox=function(){return{ne:{x:toInt(this.style.left)+
toInt(this.style.width),y:toInt(this.style.top)},sw:{x:toInt(this.style.left),y:toInt(this.style.top)+toInt(this.style.height)}}};c._parent=a;wm._assignEvents(c);c.onmousedown=function(d){if(wm.__marked_info.type!="resize")if(!wm.__marked_info.obj){wm.__marked_info.type="down";wm.__marked_info.top=this._parent.style.top;wm.__marked_info.left=this._parent.style.left;var e=wm.__marked_info.obj=this._parent;wm.__marked_info.diffX=d.pageX-toInt(e.style.left);wm.__marked_info.diffY=d.pageY-toInt(e.style.top);
document.onmousemove=moveManager.moveMarked}};c.onmouseup=document.onmouseup;c.onclick=document.onclick;a.appendChild(c)},createConnectBtn:function(a,b,c){return $("<button>"+b+"</button>").click(function(d){return c(d,a)})},_getStyleTxt:function(a,b,c){b="width: "+b+"px; height: "+c+"px;";b+=" position: absolute; background: "+a;return b},_createWireBtnHtml:function(a,b){a='<div class="wirehandle"';var c=this._getStyleTxt(defaults.wireBtnColor,defaults.wireMovingButtonWidth,defaults.wireMovingButtonHeight),
d=undefined;d=b?b:idManager.getNewId();a+=' id="'+d+'"';a+=' style="'+c+'"';a+="</div>";return{txt:a,id:d}},_setPos:function(a,b,c){var d=0,e=0;if(c==="widehigh"){d=toInt(a.style.width)-toInt(b.style.width);e=toInt(a.style.height)-toInt(b.style.height)}b.style.top=e;b.style.left=d}},idManager={max_id_number:0,prefix:"i",getNewId:function(){this.max_id_number+=1;if(document.getElementById(this.prefix+this.max_id_number)){dbg("znalazlem !!");dbg(this.max_id_number)}return this.prefix+this.max_id_number}},
defaults={windowWidth:100,windowHeight:100,wireSize:1,windowClassName:"orange",resizeButtonWidth:15,resizeButtonHeight:15,movingBtnHeight:10,wireBtnColor:"silver",asmViewWidth:100,asmViewHeight:100,wireMovingButtonWidth:10,wireMovingButtonHeight:10,wireMovingButtonEndWidth:30,wireMovingButtonEndHeight:30,wireLabel:"Enter label here",wireLabelDiffX:30,wireLabelDiffY:0,wireLabelWidth:100,wireLabelHeight:100,arrowSize:30,stateDescription:"New state",condition:"enter your condition here",classesDoesNotCollide:["add"],
propertyVisibility:"protected",className:"New class name",interfaceName:"New interface",prefixes:{"private":"-","public":"+","protected":"#"},visSet:[{name:"public",val:"public"},{name:"protected",val:"protected"},{name:"private",val:"private"}]},initialize=function(){var a={1:classFactory,2:asmFactory};language=cs;wm.init(false,false);modelManager.initialize();factory=a[window.diagramData.type];window.diagramData.load&&deserializer.deserialize(window.serialized_data);document.getElementById("main_div").classes=
[];BaseGui.createGui($("#userGui > #genericGui"),diagramData.read_only);factory.gui.createGui($("#userGui > #specificGui"))},windowCreator={_createJoiningElement:function(a,b,c,d,e){var g=defaults.wireSize;e=this._createBaseWindow(a,c,"",undefined,e);var f=Math.abs(b-a),i=Math.abs(d-c),h=e.orientation=f<i&&"high"||"wide",j=undefined,k=undefined;if(h==="wide"){j=f;k=g}else{j=g;k=i}e.zwrot=h==="wide"?b<a?"left":"right":d-c<0?"up":"down";e.btns=[];styleManager.setWireStyle(e,j,k);e.toSerialize=function(){var l=
baseToSerialize(this);l.orientation=this.orientation;return l};e.addButton=function(l){this.btns.push(l)};e.onmousedown=function(){};return e},_createBaseWindow:function(a,b,c,d,e){var g=document.createElement("div");g.innerHTML=c||"";g.id=typeof e==="string"?e:idManager.getNewId();g.connections={assocation:[]};g._cached_pos={top:0,left:0};g.getBoundingBox=function(){return this._cached_bounding_box};g.updatePos=function(f,i){this.style.top=f;this.style.left=i;this._cached_bounding_box={ne:{x:parseInt(i)+
parseInt(this.style.width),y:parseInt(this.style.top)},sw:{x:parseInt(this.style.left),y:parseInt(f)+parseInt(this.style.height)}}};if(typeof a!=="undefined"&&typeof b!=="undefined"){g.style.top=b||b+"px";g.style.left=a||a+"px"}a=d||document.getElementById("main_div");a.appendChild(g);g._parent=a;return g}},BaseGui={showInputs:true,showWireButtons:true,createInput:function(a){return'<input type="submit" value="'+a+'"/>'},changeModeId:undefined,createGui:function(a,b){var c=function(j){return'<div id="'+
j+'" />'},d={state:0,getNewId:function(){this.state+=1;return"guiid"+this.state}},e=BaseGui.methods,g=BaseGui.createInput,f=d.getNewId(),i=d.getNewId(),h=d.getNewId();$(a).append(c(f)).append(c(i)).append(c(h));a=$("#"+f);i=$("#"+i);h=$("#"+h);a.append("<span>Managing wires: </span>");a.append($(g("Split wire")).click(e.splitWire));a.append($(g("Delete wire")).click(e.deleteWire));a.append($(g("Cut wire")).click(e.cutWire));a.append($(g("add label to wire")).click(e.addLabel));a=$(g("hide wire buttons")).click(e.toogleWireButtons);
$(a).attr("id",d.getNewId());BaseGui.toogleWireButtonsId=$(a).attr("id");d=$(g("turn collision neighbour objects on")).click(e.toogleNeighbourCollision);wm.__colllisionNeighbours=true;d.click(undefined);i.append("<span>Visibility/behaviour:</span>");i.append(a).append(d);$("#main_div").find("input").hide();d=$(g("save")).click(function(){$("#idSerializedData").val(serializator.serializeAll());$("#save_form").submit()});if(b)d=$("");h.append("<span>File options:</span>").append(d).append($(g("close")).click(function(){window.location=
project_id==-1?"/demo_choose_type/":"/project/"+project_id+"/"}))},methods:{splitWire:function(a){wm.__marked_info.type="split_wire";return tm.movingTooltip(a,"click on box on wire to split that wire",-3*defaults.wireMovingButtonWidth,0)},deleteWire:function(a){wm.__marked_info.type="delete_wire";return tm.movingTooltip(a,"click on a wire to delete",-20,0)},cutWire:function(a){wm.__marked_info.type="cut_wire";return tm.movingTooltip(a,"click on a box of the wire you wish to cut",-20,0)},addLabel:function(a){wm.__marked_info.type=
"add_label_wire";return tm.movingTooltip(a,"click on a box of the wire to add a label to it",-20,0)},toogleWireButtons:function(){var a=$(".wirehandle").filter(function(){return!this.last});BaseGui.showWireButtons=!BaseGui.showWireButtons;if(BaseGui.showWireButtons){a.show();a="hide wire buttons"}else{a.hide();a="show wire buttons"}$("#"+BaseGui.toogleWireButtonsId).val(a)},toogleNeighbourCollision:function(){var a=!wm.__colllisionNeighbours;a=(wm.__colllisionNeighbours=a)&&"turn off collision detection"||
"turn on collision detection";$(this).val(a)}}},moveManager={moveMarked:function(a){if(wm.__marked_info.type!="resize"){var b=wm.__marked_info.obj,c=undefined;if(b!==undefined){c=b.className==="wirehandle"?moveManager._moveWire:moveManager._moveElement;c(b,a)}}},_getNewTopLeft:function(a){return{top:a.pageY-wm.__marked_info.diffY,left:a.pageX-wm.__marked_info.diffX}},_moveElement:function(a,b){var c={top:a.style.top,left:a.style.left},d=moveManager._getNewTopLeft(b).top;b=moveManager._getNewTopLeft(b).left;
a.updatePos(d,b);if(moveManager._collide(a))a.updatePos(c.top,c.left);else{c={x:b-parseInt(c.left),y:d-parseInt(c.top)};moveManager._moveAssocations(a,c)}dbg("_moveElement: moved.id: "+a.id);a.updateRelativePos&&a.updateRelativePos()},_moveAssocations:function(a,b){if(a.connections)for(var c=0,d=a.connections.length;c<d;c++)moveManager._move_wire(b,a.connections[c].btn)},_moveWire:function(a,b){diff={};diff.x=b.pageX-wm.__marked_info.pageX;diff.y=b.pageY-wm.__marked_info.pageY;wm.__marked_info.pageX=
b.pageX;wm.__marked_info.pageY=b.pageY;moveManager._move_wire(diff,a,"one",0)},_update_wire_buttons:function(a){for(var b=0;b<a.btns.length;b++)buttonMaker._setPos(a,a.btns[b],a.btns[b].place)},unprecedented:{active:false,type:undefined,direction:undefined,setActive:function(){this.active=true;var a="undirect";if(wm.__marked_info.obj.className==="wirehandle")a="direct";this.type=a},setNewMargin:function(a,b){if(b==="high"){if(a.wx>=0)moveManager._diff_margin.wx=a.wx;if(a.ex<=0)moveManager._diff_margin.ex=
a.ex}else if(b==="width"){if(a.ny>=0)moveManager._diff_margin.ny=a.ny;if(a.sy<=0)moveManager._diff_margin.ex=a.ex}},clearMargin:function(){moveManager._diff_margin={wx:0,ex:0,ny:0,sy:0}}},_move_wire_by_diff:function(a,b,c,d,e,g){var f=function(k){var l=k==="widehigh"&&"topleft"||"widehigh";if(d.first){d.conn.one.pos=d.place=k;d.nextBtn.conn.one.pos=d.nextBtn.place=l}else if(d.last){d.conn.one.pos=d.place=k;d.prevBtn.conn.two.pos=l}else{if(d.conn.one.wire===a)d.conn.one.pos=d.place=k;else d.conn.two.pos=
k;k=["nextBtn","prevBtn"];for(var m,n=0;n<2;n++){m=k[n];if(d[m].conn.one.wire===a)d[m].conn.one.pos=d[m].place=l;else if(d[m].conn.two.wire===a)d[m].conn.two.pos=l}}};if(!moveManager._check_collide_parent(d,b)){if(a.orientation==="wide"){if(b.x!==0){var i=width=parseInt(a.style.width),h=oldLeft=parseInt(a.style.left);if(c==="topleft"){h+=b.x;width-=b.x}else width+=b.x;if(width<0){width=Math.abs(width);if(c==="topleft"){h=oldLeft+i;a.style.width=width;a.style.left=h;f("widehigh")}else{h=oldLeft-width;
a.style.width=width;a.style.left=h;f("topleft")}}a.style.width=width;a.style.left=h}if(b.y!==0){i=parseInt(a.style.top);a.style.top=parseInt(a.style.top)+b.y;if(e===0){c=undefined;if(g==="next"){c=d.nextBtn;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.two.wire,{x:0,y:b.y},c.conn.two.pos,c,e+1,g)}else if(g==="previous"){c=d.prevBtn;if(c.first||c.last){moveManager._check_collide_parent(c,{x:0,y:b.y});return}moveManager._move_wire_by_diff(c.conn.one.wire,{x:0,y:b.y},c.conn.one.pos,
c,e+1,g)}}}}else{if(b.y!==0){h=oldHeight=parseInt(a.style.height);var j=i=parseInt(a.style.top);if(c==="topleft"){j+=b.y;h-=b.y}else h+=b.y;if(h<0){h=Math.abs(h);if(c==="topleft"){j=i+oldHeight;a.style.height=width;a.style.top=j;f("widehigh")}else{j=i-h;a.style.height=h;a.style.top=j;f("topleft")}}a.style.height=h;a.style.top=j}if(b.x!==0){a.style.left=parseInt(a.style.left)+b.x;if(e===0){c=undefined;if(g==="next"){c=d.nextBtn;if(c.last)return;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.two.wire,
{x:b.x,y:0},c.conn.two.pos,c,e+1,g)}else if(g==="previous"){c=d.prevBtn;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.one.wire,{x:b.x,y:0},c.conn.one.pos,c,e+1,g)}}}}moveManager._update_wire_buttons(a);d.label&&d.label.moveAfterFollowedBtn()}},_diff_margin:{wx:0,ex:0,sy:0,ny:0},_box_difference:function(a,b){if((a.first||a.last)&&a.parentLogic){var c=a.parentNode.style;b={left:parseInt(c.left)+parseInt(a.style.left)+b.x,top:parseInt(c.top)+parseInt(a.style.top)+b.y};b={ne:{x:parseInt(b.left)+
parseInt(a.style.width),y:parseInt(b.top)},sw:{x:parseInt(b.left),y:parseInt(b.top)+parseInt(a.style.height)}};a=a.parentLogic.style;a={ne:{x:parseInt(a.left)+parseInt(a.width),y:parseInt(a.top)},sw:{x:parseInt(a.left),y:parseInt(a.top)+parseInt(a.height)}};return{wx:a.sw.x-b.sw.x,ex:a.ne.x-b.ne.x,sy:a.sw.y-b.sw.y,ny:a.ne.y-b.ne.y}}},_check_collide_parent:function(a,b){if(wm.__marked_info.obj.className==="wirehandle"){if((a.first||a.last)&&a.parentLogic){a=this._box_difference(a,b);if(a.wx>=this._diff_margin.wx)return true;
if(a.ex<=this._diff_margin.ex)return true;if(a.sy<=this._diff_margin.sy)return true;if(a.ny>=this._diff_margin.ny)return true}return false}},_move_wire:function(a,b){var c=b.conn.one.wire,d=b.conn.two.wire;if(!function(e,g){if(e.first||e.last){if(moveManager._check_collide_parent(e,g))return true;return false}for(var f=["prevBtn","nextBtn"],i=0,h=c.orientation==="wide"?0:0;h<2;h++){i=f[h];if((e[i].first||e[i].last)&&e[i].parentLogic)if(e[i].conn.one.wire.orientation==="wide"){if(moveManager._check_collide_parent(e[i],
{x:0,y:g.y}))return true}else if(moveManager._check_collide_parent(e[i],{x:g.x,y:0}))return true}return false}(b,a))if(b.first)moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"next");else if(b.last)moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"previous");else{moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"previous");d&&moveManager._move_wire_by_diff(d,a,b.conn.two.pos,b,0,"next")}},_collide:function(a){if(wm.__colllisionNeighbours)if(collisionDetector.collideWithNeighbours(a))return true;
if(wm.__colllisionParent)if(collisionDetector.collideWithParent(a))return true;return false}},resizer={resizeMarked:function(a){var b=wm.__marked_info.obj,c={top:parseInt(b.style.top),left:parseInt(b.style.left),width:parseInt(b.style.width),height:parseInt(b.style.height)};b.style.width=a.pageX-wm.__marked_info.resizeDiff.left;b.style.height=a.pageY-wm.__marked_info.resizeDiff.top;a=false;if(wm.__colllisionNeighbours)if(collisionDetector.collideWithNeighbours(b))a=true;if(wm.__colllisionParent&&
!a)if(collisionDetector.collideWithParent(b))a=true;if(a||parseInt(b.style.width)<10||parseInt(b.style.height)<10){b.style.width=parseInt(c.width);b.style.height=parseInt(c.height)}b.updatePos(parseInt(b.style.top),parseInt(b.style.left));a||buttonMaker.moveButton(b);b.afterResize&&b.afterResize()}},serializator={serializeAll:function(){var a="{models: "+this._serializeModels();a+=", wires: "+this._serializeWires();a+=",views: "+this._serializeViews();a+=",buttons: "+this._serializeButtons();a+=",connections: "+
this._serializeConnections();a+=",max_id_number: "+idManager.max_id_number;a+="}";return a},_serializeModels:function(){var a="[",b=0;ct.models.foreach(function(){if(b>0)a+=",";a+=serializator._serialize(this.toSerialize());b++});a+="]";return a},_serializeViews:function(){var a="[",b=0;for(var c in viewManager.views)for(var d=0;d<viewManager.views[c].length;d++){var e=viewManager.views[c][d];if(b>0)a+=",";a+=this._serialize(e.toSerialize());b+=1}a+="]";return a},_serializeConnections:function(){var a=
0,b="";for(var c in viewManager.connections){var d=viewManager.connections[c];if(a>0)b+=",";b+=this._serialize(d.toSerialize());a+=1}},_serializeWires:function(){return this._genericSerializeByClass("wire")},_serializeButtons:function(){return this._genericSerializeByClass("wirehandle")},_genericSerializeByClass:function(a){var b="[",c=0;$("."+a).each(function(){if(c>0)b+=",";b+=serializator._serialize(this.toSerialize());c+=1});b+="]";return b},_serialize:function(a){var b="",c=typeof a;if(c==="string")b=
"'"+a+"'";else if(c==="function")b="";else if(c==="number"||c==="boolean")b=a;else if(a instanceof Array){b+="[";for(c=0;c<a.length;c++){if(c>0)b+=",";b+=this._serialize(a[c])}b+="]"}else{b+="{";c=0;for(var d in a){if(c>0)b+=",";b+=d+":"+this._serialize(a[d]);c+=1}b+="}"}return b}},deserializer={restricted_ids:{},deserialize:function(a){var b=ClassDeserializer;idManager.max_id_number=toInt(serialized_data.max_id_number);b.deserializeModels(a.models);b.deserializeViews(a.views);viewManager.redrawAll()}},
createInitialOpts=function(a){a||(a={id:undefined,type:undefined});if(!a.id)a.id=undefined;if(!a.type)a.type=undefined;return a},wdwObj=function(a){a=createInitialOpts(a);if(!a.id)a.id=idManager.getNewId();this.id=a.id;this.type=a.type;this.connections=new Earray;this.addConnection=function(b){this.connections.push(b)};this.removeConnection=function(b){for(var c=0;c<this.connections.length;c++)if(this.connections[c].connection_id===b)break;this.connections.removeAt(c)};if(a.initial){this.id=a.initial.id;
this.type=a.initial.type}},classObj=function(a){wdwObj.call(this,a);this.idxs={properties:0};this.attribs={};this.getParamValue=function(b){return this._getObjVal(this.attribs,b)};this.setClassAttrib=function(b,c){this._setClassParam(this.attribs,b,c)};this.addProperty=function(b,c,d){var e=this.idxs.properties;this.idxs.properties+=1;this.attribs.properties[e]={name:b,type:c,visibility:d}};this.deleteClassParam=function(){};this.deleteMethod=function(b){this.attribs.methods[b]!==undefined&&delete this.attribs.methods[b]};
this.toSerialize=function(){var b=[];this.connections.foreach(function(){b.push({id:this.id,type:this.type,stat:this.stat,connected:this.connected.id})});return{id:this.id,type:this.type,connections:b,attribs:this.attribs,idxs:this.idxs}};this._getObjVal=function(b,c){var d=c.indexOf(".");return d!==-1?this._getObjVal(b[c.substring(0,d)],c.substring(d+1)):b[c]};this._setClassParam=function(b,c,d){var e=c.indexOf(".");if(e!==-1){var g=c.substring(0,e);c=c.substring(e+1);this._setClassParam(b[g],c,
d)}else b[c]=d};if(a.initial){this.idxs=a.initial.idxs;this.attribs=a.initial.attribs}};classObj.prototype=new wdwObj({});var InterfaceModel=function(a){a.type="interface";classObj.call(this,a);if(!a.initial){this.attribs.methods={};this.attribs.interfaceName=defaults.interfaceName}this.getTypeName=function(){return this.attribs.interfaceName}};InterfaceModel.prototype=new classObj({});
var classModel=function(a){classObj.call(this,a);if(a.initial){this.idxs=a.initial.idxs;this.attribs=a.initial.attribs}else{this.attribs.className=defaults.className;this.attribs.properties={};this.attribs.methods={}}this.setClassName=function(b){this.attribs.className=b};this.getTypeName=function(){return this.attribs.className};this.deleteProperty=function(b){if(this.attribs.properties[b]!==undefined)delete this.attribs.properties[b];else dbg("deleteProperty: property with id: "+b+" isn't defined")}};
classModel.prototype=new classObj({});
var modelManager={models:new Earray,_baseTypes:new Earray,initialize:function(){this.models=new Earray;this._baseTypes=cs.getBaseTypes()},getTypes:function(){if(modelManager._baseTypes.length===0)modelManager._baseTypes=cs.getBaseTypes();var a=[];modelManager._baseTypes.foreach(function(){a.push({val:this.id,name:this.getTypeName()})});modelManager.models.foreach(function(){a.push({val:this.id,name:this.getTypeName()})});return a},getType:function(a){for(var b=this.getTypes(),c=0;c<b.length;c++){var d=
b[c];if(d.val===a)return d}return{val:"undefined",name:"type not defined"}},addModel:function(a){this.models.push(a);return a},createWindow:function(a){a=new wdwObj(a);this.models.push(a);return a},getWdwById:function(a){for(var b=0;b<this.models.length;b++)if(this.models[b].id===a)return this.models[b]},getModel:function(a){return this.getWdwById(a)},getObjectsByType:function(a){var b=[];this.models.foreach(function(){this.type===a&&b.push(this)});return b},deleteModel:function(a){for(var b=0;b<
this.models.length;b++)if(this.models[b].id===a)break;if(b===this.models.length-1)this.models.pop();else this.models[b]=this.models.pop()}},ct=modelManager,tm={ttId:undefined,destroyToolTip:function(){dbg("in destroyToolTip");$(document.getElementById(this.ttId)).remove();wm.__marked_info.obj=undefined;document.onmousemove=undefined;wm.__marked_info.type="";this.ttId=undefined},movingTooltip:function(a,b,c,d){if(this.ttId)alert("tooltip already defined");else{a=wm.createWindow({top:a.pageY,left:a.pageX,
width:130,height:60,moveable:false,notResizable:true,className:"add"});this.ttId=a.id;a.innerHTML=b;wm.__marked_info.obj=a;wm.__marked_info.diffX=c;wm.__marked_info.diffY=d;wm.__marked_info.clicks=0;document.onmousemove=moveManager.moveMarked}}},tempIdGenerator={max_id_number:0,getNewId:function(){return 12}},widgetGenerator={input:function(a,b){return'<input style="text" id="'+a+'" value="'+(b&&b||"")+'"/>'},textarea:function(a,b){return'<textarea id="'+a+'" value="'+(b&&b||"")+'" rows="5" cols="20"></textarea>'},
radioSet:function(a,b,c){for(var d="",e=0;e<b.length;e++){var g=b[e],f="";if(c===g.val)f=' checked="true" ';d+='<input type="radio" name="'+a+'" value="'+g.val+'"'+f+"/>"+g.name+"<br/>"}return d},select:function(a,b,c){a='<select id="'+a+'">';for(var d=0;d<b.length;d++){var e=b[d],g="";if(c===e.val)g=' selected="true" ';a+='<option value="'+e.val+'"'+g+">"+e.name+"</option>"}a+="</select>";return a},checkbox:function(a,b,c,d){d=d||"";return'<input class="'+d+'" type="checkbox" id="'+a+'"/>'+c},className:function(a){return this.genericWidgetGenerator("className",
{className:a})},properties:function(a){return this.genericWidgetGenerator("properties",a)},methods:function(a){return this.genericWidgetGenerator("methods",a)},stateDescription:function(a){return this.genericWidgetGenerator("stateDescription",{stateDescription:a})},condition:function(a){return this.genericWidgetGenerator("condition",{condition:a})},interfaceName:function(a){return this.genericWidgetGenerator("interfaceName",{interfaceName:a})},removeElementFromList:function(a){$("#"+a+" > .deleted:first").attr("checked",
"true");$("#"+a).hide()},elementsCounter:0,addElementTxt:function(a,b,c,d,e){var g=this.elementsCounter,f="el"+d+g,i=d+g+"deleted";c='<br/><div id="'+f+'" class="'+c+'">';c+=this.genericWidgetGenerator("",e,widgetDefinition[a][b].elements,d+g);c+=this.checkbox(i,"","","deleted");c+=this.submitButton("widgetGenerator.removeElementFromList",genericgui.getParams(f),"delete");c+="</div>";this.elementsCounter+=1;return c},addElement:function(a,b,c,d,e,g){$("#"+c).append($(this.addElementTxt(a,b,d,e,g)));
$("#"+c).find(".deleted").hide()},genericWidgetGenerator:function(a,b,c,d){var e="",g=widgetDefinition[a];if(c)g=c;d=d&&d||"";for(c=0;c<g.length;c++){var f=g[c],i=b&&b[f.id]||f.def;if(f.type==="input")e+="<span>"+f.description+"</span>"+this.input(d+f.id,i);else if(f.type==="textarea")e+=f.description+this.textarea(d+f.id,i);else if(f.type==="radio"){var h=f.values;if(typeof h==="function")h=h();e+=f.description+"<br/>"+this.radioSet(d+f.name,h,i)}else if(f.type==="select"){h=f.values;if(typeof h===
"function")h=h();e+=f.description+this.select(d+f.id,h,i)}else if(f.type==="list"){var j="id_div"+f.classSelector;e+=this.submitButton("widgetGenerator.addElement",genericgui.getParams(a,c,j,f.classSelector,f.id),"add element");e+=f.description+"<br/>";h=i&&i.length||1;e+='<div id="'+j+'">';for(j=0;j<h;j++)e+=this.addElementTxt(a,c,f.classSelector,f.id,i&&i[j]||undefined);e+="</div>"}e+="<br/>"}return e},submitButton:function(a,b,c){var d="save";if(typeof c==="string")d=c;return'<input type="submit" value="'+
d+'" onclick="'+a+"("+b+');"/>'},cancelButton:function(){return this.submitButton("genericgui.destroyEditAttribForm","","cancel")}},widgetDefinition={className:[{type:"input",id:"className",description:"Class name: "}],properties:[{type:"input",id:"name",description:"Property name: "},{type:"select",id:"type",name:"type",description:"Property type: ",values:modelManager.getTypes},{type:"radio",id:"visibility",description:"Visibility: ",values:defaults.visSet,name:"visibility",def:defaults.propertyVisibility}],
methods:[{type:"input",id:"name",description:"Method name: "},{type:"select",id:"type",name:"type",description:"Method type: ",values:modelManager.getTypes},{type:"radio",id:"visibility",description:"Visibility: ",values:defaults.visSet,name:"visibility",def:defaults.propertyVisibility},{type:"list",id:"parameters",description:"Parameters: ",classSelector:"methodsparams",elements:[{type:"input",id:"name",description:"name"},{type:"select",id:"type",name:"type",description:"Parameter type: ",values:modelManager.getTypes}]}],
stateDescription:[{type:"input",id:"stateDescription",description:"State description: "}],condition:[{type:"textarea",id:"condition",description:"Condition: "}],interfaceName:[{type:"input",id:"interfaceName",description:"Interface name: "}],initialize:function(){this.properties[1].values=modelManager.getTypes()}},valueReader={generic:function(a,b,c){var d=a.indexOf(".");if(d!==-1)a=a.substring(0,d);d={};a=widgetDefinition[a];if(b)a=b;c=c&&c||"";for(b=0;b<a.length;b++){var e=a[b].id;if(a[b].type===
"input")d[e]=$("#"+c+e).val();else if(a[b].type==="textarea")d[e]=$("#"+c+e).val();else if(a[b].type==="radio")d[e]=$("input[name="+c+a[b].name+"]:checked").val();else if(a[b].type==="select")d[e]=$("#"+c+e).val();else if(a[b].type==="list"){d[e]=[];for(var g=widgetGenerator.elementsCounter,f=0,i=0;i<g;i++)if(!$("#"+("el"+e+i)+"> .deleted:first").attr("checked")){d[e][f]=valueReader.generic("",a[b].elements,e+i);f+=1}}}widgetGenerator.elementsCounter=0;return d},noObjectValues:["className","stateDescription",
"condition","interfaceName"]},viewManager={views:{},connections:{},redrawViews:function(a){this.applyForViews(a,function(b){b.redraw()})},addView:function(a,b){var c=false;for(var d in this.views)if(d===a)c=true;c||(this.views[a]=[]);this.views[a].push(b)},applyForViews:function(a,b){for(var c=0;c<this.views[a].length;c++)b(this.views[a][c])},getView:function(a){for(key in this.views)for(var b=0;b<this.views[key].length;b++)if(this.views[key][b].id===a)return this.views[key][b]},getViewsForModel:function(a){return this.views[a]},
addConnection:function(a){this.connections[a.connection_id]=a},removeConnection:function(a){var b=this.connections[a];b.parentLogic.removeConnectionById(b.connection_id);(b.first?b.lastButton():b.firstButton()).parentLogic.removeConnectionById(b.connection_id);this.delete_wire(b);delete this.connections[a]},delete_wire:function(a){a=a.firstButton();for(var b=new Earray;!a.last;){b.push(a.conn.one.wire);a.label&&$(a.label).remove();a=a.nextBtn}b.push(a.conn.one.wire);b.foreach(function(){$(this).remove()})},
deleteModel:function(a){this.applyForViews(a,function(b){for(var c=b.connections.length,d=new Earray,e=0;e<c;e++)d.push(b.connections[e].id);d.foreach(function(){viewManager.removeConnection(this)});delete b.connections;$(b).remove()});delete this.views[a]},redrawAll:function(){for(var a in this.connections)this.connections[a].redraw();for(a in this.views)for(var b=this.views[a],c=0;c<b.length;c++)b[c].redraw()}};
StateModel=function(a){classObj.call(this,a);if(!a.initial)this.attribs.stateDescription=defaults.stateDescription};StateModel.prototype=new classObj({});ConditionalModel=function(a){classObj.call(this,a);if(!a.initial)this.attribs.conditions=defaults.condition};ConditionalModel.prototype=new classObj({});
var makeMoveable=function(a,b){a.updatePos=function(c){return function(d,e){return c.updatePos.call(this,d,e)}}(b);a.getBoundingBox=function(c){return function(){return c.getBoundingBox.call(this)}}(b);if(!a.style.left)a.style.left=0;if(!a.style.top)a.style.top=0;a.style.position="absolute"},createImageView=function(a){a.width=a.width||defaults.asmViewWidth;a.height=a.height||defaults.asmViewHeight;var b=createBaseView(a);b.baseToSerialize=b.toSerialize;b.bgImage="/site_media/"+a.bgImage;$(b.options).remove();
$(b.content).remove();b.realContent=genericgui.createNewDiv();b.realContent.style.position="absolute";b.realContent.style.left=b.realContent.style.top=0;$(b).append($('<img src="'+b.bgImage+'"/>'));b.appendChild(b.realContent);var c=genericgui.createNewDiv();buttonMaker.createMovingBtn(c,5);makeMoveable(c,b);b.realContent.appendChild(c);$(b).find("div:not(.movingDiv):not(.value)").each(function(){this.className=""});$(b).find("hr").remove();$(b).removeClass("orange");b.origClass="";$(b).find(".movingDiv").removeClass("movingDiv").mouseover(function(){this.className=
"movingDiv"}).mouseout(function(){this.className=""});b.divs={holder:c};b.afterResize=function(){var d=this.divs.holder;d.style.top=toInt(b.style.height)/3;d.style.left=toInt(b.style.width)/3;$(b).find("img:first").css({width:b.style.width,height:b.style.height,top:"0px",left:"0px"});this.redraw&&this.redraw()};b.drawBackground=function(){};b.toSerialize=function(){var d=this.baseToSerialize.call(this);d.holder=baseToSerialize(this.divs.holder);return d};if(a.initial){a=a.initial.holder;b.divs.holder.style.top=
a.top;b.divs.holder.style.left=a.left}b.getOptions=function(){return $("<div>").append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),"delete"))).append("<br/>").append(buttonMaker.createConnectBtn(this.id,"connect",wm.connectAsm))};b.afterResize();return b},createStateView=function(a){a.type="state";a.bgImage="state.gif";var b=createImageView(a);a=genericgui.createEditablePropDiv({par:b,cssClass:"stateDiv",value:"state value",desc:""},"stateDescription");
b.divs.holder.appendChild(a);b.redraw=function(){b.drawBackground();var c=modelManager.getModel(this._modelId);$(this).find(".stateDiv:first").children(".value:first").text(c.attribs.stateDescription)};return b},createConditionalView=function(a){a.type="conditional";a.bgImage="condition.gif";var b=createImageView(a);a=genericgui.createEditablePropDiv({par:b,cssClass:"conditionDiv",value:"condition",desc:"",btnText:"Edit contidion"},"condition");b.divs.holder.appendChild(a);b.redraw=function(){b.drawBackground();
var c=modelManager.getModel(this._modelId);$(this).find(".conditionDiv:first").children(".value:first").text(c.attribs.condition)};return b},asmFactory={creator:{model:{createState:function(a){a=a||idManager.getNewId();return new StateModel({id:a,type:"state"})},createConditional:function(a){a=a||idManager.getNewId();return new ConditionalModel({id:a,type:"conditional"})}},view:{createState:function(a){a.width=a.height=100;return createStateView(a)},createConditional:function(a){a.width=a.height=
100;return createConditionalView(a)}}},serializator:{serialize:function(){}},deserializator:{model:{createState:function(a){return new StateModel({initial:a,id:a.id})},createConditional:function(a){return new ConditionalModel({initial:a,id:a.id})}},view:{create_state:function(a){return factory.creator.view.createState({initial:a,model:a.model,id:a.id})},create_conditional:function(a){return factory.creator.view.createConditional({initial:a,model:a.model,id:a.id})}}},gui:{createGui:function(a){var b=
factory.gui.methods,c=BaseGui.createInput;$(c("Add new state")).click(b.newState).appendTo(a);$(c("Add new conditional")).click(b.newConditional).appendTo(a)},methods:{changeState:function(){},defaultViewPos:{top:100,left:100,moveable:true},newState:function(){controller.createNewState(asmFactory.gui.methods.defaultViewPos)},newConditional:function(){controller.createNewConditional(asmFactory.gui.methods.defaultViewPos)}}}};Earray=function(){};
EarrayProt=function(){this.foreach=function(a){for(var b=0;b<this.length;b++)a.call(this[b])};this.remove=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)break;if(b===this.length-1)this.pop();else this[b]=this.pop()};this.removeAt=function(a){if(a>=this.length-1)this.pop();else this[a]=this.pop()}};EarrayProt.prototype=[];Earray.prototype=new EarrayProt;
genericgui={getParams:function(){for(var a=arguments.length,b="",c=0;c<a;c++){var d=arguments[c];if(c!==0)b+=",";if(typeof d===Number)b+=""+d+"";else if(typeof d!=="object")b+="'"+d+"'"}return b},createNewDiv:function(a,b){var c=document.createElement("div");c.id=idManager.getNewId();if(a)c.innerHTML=a;if(b)c.className=b;return c},createEditablePropDiv:function(a,b,c){var d=this.createNewDiv();d.className=a.cssClass;var e=a.desc&&a.desc||"",g=a.btnText||"edit",f="";if(c){buttonMaker.createMovingBtn(d,
5);f="<span>"+e+'</span><span class="value">'+a.value+"</span>";c=this.getParams(a.par._modelId,b);f+=widgetGenerator.submitButton("genericgui.showEditForm",c,g);$(d).append($(f))}else{g=$("<a>").addClass("value").append(a.value).mouseover(function(){$(this).removeClass("normalLink").addClass("hoverLink")}).mouseout(function(){$(this).removeClass("hoverLink").addClass("normalLink")}).click(function(){genericgui.showEditForm(a.par._modelId,b)});$(d).append(a.desc).append(g)}return d},createForm:function(a){a=
a&&a||{};return wm.createWindow({width:a.width||500,height:a.height||500,top:a.top||100,left:a.left||100,className:"add",moveable:a.moveable||true,notResizable:a.notResizable||true})},showEditForm:function(a,b){if(this.attribForm)alert("only one window of editing attribute is allowed at time");else{var c=wm.createWindow({width:500,height:0,top:100,left:100,className:"add",moveable:true,notResizable:true});this.attribForm=c;value=modelManager.getModel(a).getParamValue(b);a=this.getParams(a,b);var d=
b.indexOf("."),e=b;if(d!==-1)e=b.substring(0,d);b=widgetGenerator[e](value);b+="<br/>";b+=widgetGenerator.submitButton("genericgui.saveObjAttrib",a);b+=widgetGenerator.cancelButton();c.appendChild(this.createNewDiv(b,"add"));$(c).find(".deleted").hide()}},saveObjAttrib:function(a,b){a=modelManager.getModel(a);var c=undefined,d=false;for(c=0;c<valueReader.noObjectValues.length;c++)if(b===valueReader.noObjectValues[c])d=true;c=valueReader.generic(b);if(d)c=c[b];if(d=language.checkAttrib(a,b,c))alert(d);
else{a.setClassAttrib(b,c);viewManager.redrawViews(a.id);this.destroyEditAttribForm()}viewManager.redrawAll()},destroyEditAttribForm:function(){if(this.attribForm){$(this.attribForm).remove();this.attribForm=undefined}else dbg("called destroyEditAttribForm when no cmv.attribForm was defined")}};
controller=classController={createNewClass:function(a){var b=factory.creator.createClassModel();modelManager.addModel(b);a.model=b;a=factory.creator.createClassView(a);viewManager.addView(b.id,a);a.redraw()},createNewInterface:function(a){var b=factory.creator.createInterfaceModel();modelManager.addModel(b);a.model=b;a=factory.creator.createInterfaceView(a);viewManager.addView(b.id,a);a.redraw()},createNewState:function(a){return this._genericCreateNewModel("State",a)},createNewConditional:function(a){return this._genericCreateNewModel("Conditional",
a)},_genericCreateNewModel:function(a,b){var c="create"+a;a=factory.creator.model[c]();modelManager.addModel(a);b.model=a;b=factory.creator.view[c](b);viewManager.addView(a.id,b);b.redraw()},deleteModel:function(a){viewManager.deleteModel(a);modelManager.deleteModel(a);viewManager.redrawAll()},deleteProperty:function(a,b){modelManager.getModel(a).deleteProperty(b);viewManager.redrawViews(a)},deleteMethod:function(a,b){modelManager.getModel(a).deleteMethod(b);viewManager.redrawViews(a)},deleteConnectionByBtn:function(){},
deleteConnection:function(a,b,c){a=modelManager.getModel(a);b=modelManager.getModel(b);a.removeConnection(c);b.removeConnection(c);viewManager.removeConnection(c)},addConnection:function(a,b,c,d){a=modelManager.getModel(a);b=modelManager.getModel(b);a.addConnection({connected:b,type:c,id:d,stat:"child"});b.addConnection({connected:a,type:c,id:d,stat:"parent"})}};
InterfaceView=function(a){a.type="interface";a=createBaseView(a);var b=genericgui.createEditablePropDiv({par:a,cssClass:"classNameDiv",value:"new class",desc:""},"interfaceName");a.content.appendChild(b);var c=genericgui.createNewDiv("","propertiesDiv");a.content.appendChild(c);a.divs={interfaceName:b,properties:c};a.getOptions=function(){var d=$("<div>");d.append($(widgetGenerator.submitButton("factory.gui.addMethod",genericgui.getParams(this.id),"add method")));d.append("<br/>");d.append($(widgetGenerator.submitButton("controller.deleteModel",
genericgui.getParams(this._modelId),"delete")));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"iherit",wm.connectInheritance));return d};a.redraw=function(){var d=modelManager.getModel(this._modelId);$(this.divs.interfaceName).children(".value:first").html(d.attribs.interfaceName);var e=$(this.divs.properties);e.html("");for(var g in d.attribs.methods){var f=d.attribs.methods[g];if(typeof f!==undefined){var i=this._modelId,h=modelManager.getType(f.type).name;f=defaults.prefixes[f.visibility]+
f.name+"( "+drawParams(f)+") : "+h;f+="<br/>";i=getOnclickProperty("methods",f,i,g);e.append(i)}}};return a};
createClassView=function(a){a.type="class";a=createBaseView(a);var b=genericgui.createEditablePropDiv({par:a,cssClass:"classNameDiv",value:"new class",desc:""},"className");a.content.appendChild(b);var c=genericgui.createNewDiv("","propertiesDiv");a.content.appendChild(c);a.divs={properties:c,classname:b};a.getOptions=function(){var d=$("<div>");d.append($(widgetGenerator.submitButton("factory.gui.addProperty",genericgui.getParams(this.id),"addProperty")));d.append("<br/>");d.append($(widgetGenerator.submitButton("factory.gui.addMethod",
genericgui.getParams(this.id),"add method")));d.append("<br/>");d.append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),"delete")));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"implement interface",wm.connectInterface));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"iherit",wm.connectInheritance));return d};a.redraw=function(){var d=modelManager.getModel(this._modelId);$("#"+this.divs.classname.id+" > .value").html(d.attribs.className);
var e=$(this.divs.properties);e.html("").append("<hr/>");for(var g in d.attribs.properties){var f=d.attribs.properties[g];if(typeof f!=="undefined"){var i=this._modelId,h=modelManager.getType(f.type).name;h=defaults.prefixes[f.visibility]+f.name+" : "+h;i=getOnclickProperty("properties",h,i,g);e.append(i).append("<br/>")}}e.append("<hr/>");for(g in d.attribs.methods){f=d.attribs.methods[g];if(typeof f!==undefined){i=this._modelId;h=modelManager.getType(f.type).name;h=defaults.prefixes[f.visibility]+
f.name+"( "+drawParams(f)+") : "+h;i=getOnclickProperty("methods",h,i,g);e.append(i).append("<br/>")}}};return a};drawParams=function(a){for(var b="",c=0;c<a.parameters.length;c++){if(c>0)b+=",";var d=a.parameters[c],e=modelManager.getType(d.type).name;b+=d.name+" : "+e}return b};
getOnclickProperty=function(a,b,c,d){b=$("<span>").append(b);b.mouseover(function(){$(this).removeClass("normalLink").addClass("hoverLink")});b.mouseout(function(){$(this).removeClass("hoverLink").addClass("normalLink")});b.get(0).onclick=function(i,h){return function(){return genericgui.showEditForm(i,a+"."+h)}}(c,d);var e=$("<span>").append("delete").addClass("normalBtn").mouseover(function(){$(this).removeClass("normalBtn").addClass("hoverLink")}).mouseout(function(){$(this).removeClass("hoverLink").addClass("normalBtn")});
if(a==="properties")e.click(function(){controller.deleteProperty(c,d)});else a==="methods"&&e.click(function(){controller.deleteMethod(c,d)});for(var g="",f=0;f<5;f++)g+="&nbsp;";return $("<span>").append(b).append(g).append(e)};
factory=classFactory={creator:{model:{},createClassModel:function(a){a||(a=idManager.getNewId());return new classModel({id:a,type:"class"})},createClassView:function(a){a.width=a.height=250;return createClassView(a)},createInterfaceModel:function(a){a||(a=idManager.getNewId());return new InterfaceModel({id:a})},createInterfaceView:function(a){return InterfaceView(a)}},serializator:{serialize:function(){}},deserializator:{createClassModel:function(a){return new classModel({initial:a,id:a.id})},createClassView:function(a){return createClassView({initial:a,
model:a.model,width:a.width,height:a.height,id:a.id})},createInterfaceModel:function(a){return new InterfaceModel({initial:a,model:a.model,id:a.id})},createInterfaceView:function(a){return factory.creator.createInterfaceView({initial:a,model:a.model,id:a.id})}},gui:{addProperty:function(a){return this.genericAdd(a,"properties")},addMethod:function(a){return this.genericAdd(a,"methods")},genericAdd:function(a,b){a=modelManager.getModel(document.getElementById(a)._modelId);var c=[];for(var d in a.attribs[b])c.push(d);
c.sort();for(var e=0,g=0;g<c.length;g++){e=parseInt(d[g])+1;if(a.attribs[b][e]===undefined)break}genericgui.showEditForm(a.id,b+"."+e)},createGui:function(a){var b=factory.gui.methods,c=BaseGui.createInput;$(a).append("Adding/removing class diagram objects:");$(c("Add new class","factory.gui.newClass")).click(b.newClass).appendTo(a);$(c("Add new interface")).click(b.newInterface).appendTo(a)},methods:{newClass:function(){controller.createNewClass({top:200,left:100,moveable:true})},newInterface:function(){controller.createNewInterface({top:200,
left:100,moveable:true})}}}};allowed_connections={implementation:[{0:"class",1:"interface"}],inheritance:[{0:"class",1:"class"}],asm:[{0:"state",1:"state"},{0:"conditional",1:"state"},{0:"state",1:"conditional"}]};
createBaseView=function(a){a.moveable=true;var b=wm.createWindow(a),c=$("#"+b.id+"> .movingDiv:first"),d=c.attr("onmousedown");c.removeAttr("onmousedown").mousedown(function(e){wm._forceInputs||b.hideInputs();d.call(this,e)});b.origClass=b.className;b._modelId=a.model.id;b.connections=new Earray;b.inner=genericgui.createNewDiv("","innerDiv");b.appendChild(b.inner);b.content=genericgui.createNewDiv();b.inner.appendChild(b.content);b.mouseIO=0;b.addConnection=function(e){this.connections.push(e)};b.removeConnection=
function(e){for(var g=0;g<this.connections.length;g++)if(this.connections[g].btn===e)break;if(g===this.connections.length-1)this.connections.pop();else this.connections[g]=this.connections.pop()};b.removeConnectionById=function(e,g){if(g)this.connections.removeAt(g);else{for(g=0;g<this.connections.length;g++)if(this.connections[g].id===e)break;g<this.connections.length&&this.connections.removeAt(g)}};b.callLater=function(e){return function(){if(e.optionsDiv){e.optionsDiv.remove();e.optionsDiv=undefined}}};
b.hideInputs=function(){if(this.optionsDiv)if(!this.interval)this.interval=setTimeout(this.callLater(this),1E3)};b.showInputs=function(){if(this.interval){clearTimeout(this.interval);this.interval=undefined}var e=toInt(this.style.left),g=toInt(this.style.top),f=toInt(this.style.width);toInt(this.style.height);if(this.optionsDiv){this.optionsDiv.remove();clearTimeout(this.interval);this.optionsDiv=this.interval=undefined}this.optionsDiv=$("<div>").append(this.getOptions()).append("<br/>").mouseover(function(){if(this.associatedView.interval){clearTimeout(this.associatedView.interval);
this.associatedView.interval=undefined}}).mouseout(function(){this.associatedView.interval=setTimeout(this.associatedView.callLater(this.associatedView),1E3)}).css({left:e+f,top:g,position:"absolute"}).appendTo("#main_div").fadeIn();this.optionsDiv.get(0).associatedView=this};b.onmouseover=function(){this.mouseIO+=1;var e=wm.__marked_info.type;if(e==="connecting"){this.origClass=this.className;this.className="over"}var g=wm._forceInputs;if(g!=="show")if(g!=="hide")if(!e&&e!=="resize")this.showInputs();
else e==="resize"&&this.hideInputs()};b.onmouseout=function(){this.mouseIO-=1;this.className=this.origClass;var e=wm.__marked_info.type,g=wm._forceInputs;if(g!=="show")if(g!=="hide")if(!e||e==="resize")this.hideInputs()};b.onclick=function(){if(wm.__marked_info.type==="connecting")if(wm.connectedFirstClass===this){viewManager.delete_wire(wm.__marked_info.obj);wm.__marked_info.obj=undefined;wm.__marked_info.type=wm.__marked_info.connection_type=""}else{for(var e=false,g=wm.connectedFirstClass,f=this,
i=allowed_connections[wm.__marked_info.connection_type],h=0;h<i.length;h++)if(i[h][0]===g.type&&i[h][1]===f.type){e=true;break}if(e)if(wm.connectedFirstClass!==this)if(!(wm.__marked_info.connection_type==="implementation"&&this.type!=="interface")){e=wm.__marked_info.obj;g=e.firstButton();f=this._modelId;i=wm.connectedFirstClass._modelId;h=idManager.getNewId();var j=wm.__marked_info.connection_type;g.connection_id=h;g.connection_type=j;this.addConnection({btn:e,id:h});e.parentLogic=this;wm.connectedFirstClass.addConnection({btn:g,
id:h});g.parentLogic=wm.connectedFirstClass;e.redraw();viewManager.addConnection(g);controller.addConnection(i,f,j,h);wm.__marked_info.obj=undefined;wm.__marked_info.type=wm.__marked_info.connection_type=""}}};b.toSerialize=function(){var e=baseToSerialize(this);e.connections=[];this.connections.foreach(function(){e.connections.push({id:this.id,btnid:this.btn.id})});e.modelId=this._modelId;e.type=this.type;return e};if(a.initial){b.style.top=a.initial.top;b.style.left=a.initial.left;b.style.width=
a.initial.width;b.style.height=a.initial.height;b._modelId=a.initial.modelId;b.type=a.initial.type;dbg(document.getElementById(a.initial.id));b.id=a.initial.id}return b};
ClassDeserializer={deserializeModels:function(){for(var a=serialized_data.models,b=0;b<a.length;b++){var c=a[b],d;if(c.type==="class")d=factory.deserializator.createClassModel(c);else if(c.type==="interface")d=factory.deserializator.createInterfaceModel(c);else if(c.type==="state")d=factory.deserializator.model.createState(c);else if(c.type==="conditional")d=factory.deserializator.model.createConditional(c);modelManager.addModel(d)}for(b=0;b<a.length;b++){c=a[b];var e=c.connections;d=modelManager.getModel(c.id);
for(c=0;c<e.length;c++){var g=e[c];g={connected:modelManager.getModel(g.connected),type:g.type,stat:g.stat,id:g.id};d.addConnection(g)}}},deserializeViews:function(){for(var a=serialized_data.views,b=0;b<a.length;b++){var c=a[b];c.model=modelManager.getModel(c.modelId);c=c.type==="class"?factory.deserializator.createClassView(c):c.type==="interface"?factory.deserializator.createInterfaceView(c):factory.deserializator.view["create_"+c.type](c);viewManager.addView(c._modelId,c);c.redraw();c.updatePos(parseInt(c.style.top),
parseInt(c.style.left))}for(b=0;b<serialized_data.wires.length;b++){a=serialized_data.wires[b];a.orientation==="wide"?wm.createHorizontalWire(parseInt(a.left),parseInt(a.left)+parseInt(a.width),parseInt(a.top),a.id):wm.createVerticalWire(parseInt(a.top),parseInt(a.top)+parseInt(a.height),parseInt(a.left),a.id)}for(b=0;b<serialized_data.buttons.length;b++){a=serialized_data.buttons[b];c=document.getElementById(a.conn.one.wire);var d=a.conn.one.pos,e=line2pos=undefined;if(a.conn.two){e=document.getElementById(a.conn.two.wire);
line2pos=a.conn.two.pos}buttonMaker.createWireBtn(c,e,d,d,line2pos,a.id);a.label&&buttonMaker.createLabel({text:a.label.text,btn:document.getElementById(a.id),posRelative:{x:a.label.pos.x,y:a.label.pos.y},width:a.label.base.width,height:a.label.base.height})}for(b=0;b<serialized_data.buttons.length;b++){c=serialized_data.buttons[b];a=document.getElementById(c.id);if(c.first)a.first=true;if(c.last)a.last=true;if(c.parentLogic)a.parentLogic=document.getElementById(c.parentLogic);if(c.connection_id)a.connection_id=
c.connection_id;if(c.connection_type)a.connection_type=c.connection_type;a.nextBtn=document.getElementById(c.nextBtn);a.prevBtn=document.getElementById(c.prevBtn)}for(b=0;b<serialized_data.views.length;b++){c=serialized_data.views[b];for(d=0;d<c.connections.length;d++){e=c.connections[d];a=document.getElementById(e.btnid);a.parentLogic.addConnection({btn:a,id:e.id});a.connection_id&&viewManager.addConnection(a)}}}};
cs={checkPropertyName:function(a,b,c){if(a.length<=2)return"too short";if(c)for(c=0;c<b.idxs.properties;c++)if(b.attribs.properties[c].name===a)return"property with name "+a+" already exists in that class";return""},checkAttrib:function(){return""},getBaseTypes:function(){if(this._type_cache)return this._type_cache;for(var a=new Earray,b=["int","string","double","bool"],c=0;c<b.length;c++){var d=new classModel({});d.attribs.className=b[c];a.push(d)}return this._type_cache=a}};FF_DEBUG=false;
dbg=function(a){FF_DEBUG&&console.log(a)};document.onclick=function(){var a=wm.__marked_info.type;if(a==="moving_wire"){wm.__marked_info.obj.redraw();wm.__marked_info.obj=wm.__marked_info.type=undefined}else if(a==="split_wire"||a==="delete_wire"||a==="cut_wire"||a==="add_label_wire"){wm.__marked_info.clicks+=1;if(wm.__marked_info.clicks===2||wm.__marked_info.clicks>2)tm.destroyToolTip()}else if(a==="down"){wm.__marked_info.obj=undefined;wm.__marked_info.type=undefined}};document.onmouseup=function(){};
types={property:{text:"Property",attribName:"properties"}};
wm={formShown:false,init:function(a,b){document.getElementById("main_div").getBoundingBox=function(){return{ne:{x:500,y:0},sw:{x:0,y:500}}};this.__colllisionNeighbours=b;this.__colllisionParent=a;this.__marked_info={obj:undefined,type:undefined}},markResized:function(a){obj=document.getElementById(a);a=wm.__marked_info.obj=obj;for(var b=document.getElementById("main_div"),c={top:0,left:0};a!==b;){c.top=parseInt(c.top)+parseInt(a.style.top);c.left=parseInt(c.left)+parseInt(a.style.left);a=a.parentNode}wm.__marked_info.resizeDiff=
{top:c.top,left:c.left};wm.__marked_info.type="resize";document.onmousemove=resizer.resizeMarked;document.onmouseup=wm._stopResize},createWindow:function(a){var b=windowCreator._createBaseWindow(a.left,a.top,a.inner,a.parentEl,a.id);if(a.type)b.type=a.type;a.firstObjects&&$(b).append(a.firstObjects);a.moveable?buttonMaker.createMovingBtn(b):this._assignEvents(b);styleManager.setBaseWindowStyle(b,{width:a.width,height:a.height,className:a.className});b.updatePos(parseInt(b.style.top),parseInt(b.style.left));
a.notResizable||buttonMaker.createBtn(b);return b},getPrefixForProp:function(){},createHorizontalWire:function(a,b,c,d){return windowCreator._createJoiningElement(a,b,c,c,d)},createVerticalWire:function(a,b,c,d){return windowCreator._createJoiningElement(c,c,a,b,d)},getConnPoint:function(a){return{x:parseInt(a.style.left)+parseInt(a.style.width)-defaults.wireMovingButtonWidth-10,y:parseInt(a.style.top)+parseInt(a.style.height)/2}},connectInterface:function(a,b){wm.__marked_info.connection_type="implementation";
wm.connect(a,b)},connectInheritance:function(a,b){wm.__marked_info.connection_type="inheritance";wm.connect(a,b)},connectAsm:function(a,b){wm.__marked_info.connection_type="asm";wm.connect(a,b)},connect:function(a,b){if(wm.__marked_info.type!=="connecting"){var c=connector.startConnecting(document.getElementById(b)).line2.btns[0];c.onmousedown(a);a={x:15+a.pageX-(parseInt(c.conn.one.wire.style.left)+parseInt(c.style.left)),y:a.pageY-(parseInt(c.conn.one.wire.style.top)+parseInt(c.style.top))};moveManager._move_wire_by_diff(c.conn.one.wire,
a,c.place,c,0,"previous");wm.__marked_info.type="connecting";wm.connectedFirstClass=viewManager.getView(b)}},__marked_info:{},__over_info:{},__colllisionNeighbours:false,__colllisionParent:false,_forceInputs:undefined,_assignEvents:function(a){a.onmouseover=this._manageMouseOver;a.onmouseout=this._manageMouseOut;a.onmousedown=this._manageMouseDown;document.mouseup=a.onmouseup=this._manageMouseUp},_stopResize:function(){wm.__marked_info.obj=undefined;document.onmousemove=document.onmouseup=undefined;
wm.__marked_info.type=undefined},_manageMouseClick:function(){},_genericManageMouseDown:function(){},_manageMouseDown:function(a){return wm._genericManageMouseDown(a,this)},_manageMouseUp:function(){if(wm.__marked_info.type!=="connecting")if(wm.__marked_info.obj)if(wm.__marked_info.type!=="resize")if(wm.__marked_info.type!=="split_wire")if(wm.__marked_info.type!=="delete_wire"){wm.__marked_info.obj=undefined;wm.__marked_info.type="";document.onmousemove=undefined}},_manageMouseOver:function(){},_manageMouseOut:function(){}};
baseToSerialize=function(a){return{id:a.id,top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height}};
collisionDetector={collideWithNeighbours:function(a){for(var b=0;b<defaults.classesDoesNotCollide.length;b++)if(a.className===defaults.classesDoesNotCollide[b])return false;b=this._getNeighbourDivs(a);a=a.getBoundingBox();for(var c=0;c<b.length;c++)if(b[c].getBoundingBox){var d=b[c].getBoundingBox();if(this._collide(a,d))return true;if(this._collide(d,a))return true}return false},collideWithParent:function(a){for(var b=0;b<defaults.classesDoesNotCollide.length;b++)if(a.className===defaults.classesDoesNotCollide[b])return false;
b=a.parentNode;b={ne:{x:parseInt(b.style.width),y:0},sw:{x:0,y:parseInt(b.style.height)}};a={ne:{x:parseInt(a.style.left)+parseInt(a.style.width),y:parseInt(a.style.top)},sw:{x:parseInt(a.style.left),y:parseInt(a.style.top)+parseInt(a.style.height)}};if(a.ne.x>=b.ne.x)return true;if(a.ne.y<=b.ne.y)return true;if(a.sw.x<=b.sw.x)return true;if(a.sw.y>=b.sw.y)return true;return false},_getNeighbourDivs:function(a){return $(a).parent().children("div").not(".cres").not(".wire").not("#"+a.id).not(".propertiesDiv").not(".add")},
_getBorderingDiv:function(a){return $(a).parent(":not(#main_div)")},_collide:function(a,b){if(a.ne.x>=b.sw.x&&a.ne.x<=b.ne.x){if(a.ne.y<=b.sw.y&&a.ne.y>=b.ne.y)return true;if(a.sw.y<=b.sw.y&&a.sw.y>=b.ne.y)return true}if(a.sw.x>=b.sw.x&&a.sw.x<=b.ne.x){if(a.sw.y>=b.sw.y&&a.sw.y<=b.ne.y)return true;if(a.ne.y<=b.sw.y&&a.ne.y>=b.ne.y)return true}return false}};connection=function(){};
connector={startConnecting:function(a){a=wm.getConnPoint(a);return connector._create_wire_points(a,{x:a.x+100,y:a.y+100})},connectToWdw:function(){},_getPlace:function(a){return{x:parseInt(a.style.left)+parseInt(a.style.width)/2,y:parseInt(a.style.top)+parseInt(a.style.height)/2}},_create_wire:function(a,b){a=this._getPlace(a);b=this._getPlace(b);return connector._create_wire_points(a,b)},_create_wire_points:function(a,b){var c=wm.createHorizontalWire(a.x,b.x,a.y);a=wm.createVerticalWire(a.y,b.y,
b.x);b=buttonMaker.createWireBtn(c,undefined,"topleft","topleft",undefined);var d=buttonMaker.createWireBtn(c,a,"widehigh","widehigh","topleft"),e=buttonMaker.createWireBtn(a,undefined,"widehigh","widehigh",undefined);b.first=true;b.nextBtn=d;d.prevBtn=b;d.nextBtn=e;e.prevBtn=d;e.last=true;return{line1:c,line2:a}},addWire:function(a){var b=a.conn.one.wire;if(b.orientation!=="wide"){var c=a.nextBtn;if(a.last)c=a.prevBtn;return connector.addWire(c)}if(a.first||a.last)alert("cant split wires here");
else{var d=a.conn.two.wire,e=undefined,g=e=40,f={x:undefined,y:undefined};c=a.nextBtn;var i=wire2place=undefined;if(b.orientation==="wide"){i=a.conn.one.pos;wire2place=c.conn.one.pos;f.y=parseInt(d.style.top)+parseInt(d.style.height)-parseInt(b.style.top);if(a.conn.two.pos==="topleft"){e=d;g=b}else{e=b;g=d}f.y=parseInt(e.style.top)+parseInt(e.style.height)-parseInt(g.style.top);if(a.conn.one.pos==="widehigh"){e=d;g=b}else{e=b;g=d}f.x=parseInt(e.style.left)+parseInt(e.style.width)-parseInt(g.style.left)}e=
f.y/2;g=f.x/2;if(b.orientation==="wide"){var h=wire3y=newWire3=undefined,j=newWire2y2=undefined;f=newWire3x2=undefined;if(a.conn.one.pos==="widehigh"){b.style.width=parseInt(b.style.width)-g;h=parseInt(b.style.left)+parseInt(b.style.width);f=parseInt(b.style.left)+parseInt(b.style.width);newWire3x2=parseInt(d.style.left)}else{b.style.left=parseInt(b.style.left)+g;b.style.width=parseInt(b.style.width)-g;h=parseInt(b.style.left);f=parseInt(d.style.left);newWire3x2=parseInt(b.style.left)}moveManager._update_wire_buttons(b);
if(a.conn.two.pos==="topleft"){d.style.top=parseInt(d.style.top)+e;d.style.height=parseInt(d.style.height)-e;wire3y=parseInt(d.style.top);j=parseInt(b.style.top);newWire2y2=j+e}else{d.style.height=parseInt(d.style.height)-e;wire3y=parseInt(d.style.top)+parseInt(d.style.height);j=parseInt(d.style.top)+parseInt(d.style.height);newWire2y2=parseInt(b.style.top)}moveManager._update_wire_buttons(d);e=wm.createVerticalWire(j,newWire2y2,h);newWire3=wm.createHorizontalWire(f,newWire3x2,wire3y);f=a.conn.two.pos;
b=buttonMaker.createWireBtn(e,newWire3,wire2place,wire2place,a.conn.one.pos==="widehigh"&&"topleft"||"widehigh");d=buttonMaker.createWireBtn(newWire3,d,i,i,f);if(a.last){a.last=undefined;newBtn4.last=true}c.prevBtn=d;d.prevBtn=b;d.nextBtn=c;b.nextBtn=d;b.prevBtn=a;a.conn.two.wire=e;a.nextBtn=b}}},_create_assocation:function(){},_connect_assocation:function(){},connect:function(a,b){var c=this._create_wire(a,b);this._create_assocation(a,c.line1,b);this._create_assocation(b,c.line2,a);this.addWire(c.line1.btns[1])}};
styleManager={setBaseWindowStyle:function(a,b){this._baseSetStyle(a,b.width,b.height);a.className=b.className||defaults.windowClassName},setWireStyle:function(a,b,c){this._baseSetStyle(a,b,c);a.className="wire"},_baseSetStyle:function(a,b,c){if(typeof b==="undefined")b=defaults.windowWidth;if(typeof c==="undefined")c=defaults.windowHeight;a.style.position="absolute";a.style.width=b;a.style.height=c}};toInt=function(a){return parseInt(a,10)};
buttonMaker={height:15,width:15,moveButton:function(a){var b=document.getElementById("r"+a.id);buttonMaker._setPos(a,b,"widehigh")},showLabelForm:function(a,b,c){a=document.getElementById(a);var d=genericgui.createForm({height:5});d.id=idManager.getNewId();var e="Enter label here: ";e+=widgetGenerator.input("idlabel",a.label_text||defaults.wireLabel);e+="<br/>";e+=widgetGenerator.submitButton(b,genericgui.getParams(a.id,d.id),c||"Add label");e+=widgetGenerator.submitButton("buttonMaker.closeLabelForm",
genericgui.getParams(d.id),"cancel");e+="<br/>";e+="<br/>";d.appendChild(genericgui.createNewDiv(e,"add",true))},addLabel:function(a,b){this.createLabel({btn:document.getElementById(a),text:$("#idlabel").val()});buttonMaker.closeLabelForm(b)},editLabel:function(a,b){a=document.getElementById(a);var c=$("#idlabel").val();a.label_text=c;$(a.label).find(".inner:first").html(c);a.label.label_text=c;buttonMaker.closeLabelForm(b)},removeLabel:function(a){a=document.getElementById(a);delete a.btn.label;
$(a).remove()},createLabel:function(a){var b=wm.createWindow({type:"label",width:a.width&&a.width||defaults.wireLabelWidth,height:a.height&&a.height||defaults.wireLabelHeight,top:100,left:100,className:"buttonlabel",moveable:true,notResizable:false});b.btn=a.btn;b.updateRelativePos=function(){this.posX=toInt(this.style.left)-this.btn.getAbsolutePos().x;this.posY=toInt(this.style.top)-this.btn.getAbsolutePos().y};b.moveAfterFollowedBtn=function(){b.style.left=a.btn.getAbsolutePos().x+b.posX;b.style.top=
a.btn.getAbsolutePos().y+b.posY};$(b).append($('<span class="inner">'+a.text+"</span>")).append($(widgetGenerator.submitButton("buttonMaker.removeLabel",genericgui.getParams(b.id),"delete"))).append($(widgetGenerator.submitButton("buttonMaker.showLabelForm",genericgui.getParams(a.btn.id,"buttonMaker.editLabel","save"),"edit")));b.label_text=a.text;if(a.posRelative){b.posX=a.posRelative.x;b.posY=a.posRelative.y}else{b.posX=defaults.wireLabelDiffX;b.posY=defaults.wireLabelDiffY}b.moveAfterFollowedBtn();
b.onmouseover=function(){wm._forceInputs||wm.__marked_info.type||$(this).find("input").show()};b.onmouseout=function(){wm._forceInputs||wm.__marked_info.type||$(this).find("input").hide()};a.btn.label=b;b.updateRelativePos();b.onmouseout();document.getElementById("main_div").appendChild(b)},closeLabelForm:function(a){$("#"+a).remove()},createBtn:function(a){var b=this._getStyleTxt("silver",defaults.resizeButtonWidth,defaults.resizeButtonHeight),c='<div class="cres"';c+=' id="r'+a.id+'"';c+=' style="'+
b+'"';c+='" onmousedown="wm.markResized(\''+a.id+"')\"";c+="</div>";$(a).append(c);this._setPos(a,document.getElementById("r"+a.id),"widehigh")},createWireBtn:function(a,b,c,d,e,g){g=this._createWireBtnHtml(a,g);$(a).append(g.txt);g=document.getElementById(g.id);g._parent=a;this._setPos(g._parent,g,c);g.place=c;g.conn={};g.conn.one={};g.conn.one.pos=d;g.conn.one.wire=a;g.conn.two={};g.conn.two.pos=e;g.conn.two.wire=b;a.btns.push(g);g.getAbsolutePos=function(){return{x:toInt(this.style.left)+toInt(this.parentNode.style.left),
y:toInt(this.style.top)+toInt(this.parentNode.style.top)}};g.getDataToCopy=function(f){for(var i=["first","last","parentLogic","label"],h=0;h<i.length;h++)if(this[i[h]])f[i[h]]=this[i[h]];if(this.first){f.connection_id=this.connection_id;f.connection_type=this.connection_type}};g.onmousedown=wm._manageMouseDown;g.onmouseup=function(){this.redraw();if(wm.__marked_info.type==="moving_wire")wm.__marked_info.obj=wm.__marked_info.type=undefined};g.onmouseover=function(){var f=wm.__marked_info.type;if(f===
"split_wire"||f==="delete_wire"||f==="cut_wire"||f==="add_label_wire"){f=defaults.wireMovingButtonWidth;var i=defaults.wireMovingButtonHeight,h=3;if(this.last){i=f=defaults.wireMovingButtonEndWidth;h=2}this.style.width=h*f;this.style.height=h*i}};g.onmouseout=function(){var f=wm.__marked_info.type;if(f==="split_wire"||f==="delete_wire"||f==="cut_wire"||f==="add_label_wire")if(this.last){this.style.width=defaults.wireMovingButtonEndWidth;this.style.height=defaults.wireMovingButtonEndHeight}else{this.style.width=
defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonHeight}};g.onclick=function(){var f=wm.__marked_info.type;if(f==="split_wire"){this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonHeight;connector.addWire(this);this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;tm.destroyToolTip()}else if(f==="delete_wire"){f=this.firstButton();var i=this.lastButton();controller.deleteConnection(f.parentLogic._modelId,
i.parentLogic._modelId,f.connection_id);tm.destroyToolTip()}else if(f!=="change_connection_type")if(f==="add_label_wire"){this.label?alert("This button already has a label. To add new label, please remove the existing one."):buttonMaker.showLabelForm(this.id,"buttonMaker.addLabel");this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;tm.destroyToolTip()}else if(f==="cut_wire"){this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;
if(!this.first&&!this.last)alert("can cut only first and last button");else{if(this.first){f=this;for(var h=0;h<2;h++)f=f.nextBtn;if(f.last){alert("too little boxes");return}}else{f=this;for(h=0;h<2;h++)f=f.prevBtn;if(f.first){alert("too little boxes");return}}var j=h=undefined;f=undefined;var k=0,l=0;if(this.conn.one.wire.orientation==="high"){h="nextBtn";j="prevBtn";f="two";if(this.last){h="prevBtn";j="nextBtn";f="one"}k=toInt(this.conn.one.wire.style.height)}else{h="nextBtn";j="prevBtn";f="two";
if(this.last){h="prevBtn";j="nextBtn";f="one"}l=toInt(this.conn.one.wire.style.width)}i=this[h];var m=this[h][h];if(this.conn.one.pos!=="widehigh"){k=-k;l=-l}moveManager._move_wire({x:l,y:k},m);k=buttonMaker.createWireBtn(i.conn[f].wire,undefined,i.conn[f].pos,i.conn[f].pos,undefined);this.getDataToCopy(k);k[h]=m;k[j]=undefined;m[j]=k;for(h=0;h<this.parentLogic.connections.length;h++)if(this.parentLogic.connections[h].btn.id===this.id)break;this.parentLogic.connections[h]={btn:k};i.conn[f].wire.appendChild(k);
buttonMaker._setPos(k.conn.one.wire,k,k.place);$(this.conn.one.wire).remove();$(i).remove();k.redraw()}}};g.onmousedown=function(f){if(wm.__marked_info.type!="resize")if(!wm.__marked_info.obj){wm.__marked_info.type="moving_wire";wm.__marked_info.obj=this;wm.__marked_info.top=this._parent.style.top;wm.__marked_info.left=this._parent.style.left;wm.__marked_info.pageX=f.pageX;wm.__marked_info.pageY=f.pageY;wm.__marked_info.diffX=f.pageX-toInt(this.style.left);wm.__marked_info.diffY=f.pageY-toInt(this.style.top);
document.onmousemove=moveManager.moveMarked}};g.toSerialize=function(){var f=baseToSerialize(this);f.parentNodeId=this.parentNode.id;f.conn={one:{wire:this.conn.one.wire.id,pos:this.conn.one.pos}};if(this.conn.two.wire)f.conn.two={wire:this.conn.two.wire.id,pos:this.conn.two.pos};if(this.nextBtn)f.nextBtn=this.nextBtn.id;if(this.prevBtn)f.prevBtn=this.prevBtn.id;if(this.first){f.first=true;f.connection_id=this.connection_id;f.connection_type=this.connection_type}if(this.last)f.last=true;if(this.parentLogic)f.parentLogic=
this.parentLogic.id;if(this.label){var i=this.label;f.label={text:i.label_text,pos:{x:i.posX,y:i.posY},base:baseToSerialize(this.label)}}return f};g.firstButton=function(){for(var f=this;!f.first;)f=f.prevBtn;return f};g.lastButton=function(){for(var f=this;!f.last;)f=f.nextBtn;return f};g.redraw=function(){var f=this.firstButton().connection_type,i=this.lastButton();i.drawSign(f);buttonMaker._setPos(i.conn.one.wire,i,i.conn.one.pos);(f=moveManager._box_difference(this,{x:0,y:0}))&&f.wx>=0&&dbg("error during redrawing wire btn")};
g.drawSign=function(f){this.style.width=this.style.height=1;f="/site_media/"+f+this.conn.one.pos.substring(0,3)+this.conn.one.wire.orientation.substring(0,3)+".png";var i=0,h=0;if(this.conn.one.wire.orientation==="wide"){i=-(defaults.arrowSize/2);h=0}else{i=0;h=-(defaults.arrowSize/2)}h=h.toString();i=i.toString();f=$('<img src="'+f+'"/>').css({left:h,top:i,position:"absolute"});$(this).children().remove();this.appendChild(f.get(0));f.click(function(j){return function(k){return j.onclick(k)}}(this)).mouseover(function(j){return function(k){j.onmouseover(k)}}(this))};
return g},createMovingBtn:function(a,b){var c=document.createElement("div");c.id=idManager.getNewId();c.className="movingDiv";c.style.height=b||defaults.movingBtnHeight;c.style.width="100%";c.style.left=0;c.style.top=0;c.getBoundingBox=function(){return{ne:{x:toInt(this.style.left)+toInt(this.style.width),y:toInt(this.style.top)},sw:{x:toInt(this.style.left),y:toInt(this.style.top)+toInt(this.style.height)}}};c._parent=a;wm._assignEvents(c);c.onmousedown=function(d){if(wm.__marked_info.type!="resize")if(!wm.__marked_info.obj){wm.__marked_info.type=
"down";wm.__marked_info.top=this._parent.style.top;wm.__marked_info.left=this._parent.style.left;var e=wm.__marked_info.obj=this._parent;wm.__marked_info.diffX=d.pageX-toInt(e.style.left);wm.__marked_info.diffY=d.pageY-toInt(e.style.top);document.onmousemove=moveManager.moveMarked}};c.onmouseup=document.onmouseup;c.onclick=document.onclick;a.appendChild(c)},createConnectBtn:function(a,b,c){return $("<button>"+b+"</button>").click(function(d){return c(d,a)})},_getStyleTxt:function(a,b,c){b="width: "+
b+"px; height: "+c+"px;";b+=" position: absolute; background: "+a;return b},_createWireBtnHtml:function(a,b){a='<div class="wirehandle"';var c=this._getStyleTxt(defaults.wireBtnColor,defaults.wireMovingButtonWidth,defaults.wireMovingButtonHeight),d=undefined;d=b?b:idManager.getNewId();a+=' id="'+d+'"';a+=' style="'+c+'"';a+="</div>";return{txt:a,id:d}},_setPos:function(a,b,c){var d=0,e=0;if(c==="widehigh"){d=toInt(a.style.width)-toInt(b.style.width);e=toInt(a.style.height)-toInt(b.style.height)}b.style.top=
e;b.style.left=d}};idManager={max_id_number:0,prefix:"i",getNewId:function(){this.max_id_number+=1;if(document.getElementById(this.prefix+this.max_id_number)){dbg("znalazlem !!");dbg(this.max_id_number)}return this.prefix+this.max_id_number}};
defaults={windowWidth:100,windowHeight:100,wireSize:1,windowClassName:"orange",resizeButtonWidth:15,resizeButtonHeight:15,movingBtnHeight:10,wireBtnColor:"silver",asmViewWidth:100,asmViewHeight:100,wireMovingButtonWidth:10,wireMovingButtonHeight:10,wireMovingButtonEndWidth:30,wireMovingButtonEndHeight:30,wireLabel:"Enter label here",wireLabelDiffX:30,wireLabelDiffY:0,wireLabelWidth:100,wireLabelHeight:100,arrowSize:30,stateDescription:"New state",condition:"enter your condition here",classesDoesNotCollide:["add"],
propertyVisibility:"protected",className:"New class name",interfaceName:"New interface",prefixes:{"private":"-","public":"+","protected":"#"},visSet:[{name:"public",val:"public"},{name:"protected",val:"protected"},{name:"private",val:"private"}]};
initialize=function(){var a={1:classFactory,2:asmFactory};language=cs;wm.init(false,false);modelManager.initialize();factory=a[window.diagramData.type];window.diagramData.load&&deserializer.deserialize(window.serialized_data);document.getElementById("main_div").classes=[];BaseGui.createGui($("#userGui > #genericGui"),diagramData.read_only);factory.gui.createGui($("#userGui > #specificGui"))};
windowCreator={_createJoiningElement:function(a,b,c,d,e){var g=defaults.wireSize;e=this._createBaseWindow(a,c,"",undefined,e);var f=Math.abs(b-a),i=Math.abs(d-c),h=e.orientation=f<i&&"high"||"wide",j=undefined,k=undefined;if(h==="wide"){j=f;k=g}else{j=g;k=i}e.zwrot=h==="wide"?b<a?"left":"right":d-c<0?"up":"down";e.btns=[];styleManager.setWireStyle(e,j,k);e.toSerialize=function(){var l=baseToSerialize(this);l.orientation=this.orientation;return l};e.addButton=function(l){this.btns.push(l)};e.onmousedown=
function(){};return e},_createBaseWindow:function(a,b,c,d,e){var g=document.createElement("div");g.innerHTML=c||"";g.id=typeof e==="string"?e:idManager.getNewId();g.connections={assocation:[]};g._cached_pos={top:0,left:0};g.getBoundingBox=function(){return this._cached_bounding_box};g.updatePos=function(f,i){this.style.top=f;this.style.left=i;this._cached_bounding_box={ne:{x:parseInt(i)+parseInt(this.style.width),y:parseInt(this.style.top)},sw:{x:parseInt(this.style.left),y:parseInt(f)+parseInt(this.style.height)}}};
if(typeof a!=="undefined"&&typeof b!=="undefined"){g.style.top=b||b+"px";g.style.left=a||a+"px"}a=d||document.getElementById("main_div");a.appendChild(g);g._parent=a;return g}};
BaseGui={showInputs:true,showWireButtons:true,createInput:function(a){return'<input type="submit" value="'+a+'"/>'},changeModeId:undefined,createGui:function(a,b){var c=function(j){return'<div id="'+j+'" />'},d={state:0,getNewId:function(){this.state+=1;return"guiid"+this.state}},e=BaseGui.methods,g=BaseGui.createInput,f=d.getNewId(),i=d.getNewId(),h=d.getNewId();$(a).append(c(f)).append(c(i)).append(c(h));a=$("#"+f);i=$("#"+i);h=$("#"+h);a.append("<span>Managing wires: </span>");a.append($(g("Split wire")).click(e.splitWire));
a.append($(g("Delete wire")).click(e.deleteWire));a.append($(g("Cut wire")).click(e.cutWire));a.append($(g("add label to wire")).click(e.addLabel));a=$(g("hide wire buttons")).click(e.toogleWireButtons);$(a).attr("id",d.getNewId());BaseGui.toogleWireButtonsId=$(a).attr("id");d=$(g("turn collision neighbour objects on")).click(e.toogleNeighbourCollision);wm.__colllisionNeighbours=true;d.click(undefined);i.append("<span>Visibility/behaviour:</span>");i.append(a).append(d);$("#main_div").find("input").hide();
d=$(g("save")).click(function(){$("#idSerializedData").val(serializator.serializeAll());$("#save_form").submit()});if(b)d=$("");h.append("<span>File options:</span>").append(d).append($(g("close")).click(function(){window.location=project_id==-1?"/demo_choose_type/":"/project/"+project_id+"/"}))},methods:{splitWire:function(a){wm.__marked_info.type="split_wire";return tm.movingTooltip(a,"click on box on wire to split that wire",-3*defaults.wireMovingButtonWidth,0)},deleteWire:function(a){wm.__marked_info.type=
"delete_wire";return tm.movingTooltip(a,"click on a wire to delete",-20,0)},cutWire:function(a){wm.__marked_info.type="cut_wire";return tm.movingTooltip(a,"click on a box of the wire you wish to cut",-20,0)},addLabel:function(a){wm.__marked_info.type="add_label_wire";return tm.movingTooltip(a,"click on a box of the wire to add a label to it",-20,0)},toogleWireButtons:function(){var a=$(".wirehandle").filter(function(){return!this.last});BaseGui.showWireButtons=!BaseGui.showWireButtons;if(BaseGui.showWireButtons){a.show();
a="hide wire buttons"}else{a.hide();a="show wire buttons"}$("#"+BaseGui.toogleWireButtonsId).val(a)},toogleNeighbourCollision:function(){var a=!wm.__colllisionNeighbours;a=(wm.__colllisionNeighbours=a)&&"turn off collision detection"||"turn on collision detection";$(this).val(a)}}};
moveManager={moveMarked:function(a){if(wm.__marked_info.type!="resize"){var b=wm.__marked_info.obj,c=undefined;if(b!==undefined){c=b.className==="wirehandle"?moveManager._moveWire:moveManager._moveElement;c(b,a)}}},_getNewTopLeft:function(a){return{top:a.pageY-wm.__marked_info.diffY,left:a.pageX-wm.__marked_info.diffX}},_moveElement:function(a,b){var c={top:a.style.top,left:a.style.left},d=moveManager._getNewTopLeft(b).top;b=moveManager._getNewTopLeft(b).left;a.updatePos(d,b);if(moveManager._collide(a))a.updatePos(c.top,
c.left);else{c={x:b-parseInt(c.left),y:d-parseInt(c.top)};moveManager._moveAssocations(a,c)}dbg("_moveElement: moved.id: "+a.id);a.updateRelativePos&&a.updateRelativePos()},_moveAssocations:function(a,b){if(a.connections)for(var c=0,d=a.connections.length;c<d;c++)moveManager._move_wire(b,a.connections[c].btn)},_moveWire:function(a,b){diff={};diff.x=b.pageX-wm.__marked_info.pageX;diff.y=b.pageY-wm.__marked_info.pageY;wm.__marked_info.pageX=b.pageX;wm.__marked_info.pageY=b.pageY;moveManager._move_wire(diff,
a,"one",0)},_update_wire_buttons:function(a){for(var b=0;b<a.btns.length;b++)buttonMaker._setPos(a,a.btns[b],a.btns[b].place)},unprecedented:{active:false,type:undefined,direction:undefined,setActive:function(){this.active=true;var a="undirect";if(wm.__marked_info.obj.className==="wirehandle")a="direct";this.type=a},setNewMargin:function(a,b){if(b==="high"){if(a.wx>=0)moveManager._diff_margin.wx=a.wx;if(a.ex<=0)moveManager._diff_margin.ex=a.ex}else if(b==="width"){if(a.ny>=0)moveManager._diff_margin.ny=
a.ny;if(a.sy<=0)moveManager._diff_margin.ex=a.ex}},clearMargin:function(){moveManager._diff_margin={wx:0,ex:0,ny:0,sy:0}}},_move_wire_by_diff:function(a,b,c,d,e,g){var f=function(k){var l=k==="widehigh"&&"topleft"||"widehigh";if(d.first){d.conn.one.pos=d.place=k;d.nextBtn.conn.one.pos=d.nextBtn.place=l}else if(d.last){d.conn.one.pos=d.place=k;d.prevBtn.conn.two.pos=l}else{if(d.conn.one.wire===a)d.conn.one.pos=d.place=k;else d.conn.two.pos=k;k=["nextBtn","prevBtn"];for(var m,n=0;n<2;n++){m=k[n];if(d[m].conn.one.wire===
a)d[m].conn.one.pos=d[m].place=l;else if(d[m].conn.two.wire===a)d[m].conn.two.pos=l}}};if(!moveManager._check_collide_parent(d,b)){if(a.orientation==="wide"){if(b.x!==0){var i=width=parseInt(a.style.width),h=oldLeft=parseInt(a.style.left);if(c==="topleft"){h+=b.x;width-=b.x}else width+=b.x;if(width<0){width=Math.abs(width);if(c==="topleft"){h=oldLeft+i;a.style.width=width;a.style.left=h;f("widehigh")}else{h=oldLeft-width;a.style.width=width;a.style.left=h;f("topleft")}}a.style.width=width;a.style.left=
h}if(b.y!==0){i=parseInt(a.style.top);a.style.top=parseInt(a.style.top)+b.y;if(e===0){c=undefined;if(g==="next"){c=d.nextBtn;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.two.wire,{x:0,y:b.y},c.conn.two.pos,c,e+1,g)}else if(g==="previous"){c=d.prevBtn;if(c.first||c.last){moveManager._check_collide_parent(c,{x:0,y:b.y});return}moveManager._move_wire_by_diff(c.conn.one.wire,{x:0,y:b.y},c.conn.one.pos,c,e+1,g)}}}}else{if(b.y!==0){h=oldHeight=parseInt(a.style.height);var j=i=parseInt(a.style.top);
if(c==="topleft"){j+=b.y;h-=b.y}else h+=b.y;if(h<0){h=Math.abs(h);if(c==="topleft"){j=i+oldHeight;a.style.height=width;a.style.top=j;f("widehigh")}else{j=i-h;a.style.height=h;a.style.top=j;f("topleft")}}a.style.height=h;a.style.top=j}if(b.x!==0){a.style.left=parseInt(a.style.left)+b.x;if(e===0){c=undefined;if(g==="next"){c=d.nextBtn;if(c.last)return;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.two.wire,{x:b.x,y:0},c.conn.two.pos,c,e+1,g)}else if(g==="previous"){c=d.prevBtn;if(c.last||
c.first)return;moveManager._move_wire_by_diff(c.conn.one.wire,{x:b.x,y:0},c.conn.one.pos,c,e+1,g)}}}}moveManager._update_wire_buttons(a);d.label&&d.label.moveAfterFollowedBtn()}},_diff_margin:{wx:0,ex:0,sy:0,ny:0},_box_difference:function(a,b){if((a.first||a.last)&&a.parentLogic){var c=a.parentNode.style;b={left:parseInt(c.left)+parseInt(a.style.left)+b.x,top:parseInt(c.top)+parseInt(a.style.top)+b.y};b={ne:{x:parseInt(b.left)+parseInt(a.style.width),y:parseInt(b.top)},sw:{x:parseInt(b.left),y:parseInt(b.top)+
parseInt(a.style.height)}};a=a.parentLogic.style;a={ne:{x:parseInt(a.left)+parseInt(a.width),y:parseInt(a.top)},sw:{x:parseInt(a.left),y:parseInt(a.top)+parseInt(a.height)}};return{wx:a.sw.x-b.sw.x,ex:a.ne.x-b.ne.x,sy:a.sw.y-b.sw.y,ny:a.ne.y-b.ne.y}}},_check_collide_parent:function(a,b){if(wm.__marked_info.obj.className==="wirehandle"){if((a.first||a.last)&&a.parentLogic){a=this._box_difference(a,b);if(a.wx>=this._diff_margin.wx)return true;if(a.ex<=this._diff_margin.ex)return true;if(a.sy<=this._diff_margin.sy)return true;
if(a.ny>=this._diff_margin.ny)return true}return false}},_move_wire:function(a,b){var c=b.conn.one.wire,d=b.conn.two.wire;if(!function(e,g){if(e.first||e.last){if(moveManager._check_collide_parent(e,g))return true;return false}for(var f=["prevBtn","nextBtn"],i=0,h=c.orientation==="wide"?0:0;h<2;h++){i=f[h];if((e[i].first||e[i].last)&&e[i].parentLogic)if(e[i].conn.one.wire.orientation==="wide"){if(moveManager._check_collide_parent(e[i],{x:0,y:g.y}))return true}else if(moveManager._check_collide_parent(e[i],
{x:g.x,y:0}))return true}return false}(b,a))if(b.first)moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"next");else if(b.last)moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"previous");else{moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"previous");d&&moveManager._move_wire_by_diff(d,a,b.conn.two.pos,b,0,"next")}},_collide:function(a){if(wm.__colllisionNeighbours)if(collisionDetector.collideWithNeighbours(a))return true;if(wm.__colllisionParent)if(collisionDetector.collideWithParent(a))return true;
return false}};
resizer={resizeMarked:function(a){var b=wm.__marked_info.obj,c={top:parseInt(b.style.top),left:parseInt(b.style.left),width:parseInt(b.style.width),height:parseInt(b.style.height)};b.style.width=a.pageX-wm.__marked_info.resizeDiff.left;b.style.height=a.pageY-wm.__marked_info.resizeDiff.top;a=false;if(wm.__colllisionNeighbours)if(collisionDetector.collideWithNeighbours(b))a=true;if(wm.__colllisionParent&&!a)if(collisionDetector.collideWithParent(b))a=true;if(a||parseInt(b.style.width)<10||parseInt(b.style.height)<
10){b.style.width=parseInt(c.width);b.style.height=parseInt(c.height)}b.updatePos(parseInt(b.style.top),parseInt(b.style.left));a||buttonMaker.moveButton(b);b.afterResize&&b.afterResize()}};
serializator={serializeAll:function(){var a="{models: "+this._serializeModels();a+=", wires: "+this._serializeWires();a+=",views: "+this._serializeViews();a+=",buttons: "+this._serializeButtons();a+=",connections: "+this._serializeConnections();a+=",max_id_number: "+idManager.max_id_number;a+="}";return a},_serializeModels:function(){var a="[",b=0;ct.models.foreach(function(){if(b>0)a+=",";a+=serializator._serialize(this.toSerialize());b++});a+="]";return a},_serializeViews:function(){var a="[",b=
0;for(var c in viewManager.views)for(var d=0;d<viewManager.views[c].length;d++){var e=viewManager.views[c][d];if(b>0)a+=",";a+=this._serialize(e.toSerialize());b+=1}a+="]";return a},_serializeConnections:function(){var a=0,b="";for(var c in viewManager.connections){var d=viewManager.connections[c];if(a>0)b+=",";b+=this._serialize(d.toSerialize());a+=1}},_serializeWires:function(){return this._genericSerializeByClass("wire")},_serializeButtons:function(){return this._genericSerializeByClass("wirehandle")},
_genericSerializeByClass:function(a){var b="[",c=0;$("."+a).each(function(){if(c>0)b+=",";b+=serializator._serialize(this.toSerialize());c+=1});b+="]";return b},_serialize:function(a){var b="",c=typeof a;if(c==="string")b="'"+a+"'";else if(c==="function")b="";else if(c==="number"||c==="boolean")b=a;else if(a instanceof Array){b+="[";for(c=0;c<a.length;c++){if(c>0)b+=",";b+=this._serialize(a[c])}b+="]"}else{b+="{";c=0;for(var d in a){if(c>0)b+=",";b+=d+":"+this._serialize(a[d]);c+=1}b+="}"}return b}};
deserializer={restricted_ids:{},deserialize:function(a){var b=ClassDeserializer;idManager.max_id_number=toInt(serialized_data.max_id_number);b.deserializeModels(a.models);b.deserializeViews(a.views);viewManager.redrawAll()}};createInitialOpts=function(a){a||(a={id:undefined,type:undefined});if(!a.id)a.id=undefined;if(!a.type)a.type=undefined;return a};
wdwObj=function(a){a=createInitialOpts(a);if(!a.id)a.id=idManager.getNewId();this.id=a.id;this.type=a.type;this.connections=new Earray;this.addConnection=function(b){this.connections.push(b)};this.removeConnection=function(b){for(var c=0;c<this.connections.length;c++)if(this.connections[c].connection_id===b)break;this.connections.removeAt(c)};if(a.initial){this.id=a.initial.id;this.type=a.initial.type}};
classObj=function(a){wdwObj.call(this,a);this.idxs={properties:0};this.attribs={};this.getParamValue=function(b){return this._getObjVal(this.attribs,b)};this.setClassAttrib=function(b,c){this._setClassParam(this.attribs,b,c)};this.addProperty=function(b,c,d){var e=this.idxs.properties;this.idxs.properties+=1;this.attribs.properties[e]={name:b,type:c,visibility:d}};this.deleteClassParam=function(){};this.deleteMethod=function(b){this.attribs.methods[b]!==undefined&&delete this.attribs.methods[b]};
this.toSerialize=function(){var b=[];this.connections.foreach(function(){b.push({id:this.id,type:this.type,stat:this.stat,connected:this.connected.id})});return{id:this.id,type:this.type,connections:b,attribs:this.attribs,idxs:this.idxs}};this._getObjVal=function(b,c){var d=c.indexOf(".");return d!==-1?this._getObjVal(b[c.substring(0,d)],c.substring(d+1)):b[c]};this._setClassParam=function(b,c,d){var e=c.indexOf(".");if(e!==-1){var g=c.substring(0,e);c=c.substring(e+1);this._setClassParam(b[g],c,
d)}else b[c]=d};if(a.initial){this.idxs=a.initial.idxs;this.attribs=a.initial.attribs}};classObj.prototype=new wdwObj({});InterfaceModel=function(a){a.type="interface";classObj.call(this,a);if(!a.initial){this.attribs.methods={};this.attribs.interfaceName=defaults.interfaceName}this.getTypeName=function(){return this.attribs.interfaceName}};InterfaceModel.prototype=new classObj({});
classModel=function(a){classObj.call(this,a);if(a.initial){this.idxs=a.initial.idxs;this.attribs=a.initial.attribs}else{this.attribs.className=defaults.className;this.attribs.properties={};this.attribs.methods={}}this.setClassName=function(b){this.attribs.className=b};this.getTypeName=function(){return this.attribs.className};this.deleteProperty=function(b){if(this.attribs.properties[b]!==undefined)delete this.attribs.properties[b];else dbg("deleteProperty: property with id: "+b+" isn't defined")}};
classModel.prototype=new classObj({});
ct=modelManager={models:new Earray,_baseTypes:new Earray,initialize:function(){this.models=new Earray;this._baseTypes=cs.getBaseTypes()},getTypes:function(){if(modelManager._baseTypes.length===0)modelManager._baseTypes=cs.getBaseTypes();var a=[];modelManager._baseTypes.foreach(function(){a.push({val:this.id,name:this.getTypeName()})});modelManager.models.foreach(function(){a.push({val:this.id,name:this.getTypeName()})});return a},getType:function(a){for(var b=this.getTypes(),c=0;c<b.length;c++){var d=
b[c];if(d.val===a)return d}return{val:"undefined",name:"type not defined"}},addModel:function(a){this.models.push(a);return a},createWindow:function(a){a=new wdwObj(a);this.models.push(a);return a},getWdwById:function(a){for(var b=0;b<this.models.length;b++)if(this.models[b].id===a)return this.models[b]},getModel:function(a){return this.getWdwById(a)},getObjectsByType:function(a){var b=[];this.models.foreach(function(){this.type===a&&b.push(this)});return b},deleteModel:function(a){for(var b=0;b<
this.models.length;b++)if(this.models[b].id===a)break;if(b===this.models.length-1)this.models.pop();else this.models[b]=this.models.pop()}};
tm={ttId:undefined,destroyToolTip:function(){dbg("in destroyToolTip");$(document.getElementById(this.ttId)).remove();wm.__marked_info.obj=undefined;document.onmousemove=undefined;wm.__marked_info.type="";this.ttId=undefined},movingTooltip:function(a,b,c,d){if(this.ttId)alert("tooltip already defined");else{a=wm.createWindow({top:a.pageY,left:a.pageX,width:130,height:60,moveable:false,notResizable:true,className:"add"});this.ttId=a.id;a.innerHTML=b;wm.__marked_info.obj=a;wm.__marked_info.diffX=c;wm.__marked_info.diffY=
d;wm.__marked_info.clicks=0;document.onmousemove=moveManager.moveMarked}}};tempIdGenerator={max_id_number:0,getNewId:function(){return 12}};
widgetGenerator={input:function(a,b){return'<input style="text" id="'+a+'" value="'+(b&&b||"")+'"/>'},textarea:function(a,b){return'<textarea id="'+a+'" value="'+(b&&b||"")+'" rows="5" cols="20"></textarea>'},radioSet:function(a,b,c){for(var d="",e=0;e<b.length;e++){var g=b[e],f="";if(c===g.val)f=' checked="true" ';d+='<input type="radio" name="'+a+'" value="'+g.val+'"'+f+"/>"+g.name+"<br/>"}return d},select:function(a,b,c){a='<select id="'+a+'">';for(var d=0;d<b.length;d++){var e=b[d],g="";if(c===
e.val)g=' selected="true" ';a+='<option value="'+e.val+'"'+g+">"+e.name+"</option>"}a+="</select>";return a},checkbox:function(a,b,c,d){d=d||"";return'<input class="'+d+'" type="checkbox" id="'+a+'"/>'+c},className:function(a){return this.genericWidgetGenerator("className",{className:a})},properties:function(a){return this.genericWidgetGenerator("properties",a)},methods:function(a){return this.genericWidgetGenerator("methods",a)},stateDescription:function(a){return this.genericWidgetGenerator("stateDescription",
{stateDescription:a})},condition:function(a){return this.genericWidgetGenerator("condition",{condition:a})},interfaceName:function(a){return this.genericWidgetGenerator("interfaceName",{interfaceName:a})},removeElementFromList:function(a){$("#"+a+" > .deleted:first").attr("checked","true");$("#"+a).hide()},elementsCounter:0,addElementTxt:function(a,b,c,d,e){var g=this.elementsCounter,f="el"+d+g,i=d+g+"deleted";c='<br/><div id="'+f+'" class="'+c+'">';c+=this.genericWidgetGenerator("",e,widgetDefinition[a][b].elements,
d+g);c+=this.checkbox(i,"","","deleted");c+=this.submitButton("widgetGenerator.removeElementFromList",genericgui.getParams(f),"delete");c+="</div>";this.elementsCounter+=1;return c},addElement:function(a,b,c,d,e,g){$("#"+c).append($(this.addElementTxt(a,b,d,e,g)));$("#"+c).find(".deleted").hide()},genericWidgetGenerator:function(a,b,c,d){var e="",g=widgetDefinition[a];if(c)g=c;d=d&&d||"";for(c=0;c<g.length;c++){var f=g[c],i=b&&b[f.id]||f.def;if(f.type==="input")e+="<span>"+f.description+"</span>"+
this.input(d+f.id,i);else if(f.type==="textarea")e+=f.description+this.textarea(d+f.id,i);else if(f.type==="radio"){var h=f.values;if(typeof h==="function")h=h();e+=f.description+"<br/>"+this.radioSet(d+f.name,h,i)}else if(f.type==="select"){h=f.values;if(typeof h==="function")h=h();e+=f.description+this.select(d+f.id,h,i)}else if(f.type==="list"){var j="id_div"+f.classSelector;e+=this.submitButton("widgetGenerator.addElement",genericgui.getParams(a,c,j,f.classSelector,f.id),"add element");e+=f.description+
"<br/>";h=i&&i.length||1;e+='<div id="'+j+'">';for(j=0;j<h;j++)e+=this.addElementTxt(a,c,f.classSelector,f.id,i&&i[j]||undefined);e+="</div>"}e+="<br/>"}return e},submitButton:function(a,b,c){var d="save";if(typeof c==="string")d=c;return'<input type="submit" value="'+d+'" onclick="'+a+"("+b+');"/>'},cancelButton:function(){return this.submitButton("genericgui.destroyEditAttribForm","","cancel")}};
widgetDefinition={className:[{type:"input",id:"className",description:"Class name: "}],properties:[{type:"input",id:"name",description:"Property name: "},{type:"select",id:"type",name:"type",description:"Property type: ",values:modelManager.getTypes},{type:"radio",id:"visibility",description:"Visibility: ",values:defaults.visSet,name:"visibility",def:defaults.propertyVisibility}],methods:[{type:"input",id:"name",description:"Method name: "},{type:"select",id:"type",name:"type",description:"Method type: ",
values:modelManager.getTypes},{type:"radio",id:"visibility",description:"Visibility: ",values:defaults.visSet,name:"visibility",def:defaults.propertyVisibility},{type:"list",id:"parameters",description:"Parameters: ",classSelector:"methodsparams",elements:[{type:"input",id:"name",description:"name"},{type:"select",id:"type",name:"type",description:"Parameter type: ",values:modelManager.getTypes}]}],stateDescription:[{type:"input",id:"stateDescription",description:"State description: "}],condition:[{type:"textarea",
id:"condition",description:"Condition: "}],interfaceName:[{type:"input",id:"interfaceName",description:"Interface name: "}],initialize:function(){this.properties[1].values=modelManager.getTypes()}};
valueReader={generic:function(a,b,c){var d=a.indexOf(".");if(d!==-1)a=a.substring(0,d);d={};a=widgetDefinition[a];if(b)a=b;c=c&&c||"";for(b=0;b<a.length;b++){var e=a[b].id;if(a[b].type==="input")d[e]=$("#"+c+e).val();else if(a[b].type==="textarea")d[e]=$("#"+c+e).val();else if(a[b].type==="radio")d[e]=$("input[name="+c+a[b].name+"]:checked").val();else if(a[b].type==="select")d[e]=$("#"+c+e).val();else if(a[b].type==="list"){d[e]=[];for(var g=widgetGenerator.elementsCounter,f=0,i=0;i<g;i++)if(!$("#"+
("el"+e+i)+"> .deleted:first").attr("checked")){d[e][f]=valueReader.generic("",a[b].elements,e+i);f+=1}}}widgetGenerator.elementsCounter=0;return d},noObjectValues:["className","stateDescription","condition","interfaceName"]};
viewManager={views:{},connections:{},redrawViews:function(a){this.applyForViews(a,function(b){b.redraw()})},addView:function(a,b){var c=false;for(var d in this.views)if(d===a)c=true;c||(this.views[a]=[]);this.views[a].push(b)},applyForViews:function(a,b){for(var c=0;c<this.views[a].length;c++)b(this.views[a][c])},getView:function(a){for(key in this.views)for(var b=0;b<this.views[key].length;b++)if(this.views[key][b].id===a)return this.views[key][b]},getViewsForModel:function(a){return this.views[a]},
addConnection:function(a){this.connections[a.connection_id]=a},removeConnection:function(a){var b=this.connections[a];b.parentLogic.removeConnectionById(b.connection_id);(b.first?b.lastButton():b.firstButton()).parentLogic.removeConnectionById(b.connection_id);this.delete_wire(b);delete this.connections[a]},delete_wire:function(a){a=a.firstButton();for(var b=new Earray;!a.last;){b.push(a.conn.one.wire);a.label&&$(a.label).remove();a=a.nextBtn}b.push(a.conn.one.wire);b.foreach(function(){$(this).remove()})},
deleteModel:function(a){this.applyForViews(a,function(b){for(var c=b.connections.length,d=new Earray,e=0;e<c;e++)d.push(b.connections[e].id);d.foreach(function(){viewManager.removeConnection(this)});delete b.connections;$(b).remove()});delete this.views[a]},redrawAll:function(){for(var a in this.connections)this.connections[a].redraw();for(a in this.views)for(var b=this.views[a],c=0;c<b.length;c++)b[c].redraw()}};
StateModel=function(a){classObj.call(this,a);if(!a.initial)this.attribs.stateDescription=defaults.stateDescription};StateModel.prototype=new classObj({});ConditionalModel=function(a){classObj.call(this,a);if(!a.initial)this.attribs.conditions=defaults.condition};ConditionalModel.prototype=new classObj({});
makeMoveable=function(a,b){a.updatePos=function(c){return function(d,e){return c.updatePos.call(this,d,e)}}(b);a.getBoundingBox=function(c){return function(){return c.getBoundingBox.call(this)}}(b);if(!a.style.left)a.style.left=0;if(!a.style.top)a.style.top=0;a.style.position="absolute"};
createImageView=function(a){a.width=a.width||defaults.asmViewWidth;a.height=a.height||defaults.asmViewHeight;var b=createBaseView(a);b.baseToSerialize=b.toSerialize;b.bgImage="/site_media/"+a.bgImage;$(b.options).remove();$(b.content).remove();b.realContent=genericgui.createNewDiv();b.realContent.style.position="absolute";b.realContent.style.left=b.realContent.style.top=0;$(b).append($('<img src="'+b.bgImage+'"/>'));b.appendChild(b.realContent);var c=genericgui.createNewDiv();buttonMaker.createMovingBtn(c,
5);makeMoveable(c,b);b.realContent.appendChild(c);$(b).find("div:not(.movingDiv):not(.value)").each(function(){this.className=""});$(b).find("hr").remove();$(b).removeClass("orange");b.origClass="";$(b).find(".movingDiv").removeClass("movingDiv").mouseover(function(){this.className="movingDiv"}).mouseout(function(){this.className=""});b.divs={holder:c};b.afterResize=function(){var d=this.divs.holder;d.style.top=toInt(b.style.height)/3;d.style.left=toInt(b.style.width)/3;$(b).find("img:first").css({width:b.style.width,
height:b.style.height,top:"0px",left:"0px"});this.redraw&&this.redraw()};b.drawBackground=function(){};b.toSerialize=function(){var d=this.baseToSerialize.call(this);d.holder=baseToSerialize(this.divs.holder);return d};if(a.initial){a=a.initial.holder;b.divs.holder.style.top=a.top;b.divs.holder.style.left=a.left}b.getOptions=function(){return $("<div>").append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),"delete"))).append("<br/>").append(buttonMaker.createConnectBtn(this.id,
"connect",wm.connectAsm))};b.afterResize();return b};createStateView=function(a){a.type="state";a.bgImage="state.gif";var b=createImageView(a);a=genericgui.createEditablePropDiv({par:b,cssClass:"stateDiv",value:"state value",desc:""},"stateDescription");b.divs.holder.appendChild(a);b.redraw=function(){b.drawBackground();var c=modelManager.getModel(this._modelId);$(this).find(".stateDiv:first").children(".value:first").text(c.attribs.stateDescription)};return b};
createConditionalView=function(a){a.type="conditional";a.bgImage="condition.gif";var b=createImageView(a);a=genericgui.createEditablePropDiv({par:b,cssClass:"conditionDiv",value:"condition",desc:"",btnText:"Edit contidion"},"condition");b.divs.holder.appendChild(a);b.redraw=function(){b.drawBackground();var c=modelManager.getModel(this._modelId);$(this).find(".conditionDiv:first").children(".value:first").text(c.attribs.condition)};return b};
asmFactory={creator:{model:{createState:function(a){a=a||idManager.getNewId();return new StateModel({id:a,type:"state"})},createConditional:function(a){a=a||idManager.getNewId();return new ConditionalModel({id:a,type:"conditional"})}},view:{createState:function(a){a.width=a.height=100;return createStateView(a)},createConditional:function(a){a.width=a.height=100;return createConditionalView(a)}}},serializator:{serialize:function(){}},deserializator:{model:{createState:function(a){return new StateModel({initial:a,
id:a.id})},createConditional:function(a){return new ConditionalModel({initial:a,id:a.id})}},view:{create_state:function(a){return factory.creator.view.createState({initial:a,model:a.model,id:a.id})},create_conditional:function(a){return factory.creator.view.createConditional({initial:a,model:a.model,id:a.id})}}},gui:{createGui:function(a){var b=factory.gui.methods,c=BaseGui.createInput;$(c("Add new state")).click(b.newState).appendTo(a);$(c("Add new conditional")).click(b.newConditional).appendTo(a)},
methods:{changeState:function(){},defaultViewPos:{top:100,left:100,moveable:true},newState:function(){controller.createNewState(asmFactory.gui.methods.defaultViewPos)},newConditional:function(){controller.createNewConditional(asmFactory.gui.methods.defaultViewPos)}}}};Earray=function(){};
EarrayProt=function(){this.foreach=function(a){for(var b=0;b<this.length;b++)a.call(this[b])};this.remove=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)break;if(b===this.length-1)this.pop();else this[b]=this.pop()};this.removeAt=function(a){if(a>=this.length-1)this.pop();else this[a]=this.pop()}};EarrayProt.prototype=[];Earray.prototype=new EarrayProt;
genericgui={getParams:function(){for(var a=arguments.length,b="",c=0;c<a;c++){var d=arguments[c];if(c!==0)b+=",";if(typeof d===Number)b+=""+d+"";else if(typeof d!=="object")b+="'"+d+"'"}return b},createNewDiv:function(a,b){var c=document.createElement("div");c.id=idManager.getNewId();if(a)c.innerHTML=a;if(b)c.className=b;return c},createEditablePropDiv:function(a,b,c){var d=this.createNewDiv();d.className=a.cssClass;var e=a.desc&&a.desc||"",g=a.btnText||"edit",f="";if(c){buttonMaker.createMovingBtn(d,
5);f="<span>"+e+'</span><span class="value">'+a.value+"</span>";c=this.getParams(a.par._modelId,b);f+=widgetGenerator.submitButton("genericgui.showEditForm",c,g);$(d).append($(f))}else{g=$("<a>").addClass("value").append(a.value).mouseover(function(){$(this).removeClass("normalLink").addClass("hoverLink")}).mouseout(function(){$(this).removeClass("hoverLink").addClass("normalLink")}).click(function(){genericgui.showEditForm(a.par._modelId,b)});$(d).append(a.desc).append(g)}return d},createForm:function(a){a=
a&&a||{};return wm.createWindow({width:a.width||500,height:a.height||500,top:a.top||100,left:a.left||100,className:"add",moveable:a.moveable||true,notResizable:a.notResizable||true})},showEditForm:function(a,b){if(this.attribForm)alert("only one window of editing attribute is allowed at time");else{var c=wm.createWindow({width:500,height:0,top:100,left:100,className:"add",moveable:true,notResizable:true});this.attribForm=c;value=modelManager.getModel(a).getParamValue(b);a=this.getParams(a,b);var d=
b.indexOf("."),e=b;if(d!==-1)e=b.substring(0,d);b=widgetGenerator[e](value);b+="<br/>";b+=widgetGenerator.submitButton("genericgui.saveObjAttrib",a);b+=widgetGenerator.cancelButton();c.appendChild(this.createNewDiv(b,"add"));$(c).find(".deleted").hide()}},saveObjAttrib:function(a,b){a=modelManager.getModel(a);var c=undefined,d=false;for(c=0;c<valueReader.noObjectValues.length;c++)if(b===valueReader.noObjectValues[c])d=true;c=valueReader.generic(b);if(d)c=c[b];if(d=language.checkAttrib(a,b,c))alert(d);
else{a.setClassAttrib(b,c);viewManager.redrawViews(a.id);this.destroyEditAttribForm()}viewManager.redrawAll()},destroyEditAttribForm:function(){if(this.attribForm){$(this.attribForm).remove();this.attribForm=undefined}else dbg("called destroyEditAttribForm when no cmv.attribForm was defined")}};
controller=classController={createNewClass:function(a){var b=factory.creator.createClassModel();modelManager.addModel(b);a.model=b;a=factory.creator.createClassView(a);viewManager.addView(b.id,a);a.redraw()},createNewInterface:function(a){var b=factory.creator.createInterfaceModel();modelManager.addModel(b);a.model=b;a=factory.creator.createInterfaceView(a);viewManager.addView(b.id,a);a.redraw()},createNewState:function(a){return this._genericCreateNewModel("State",a)},createNewConditional:function(a){return this._genericCreateNewModel("Conditional",
a)},_genericCreateNewModel:function(a,b){var c="create"+a;a=factory.creator.model[c]();modelManager.addModel(a);b.model=a;b=factory.creator.view[c](b);viewManager.addView(a.id,b);b.redraw()},deleteModel:function(a){viewManager.deleteModel(a);modelManager.deleteModel(a);viewManager.redrawAll()},deleteProperty:function(a,b){modelManager.getModel(a).deleteProperty(b);viewManager.redrawViews(a)},deleteMethod:function(a,b){modelManager.getModel(a).deleteMethod(b);viewManager.redrawViews(a)},deleteConnectionByBtn:function(){},
deleteConnection:function(a,b,c){a=modelManager.getModel(a);b=modelManager.getModel(b);a.removeConnection(c);b.removeConnection(c);viewManager.removeConnection(c)},addConnection:function(a,b,c,d){a=modelManager.getModel(a);b=modelManager.getModel(b);a.addConnection({connected:b,type:c,id:d,stat:"child"});b.addConnection({connected:a,type:c,id:d,stat:"parent"})}};
InterfaceView=function(a){a.type="interface";a=createBaseView(a);var b=genericgui.createEditablePropDiv({par:a,cssClass:"classNameDiv",value:"new class",desc:""},"interfaceName");a.content.appendChild(b);var c=genericgui.createNewDiv("","propertiesDiv");a.content.appendChild(c);a.divs={interfaceName:b,properties:c};a.getOptions=function(){var d=$("<div>");d.append($(widgetGenerator.submitButton("factory.gui.addMethod",genericgui.getParams(this.id),"add method")));d.append("<br/>");d.append($(widgetGenerator.submitButton("controller.deleteModel",
genericgui.getParams(this._modelId),"delete")));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"iherit",wm.connectInheritance));return d};a.redraw=function(){var d=modelManager.getModel(this._modelId);$(this.divs.interfaceName).children(".value:first").html(d.attribs.interfaceName);var e=$(this.divs.properties);e.html("");for(var g in d.attribs.methods){var f=d.attribs.methods[g];if(typeof f!==undefined){var i=this._modelId,h=modelManager.getType(f.type).name;f=defaults.prefixes[f.visibility]+
f.name+"( "+drawParams(f)+") : "+h;f+="<br/>";i=getOnclickProperty("methods",f,i,g);e.append(i)}}};return a};
createClassView=function(a){a.type="class";a=createBaseView(a);var b=genericgui.createEditablePropDiv({par:a,cssClass:"classNameDiv",value:"new class",desc:""},"className");a.content.appendChild(b);var c=genericgui.createNewDiv("","propertiesDiv");a.content.appendChild(c);a.divs={properties:c,classname:b};a.getOptions=function(){var d=$("<div>");d.append($(widgetGenerator.submitButton("factory.gui.addProperty",genericgui.getParams(this.id),"addProperty")));d.append("<br/>");d.append($(widgetGenerator.submitButton("factory.gui.addMethod",
genericgui.getParams(this.id),"add method")));d.append("<br/>");d.append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),"delete")));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"implement interface",wm.connectInterface));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"iherit",wm.connectInheritance));return d};a.redraw=function(){var d=modelManager.getModel(this._modelId);$("#"+this.divs.classname.id+" > .value").html(d.attribs.className);
var e=$(this.divs.properties);e.html("").append("<hr/>");for(var g in d.attribs.properties){var f=d.attribs.properties[g];if(typeof f!=="undefined"){var i=this._modelId,h=modelManager.getType(f.type).name;h=defaults.prefixes[f.visibility]+f.name+" : "+h;i=getOnclickProperty("properties",h,i,g);e.append(i).append("<br/>")}}e.append("<hr/>");for(g in d.attribs.methods){f=d.attribs.methods[g];if(typeof f!==undefined){i=this._modelId;h=modelManager.getType(f.type).name;h=defaults.prefixes[f.visibility]+
f.name+"( "+drawParams(f)+") : "+h;i=getOnclickProperty("methods",h,i,g);e.append(i).append("<br/>")}}};return a};drawParams=function(a){for(var b="",c=0;c<a.parameters.length;c++){if(c>0)b+=",";var d=a.parameters[c],e=modelManager.getType(d.type).name;b+=d.name+" : "+e}return b};
getOnclickProperty=function(a,b,c,d){b=$("<span>").append(b);b.mouseover(function(){$(this).removeClass("normalLink").addClass("hoverLink")});b.mouseout(function(){$(this).removeClass("hoverLink").addClass("normalLink")});b.get(0).onclick=function(i,h){return function(){return genericgui.showEditForm(i,a+"."+h)}}(c,d);var e=$("<span>").append("delete").addClass("normalBtn").mouseover(function(){$(this).removeClass("normalBtn").addClass("hoverLink")}).mouseout(function(){$(this).removeClass("hoverLink").addClass("normalBtn")});
if(a==="properties")e.click(function(){controller.deleteProperty(c,d)});else a==="methods"&&e.click(function(){controller.deleteMethod(c,d)});for(var g="",f=0;f<5;f++)g+="&nbsp;";return $("<span>").append(b).append(g).append(e)};
factory=classFactory={creator:{model:{},createClassModel:function(a){a||(a=idManager.getNewId());return new classModel({id:a,type:"class"})},createClassView:function(a){a.width=a.height=250;return createClassView(a)},createInterfaceModel:function(a){a||(a=idManager.getNewId());return new InterfaceModel({id:a})},createInterfaceView:function(a){return InterfaceView(a)}},serializator:{serialize:function(){}},deserializator:{createClassModel:function(a){return new classModel({initial:a,id:a.id})},createClassView:function(a){return createClassView({initial:a,
model:a.model,width:a.width,height:a.height,id:a.id})},createInterfaceModel:function(a){return new InterfaceModel({initial:a,model:a.model,id:a.id})},createInterfaceView:function(a){return factory.creator.createInterfaceView({initial:a,model:a.model,id:a.id})}},gui:{addProperty:function(a){return this.genericAdd(a,"properties")},addMethod:function(a){return this.genericAdd(a,"methods")},genericAdd:function(a,b){a=modelManager.getModel(document.getElementById(a)._modelId);var c=[];for(var d in a.attribs[b])c.push(d);
c.sort();for(var e=0,g=0;g<c.length;g++){e=parseInt(d[g])+1;if(a.attribs[b][e]===undefined)break}genericgui.showEditForm(a.id,b+"."+e)},createGui:function(a){var b=factory.gui.methods,c=BaseGui.createInput;$(a).append("Adding/removing class diagram objects:");$(c("Add new class","factory.gui.newClass")).click(b.newClass).appendTo(a);$(c("Add new interface")).click(b.newInterface).appendTo(a)},methods:{newClass:function(){controller.createNewClass({top:200,left:100,moveable:true})},newInterface:function(){controller.createNewInterface({top:200,
left:100,moveable:true})}}}};allowed_connections={implementation:[{0:"class",1:"interface"}],inheritance:[{0:"class",1:"class"}],asm:[{0:"state",1:"state"},{0:"conditional",1:"state"},{0:"state",1:"conditional"}]};
createBaseView=function(a){a.moveable=true;var b=wm.createWindow(a),c=$("#"+b.id+"> .movingDiv:first"),d=c.attr("onmousedown");c.removeAttr("onmousedown").mousedown(function(e){wm._forceInputs||b.hideInputs();d.call(this,e)});b.origClass=b.className;b._modelId=a.model.id;b.connections=new Earray;b.inner=genericgui.createNewDiv("","innerDiv");b.appendChild(b.inner);b.content=genericgui.createNewDiv();b.inner.appendChild(b.content);b.mouseIO=0;b.addConnection=function(e){this.connections.push(e)};b.removeConnection=
function(e){for(var g=0;g<this.connections.length;g++)if(this.connections[g].btn===e)break;if(g===this.connections.length-1)this.connections.pop();else this.connections[g]=this.connections.pop()};b.removeConnectionById=function(e,g){if(g)this.connections.removeAt(g);else{for(g=0;g<this.connections.length;g++)if(this.connections[g].id===e)break;g<this.connections.length&&this.connections.removeAt(g)}};b.callLater=function(e){return function(){if(e.optionsDiv){e.optionsDiv.remove();e.optionsDiv=undefined}}};
b.hideInputs=function(){if(this.optionsDiv)if(!this.interval)this.interval=setTimeout(this.callLater(this),1E3)};b.showInputs=function(){if(this.interval){clearTimeout(this.interval);this.interval=undefined}var e=toInt(this.style.left),g=toInt(this.style.top),f=toInt(this.style.width);toInt(this.style.height);if(this.optionsDiv){this.optionsDiv.remove();clearTimeout(this.interval);this.optionsDiv=this.interval=undefined}this.optionsDiv=$("<div>").append(this.getOptions()).append("<br/>").mouseover(function(){if(this.associatedView.interval){clearTimeout(this.associatedView.interval);
this.associatedView.interval=undefined}}).mouseout(function(){this.associatedView.interval=setTimeout(this.associatedView.callLater(this.associatedView),1E3)}).css({left:e+f,top:g,position:"absolute"}).appendTo("#main_div").fadeIn();this.optionsDiv.get(0).associatedView=this};b.onmouseover=function(){this.mouseIO+=1;var e=wm.__marked_info.type;if(e==="connecting"){this.origClass=this.className;this.className="over"}var g=wm._forceInputs;if(g!=="show")if(g!=="hide")if(!e&&e!=="resize")this.showInputs();
else e==="resize"&&this.hideInputs()};b.onmouseout=function(){this.mouseIO-=1;this.className=this.origClass;var e=wm.__marked_info.type,g=wm._forceInputs;if(g!=="show")if(g!=="hide")if(!e||e==="resize")this.hideInputs()};b.onclick=function(){if(wm.__marked_info.type==="connecting")if(wm.connectedFirstClass===this){viewManager.delete_wire(wm.__marked_info.obj);wm.__marked_info.obj=undefined;wm.__marked_info.type=wm.__marked_info.connection_type=""}else{for(var e=false,g=wm.connectedFirstClass,f=this,
i=allowed_connections[wm.__marked_info.connection_type],h=0;h<i.length;h++)if(i[h][0]===g.type&&i[h][1]===f.type){e=true;break}if(e)if(wm.connectedFirstClass!==this)if(!(wm.__marked_info.connection_type==="implementation"&&this.type!=="interface")){e=wm.__marked_info.obj;g=e.firstButton();f=this._modelId;i=wm.connectedFirstClass._modelId;h=idManager.getNewId();var j=wm.__marked_info.connection_type;g.connection_id=h;g.connection_type=j;this.addConnection({btn:e,id:h});e.parentLogic=this;wm.connectedFirstClass.addConnection({btn:g,
id:h});g.parentLogic=wm.connectedFirstClass;e.redraw();viewManager.addConnection(g);controller.addConnection(i,f,j,h);wm.__marked_info.obj=undefined;wm.__marked_info.type=wm.__marked_info.connection_type=""}}};b.toSerialize=function(){var e=baseToSerialize(this);e.connections=[];this.connections.foreach(function(){e.connections.push({id:this.id,btnid:this.btn.id})});e.modelId=this._modelId;e.type=this.type;return e};if(a.initial){b.style.top=a.initial.top;b.style.left=a.initial.left;b.style.width=
a.initial.width;b.style.height=a.initial.height;b._modelId=a.initial.modelId;b.type=a.initial.type;dbg(document.getElementById(a.initial.id));b.id=a.initial.id}return b};
ClassDeserializer={deserializeModels:function(){for(var a=serialized_data.models,b=0;b<a.length;b++){var c=a[b],d;if(c.type==="class")d=factory.deserializator.createClassModel(c);else if(c.type==="interface")d=factory.deserializator.createInterfaceModel(c);else if(c.type==="state")d=factory.deserializator.model.createState(c);else if(c.type==="conditional")d=factory.deserializator.model.createConditional(c);modelManager.addModel(d)}for(b=0;b<a.length;b++){c=a[b];var e=c.connections;d=modelManager.getModel(c.id);
for(c=0;c<e.length;c++){var g=e[c];g={connected:modelManager.getModel(g.connected),type:g.type,stat:g.stat,id:g.id};d.addConnection(g)}}},deserializeViews:function(){for(var a=serialized_data.views,b=0;b<a.length;b++){var c=a[b];c.model=modelManager.getModel(c.modelId);c=c.type==="class"?factory.deserializator.createClassView(c):c.type==="interface"?factory.deserializator.createInterfaceView(c):factory.deserializator.view["create_"+c.type](c);viewManager.addView(c._modelId,c);c.redraw();c.updatePos(parseInt(c.style.top),
parseInt(c.style.left))}for(b=0;b<serialized_data.wires.length;b++){a=serialized_data.wires[b];a.orientation==="wide"?wm.createHorizontalWire(parseInt(a.left),parseInt(a.left)+parseInt(a.width),parseInt(a.top),a.id):wm.createVerticalWire(parseInt(a.top),parseInt(a.top)+parseInt(a.height),parseInt(a.left),a.id)}for(b=0;b<serialized_data.buttons.length;b++){a=serialized_data.buttons[b];c=document.getElementById(a.conn.one.wire);var d=a.conn.one.pos,e=line2pos=undefined;if(a.conn.two){e=document.getElementById(a.conn.two.wire);
line2pos=a.conn.two.pos}buttonMaker.createWireBtn(c,e,d,d,line2pos,a.id);a.label&&buttonMaker.createLabel({text:a.label.text,btn:document.getElementById(a.id),posRelative:{x:a.label.pos.x,y:a.label.pos.y},width:a.label.base.width,height:a.label.base.height})}for(b=0;b<serialized_data.buttons.length;b++){c=serialized_data.buttons[b];a=document.getElementById(c.id);if(c.first)a.first=true;if(c.last)a.last=true;if(c.parentLogic)a.parentLogic=document.getElementById(c.parentLogic);if(c.connection_id)a.connection_id=
c.connection_id;if(c.connection_type)a.connection_type=c.connection_type;a.nextBtn=document.getElementById(c.nextBtn);a.prevBtn=document.getElementById(c.prevBtn)}for(b=0;b<serialized_data.views.length;b++){c=serialized_data.views[b];for(d=0;d<c.connections.length;d++){e=c.connections[d];a=document.getElementById(e.btnid);a.parentLogic.addConnection({btn:a,id:e.id});a.connection_id&&viewManager.addConnection(a)}}}};
cs={checkPropertyName:function(a,b,c){if(a.length<=2)return"too short";if(c)for(c=0;c<b.idxs.properties;c++)if(b.attribs.properties[c].name===a)return"property with name "+a+" already exists in that class";return""},checkAttrib:function(){return""},getBaseTypes:function(){if(this._type_cache)return this._type_cache;for(var a=new Earray,b=["int","string","double","bool"],c=0;c<b.length;c++){var d=new classModel({});d.attribs.className=b[c];a.push(d)}return this._type_cache=a}};FF_DEBUG=false;
dbg=function(a){FF_DEBUG&&console.log(a)};document.onclick=function(){var a=wm.__marked_info.type;if(a==="moving_wire"){wm.__marked_info.obj.redraw();wm.__marked_info.obj=wm.__marked_info.type=undefined}else if(a==="split_wire"||a==="delete_wire"||a==="cut_wire"||a==="add_label_wire"){wm.__marked_info.clicks+=1;if(wm.__marked_info.clicks===2||wm.__marked_info.clicks>2)tm.destroyToolTip()}else if(a==="down"){wm.__marked_info.obj=undefined;wm.__marked_info.type=undefined}};document.onmouseup=function(){};
types={property:{text:"Property",attribName:"properties"}};
wm={formShown:false,init:function(a,b){document.getElementById("main_div").getBoundingBox=function(){return{ne:{x:500,y:0},sw:{x:0,y:500}}};this.__colllisionNeighbours=b;this.__colllisionParent=a;this.__marked_info={obj:undefined,type:undefined}},markResized:function(a){obj=document.getElementById(a);a=wm.__marked_info.obj=obj;for(var b=document.getElementById("main_div"),c={top:0,left:0};a!==b;){c.top=parseInt(c.top)+parseInt(a.style.top);c.left=parseInt(c.left)+parseInt(a.style.left);a=a.parentNode}wm.__marked_info.resizeDiff=
{top:c.top,left:c.left};wm.__marked_info.type="resize";document.onmousemove=resizer.resizeMarked;document.onmouseup=wm._stopResize},createWindow:function(a){var b=windowCreator._createBaseWindow(a.left,a.top,a.inner,a.parentEl,a.id);if(a.type)b.type=a.type;a.firstObjects&&$(b).append(a.firstObjects);a.moveable?buttonMaker.createMovingBtn(b):this._assignEvents(b);styleManager.setBaseWindowStyle(b,{width:a.width,height:a.height,className:a.className});b.updatePos(parseInt(b.style.top),parseInt(b.style.left));
a.notResizable||buttonMaker.createBtn(b);return b},getPrefixForProp:function(){},createHorizontalWire:function(a,b,c,d){return windowCreator._createJoiningElement(a,b,c,c,d)},createVerticalWire:function(a,b,c,d){return windowCreator._createJoiningElement(c,c,a,b,d)},getConnPoint:function(a){return{x:parseInt(a.style.left)+parseInt(a.style.width)-defaults.wireMovingButtonWidth-10,y:parseInt(a.style.top)+parseInt(a.style.height)/2}},connectInterface:function(a,b){wm.__marked_info.connection_type="implementation";
wm.connect(a,b)},connectInheritance:function(a,b){wm.__marked_info.connection_type="inheritance";wm.connect(a,b)},connectAsm:function(a,b){wm.__marked_info.connection_type="asm";wm.connect(a,b)},connect:function(a,b){if(wm.__marked_info.type!=="connecting"){var c=connector.startConnecting(document.getElementById(b)).line2.btns[0];c.onmousedown(a);a={x:15+a.pageX-(parseInt(c.conn.one.wire.style.left)+parseInt(c.style.left)),y:a.pageY-(parseInt(c.conn.one.wire.style.top)+parseInt(c.style.top))};moveManager._move_wire_by_diff(c.conn.one.wire,
a,c.place,c,0,"previous");wm.__marked_info.type="connecting";wm.connectedFirstClass=viewManager.getView(b)}},__marked_info:{},__over_info:{},__colllisionNeighbours:false,__colllisionParent:false,_forceInputs:undefined,_assignEvents:function(a){a.onmouseover=this._manageMouseOver;a.onmouseout=this._manageMouseOut;a.onmousedown=this._manageMouseDown;document.mouseup=a.onmouseup=this._manageMouseUp},_stopResize:function(){wm.__marked_info.obj=undefined;document.onmousemove=document.onmouseup=undefined;
wm.__marked_info.type=undefined},_manageMouseClick:function(){},_genericManageMouseDown:function(){},_manageMouseDown:function(a){return wm._genericManageMouseDown(a,this)},_manageMouseUp:function(){if(wm.__marked_info.type!=="connecting")if(wm.__marked_info.obj)if(wm.__marked_info.type!=="resize")if(wm.__marked_info.type!=="split_wire")if(wm.__marked_info.type!=="delete_wire"){wm.__marked_info.obj=undefined;wm.__marked_info.type="";document.onmousemove=undefined}},_manageMouseOver:function(){},_manageMouseOut:function(){}};
baseToSerialize=function(a){return{id:a.id,top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height}};
collisionDetector={collideWithNeighbours:function(a){for(var b=0;b<defaults.classesDoesNotCollide.length;b++)if(a.className===defaults.classesDoesNotCollide[b])return false;b=this._getNeighbourDivs(a);a=a.getBoundingBox();for(var c=0;c<b.length;c++)if(b[c].getBoundingBox){var d=b[c].getBoundingBox();if(this._collide(a,d))return true;if(this._collide(d,a))return true}return false},collideWithParent:function(a){for(var b=0;b<defaults.classesDoesNotCollide.length;b++)if(a.className===defaults.classesDoesNotCollide[b])return false;
b=a.parentNode;b={ne:{x:parseInt(b.style.width),y:0},sw:{x:0,y:parseInt(b.style.height)}};a={ne:{x:parseInt(a.style.left)+parseInt(a.style.width),y:parseInt(a.style.top)},sw:{x:parseInt(a.style.left),y:parseInt(a.style.top)+parseInt(a.style.height)}};if(a.ne.x>=b.ne.x)return true;if(a.ne.y<=b.ne.y)return true;if(a.sw.x<=b.sw.x)return true;if(a.sw.y>=b.sw.y)return true;return false},_getNeighbourDivs:function(a){return $(a).parent().children("div").not(".cres").not(".wire").not("#"+a.id).not(".propertiesDiv").not(".add")},
_getBorderingDiv:function(a){return $(a).parent(":not(#main_div)")},_collide:function(a,b){if(a.ne.x>=b.sw.x&&a.ne.x<=b.ne.x){if(a.ne.y<=b.sw.y&&a.ne.y>=b.ne.y)return true;if(a.sw.y<=b.sw.y&&a.sw.y>=b.ne.y)return true}if(a.sw.x>=b.sw.x&&a.sw.x<=b.ne.x){if(a.sw.y>=b.sw.y&&a.sw.y<=b.ne.y)return true;if(a.ne.y<=b.sw.y&&a.ne.y>=b.ne.y)return true}return false}};connection=function(){};
connector={startConnecting:function(a){a=wm.getConnPoint(a);return connector._create_wire_points(a,{x:a.x+100,y:a.y+100})},connectToWdw:function(){},_getPlace:function(a){return{x:parseInt(a.style.left)+parseInt(a.style.width)/2,y:parseInt(a.style.top)+parseInt(a.style.height)/2}},_create_wire:function(a,b){a=this._getPlace(a);b=this._getPlace(b);return connector._create_wire_points(a,b)},_create_wire_points:function(a,b){var c=wm.createHorizontalWire(a.x,b.x,a.y);a=wm.createVerticalWire(a.y,b.y,
b.x);b=buttonMaker.createWireBtn(c,undefined,"topleft","topleft",undefined);var d=buttonMaker.createWireBtn(c,a,"widehigh","widehigh","topleft"),e=buttonMaker.createWireBtn(a,undefined,"widehigh","widehigh",undefined);b.first=true;b.nextBtn=d;d.prevBtn=b;d.nextBtn=e;e.prevBtn=d;e.last=true;return{line1:c,line2:a}},addWire:function(a){var b=a.conn.one.wire;if(b.orientation!=="wide"){var c=a.nextBtn;if(a.last)c=a.prevBtn;return connector.addWire(c)}if(a.first||a.last)alert("cant split wires here");
else{var d=a.conn.two.wire,e=undefined,g=e=40,f={x:undefined,y:undefined};c=a.nextBtn;var i=wire2place=undefined;if(b.orientation==="wide"){i=a.conn.one.pos;wire2place=c.conn.one.pos;f.y=parseInt(d.style.top)+parseInt(d.style.height)-parseInt(b.style.top);if(a.conn.two.pos==="topleft"){e=d;g=b}else{e=b;g=d}f.y=parseInt(e.style.top)+parseInt(e.style.height)-parseInt(g.style.top);if(a.conn.one.pos==="widehigh"){e=d;g=b}else{e=b;g=d}f.x=parseInt(e.style.left)+parseInt(e.style.width)-parseInt(g.style.left)}e=
f.y/2;g=f.x/2;if(b.orientation==="wide"){var h=wire3y=newWire3=undefined,j=newWire2y2=undefined;f=newWire3x2=undefined;if(a.conn.one.pos==="widehigh"){b.style.width=parseInt(b.style.width)-g;h=parseInt(b.style.left)+parseInt(b.style.width);f=parseInt(b.style.left)+parseInt(b.style.width);newWire3x2=parseInt(d.style.left)}else{b.style.left=parseInt(b.style.left)+g;b.style.width=parseInt(b.style.width)-g;h=parseInt(b.style.left);f=parseInt(d.style.left);newWire3x2=parseInt(b.style.left)}moveManager._update_wire_buttons(b);
if(a.conn.two.pos==="topleft"){d.style.top=parseInt(d.style.top)+e;d.style.height=parseInt(d.style.height)-e;wire3y=parseInt(d.style.top);j=parseInt(b.style.top);newWire2y2=j+e}else{d.style.height=parseInt(d.style.height)-e;wire3y=parseInt(d.style.top)+parseInt(d.style.height);j=parseInt(d.style.top)+parseInt(d.style.height);newWire2y2=parseInt(b.style.top)}moveManager._update_wire_buttons(d);e=wm.createVerticalWire(j,newWire2y2,h);newWire3=wm.createHorizontalWire(f,newWire3x2,wire3y);f=a.conn.two.pos;
b=buttonMaker.createWireBtn(e,newWire3,wire2place,wire2place,a.conn.one.pos==="widehigh"&&"topleft"||"widehigh");d=buttonMaker.createWireBtn(newWire3,d,i,i,f);if(a.last){a.last=undefined;newBtn4.last=true}c.prevBtn=d;d.prevBtn=b;d.nextBtn=c;b.nextBtn=d;b.prevBtn=a;a.conn.two.wire=e;a.nextBtn=b}}},_create_assocation:function(){},_connect_assocation:function(){},connect:function(a,b){var c=this._create_wire(a,b);this._create_assocation(a,c.line1,b);this._create_assocation(b,c.line2,a);this.addWire(c.line1.btns[1])}};
styleManager={setBaseWindowStyle:function(a,b){this._baseSetStyle(a,b.width,b.height);a.className=b.className||defaults.windowClassName},setWireStyle:function(a,b,c){this._baseSetStyle(a,b,c);a.className="wire"},_baseSetStyle:function(a,b,c){if(typeof b==="undefined")b=defaults.windowWidth;if(typeof c==="undefined")c=defaults.windowHeight;a.style.position="absolute";a.style.width=b;a.style.height=c}};toInt=function(a){return parseInt(a,10)};
buttonMaker={height:15,width:15,moveButton:function(a){var b=document.getElementById("r"+a.id);buttonMaker._setPos(a,b,"widehigh")},showLabelForm:function(a,b,c){a=document.getElementById(a);var d=genericgui.createForm({height:5});d.id=idManager.getNewId();var e="Enter label here: ";e+=widgetGenerator.input("idlabel",a.label_text||defaults.wireLabel);e+="<br/>";e+=widgetGenerator.submitButton(b,genericgui.getParams(a.id,d.id),c||"Add label");e+=widgetGenerator.submitButton("buttonMaker.closeLabelForm",
genericgui.getParams(d.id),"cancel");e+="<br/>";e+="<br/>";d.appendChild(genericgui.createNewDiv(e,"add",true))},addLabel:function(a,b){this.createLabel({btn:document.getElementById(a),text:$("#idlabel").val()});buttonMaker.closeLabelForm(b)},editLabel:function(a,b){a=document.getElementById(a);var c=$("#idlabel").val();a.label_text=c;$(a.label).find(".inner:first").html(c);a.label.label_text=c;buttonMaker.closeLabelForm(b)},removeLabel:function(a){a=document.getElementById(a);delete a.btn.label;
$(a).remove()},createLabel:function(a){var b=wm.createWindow({type:"label",width:a.width&&a.width||defaults.wireLabelWidth,height:a.height&&a.height||defaults.wireLabelHeight,top:100,left:100,className:"buttonlabel",moveable:true,notResizable:false});b.btn=a.btn;b.updateRelativePos=function(){this.posX=toInt(this.style.left)-this.btn.getAbsolutePos().x;this.posY=toInt(this.style.top)-this.btn.getAbsolutePos().y};b.moveAfterFollowedBtn=function(){b.style.left=a.btn.getAbsolutePos().x+b.posX;b.style.top=
a.btn.getAbsolutePos().y+b.posY};$(b).append($('<span class="inner">'+a.text+"</span>")).append($(widgetGenerator.submitButton("buttonMaker.removeLabel",genericgui.getParams(b.id),"delete"))).append($(widgetGenerator.submitButton("buttonMaker.showLabelForm",genericgui.getParams(a.btn.id,"buttonMaker.editLabel","save"),"edit")));b.label_text=a.text;if(a.posRelative){b.posX=a.posRelative.x;b.posY=a.posRelative.y}else{b.posX=defaults.wireLabelDiffX;b.posY=defaults.wireLabelDiffY}b.moveAfterFollowedBtn();
b.onmouseover=function(){wm._forceInputs||wm.__marked_info.type||$(this).find("input").show()};b.onmouseout=function(){wm._forceInputs||wm.__marked_info.type||$(this).find("input").hide()};a.btn.label=b;b.updateRelativePos();b.onmouseout();document.getElementById("main_div").appendChild(b)},closeLabelForm:function(a){$("#"+a).remove()},createBtn:function(a){var b=this._getStyleTxt("silver",defaults.resizeButtonWidth,defaults.resizeButtonHeight),c='<div class="cres"';c+=' id="r'+a.id+'"';c+=' style="'+
b+'"';c+='" onmousedown="wm.markResized(\''+a.id+"')\"";c+="</div>";$(a).append(c);this._setPos(a,document.getElementById("r"+a.id),"widehigh")},createWireBtn:function(a,b,c,d,e,g){g=this._createWireBtnHtml(a,g);$(a).append(g.txt);g=document.getElementById(g.id);g._parent=a;this._setPos(g._parent,g,c);g.place=c;g.conn={};g.conn.one={};g.conn.one.pos=d;g.conn.one.wire=a;g.conn.two={};g.conn.two.pos=e;g.conn.two.wire=b;a.btns.push(g);g.getAbsolutePos=function(){return{x:toInt(this.style.left)+toInt(this.parentNode.style.left),
y:toInt(this.style.top)+toInt(this.parentNode.style.top)}};g.getDataToCopy=function(f){for(var i=["first","last","parentLogic","label"],h=0;h<i.length;h++)if(this[i[h]])f[i[h]]=this[i[h]];if(this.first){f.connection_id=this.connection_id;f.connection_type=this.connection_type}};g.onmousedown=wm._manageMouseDown;g.onmouseup=function(){this.redraw();if(wm.__marked_info.type==="moving_wire")wm.__marked_info.obj=wm.__marked_info.type=undefined};g.onmouseover=function(){var f=wm.__marked_info.type;if(f===
"split_wire"||f==="delete_wire"||f==="cut_wire"||f==="add_label_wire"){f=defaults.wireMovingButtonWidth;var i=defaults.wireMovingButtonHeight,h=3;if(this.last){i=f=defaults.wireMovingButtonEndWidth;h=2}this.style.width=h*f;this.style.height=h*i}};g.onmouseout=function(){var f=wm.__marked_info.type;if(f==="split_wire"||f==="delete_wire"||f==="cut_wire"||f==="add_label_wire")if(this.last){this.style.width=defaults.wireMovingButtonEndWidth;this.style.height=defaults.wireMovingButtonEndHeight}else{this.style.width=
defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonHeight}};g.onclick=function(){var f=wm.__marked_info.type;if(f==="split_wire"){this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonHeight;connector.addWire(this);this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;tm.destroyToolTip()}else if(f==="delete_wire"){f=this.firstButton();var i=this.lastButton();controller.deleteConnection(f.parentLogic._modelId,
i.parentLogic._modelId,f.connection_id);tm.destroyToolTip()}else if(f!=="change_connection_type")if(f==="add_label_wire"){this.label?alert("This button already has a label. To add new label, please remove the existing one."):buttonMaker.showLabelForm(this.id,"buttonMaker.addLabel");this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;tm.destroyToolTip()}else if(f==="cut_wire"){this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;
if(!this.first&&!this.last)alert("can cut only first and last button");else{if(this.first){f=this;for(var h=0;h<2;h++)f=f.nextBtn;if(f.last){alert("too little boxes");return}}else{f=this;for(h=0;h<2;h++)f=f.prevBtn;if(f.first){alert("too little boxes");return}}var j=h=undefined;f=undefined;var k=0,l=0;if(this.conn.one.wire.orientation==="high"){h="nextBtn";j="prevBtn";f="two";if(this.last){h="prevBtn";j="nextBtn";f="one"}k=toInt(this.conn.one.wire.style.height)}else{h="nextBtn";j="prevBtn";f="two";
if(this.last){h="prevBtn";j="nextBtn";f="one"}l=toInt(this.conn.one.wire.style.width)}i=this[h];var m=this[h][h];if(this.conn.one.pos!=="widehigh"){k=-k;l=-l}moveManager._move_wire({x:l,y:k},m);k=buttonMaker.createWireBtn(i.conn[f].wire,undefined,i.conn[f].pos,i.conn[f].pos,undefined);this.getDataToCopy(k);k[h]=m;k[j]=undefined;m[j]=k;for(h=0;h<this.parentLogic.connections.length;h++)if(this.parentLogic.connections[h].btn.id===this.id)break;this.parentLogic.connections[h]={btn:k};i.conn[f].wire.appendChild(k);
buttonMaker._setPos(k.conn.one.wire,k,k.place);$(this.conn.one.wire).remove();$(i).remove();k.redraw()}}};g.onmousedown=function(f){if(wm.__marked_info.type!="resize")if(!wm.__marked_info.obj){wm.__marked_info.type="moving_wire";wm.__marked_info.obj=this;wm.__marked_info.top=this._parent.style.top;wm.__marked_info.left=this._parent.style.left;wm.__marked_info.pageX=f.pageX;wm.__marked_info.pageY=f.pageY;wm.__marked_info.diffX=f.pageX-toInt(this.style.left);wm.__marked_info.diffY=f.pageY-toInt(this.style.top);
document.onmousemove=moveManager.moveMarked}};g.toSerialize=function(){var f=baseToSerialize(this);f.parentNodeId=this.parentNode.id;f.conn={one:{wire:this.conn.one.wire.id,pos:this.conn.one.pos}};if(this.conn.two.wire)f.conn.two={wire:this.conn.two.wire.id,pos:this.conn.two.pos};if(this.nextBtn)f.nextBtn=this.nextBtn.id;if(this.prevBtn)f.prevBtn=this.prevBtn.id;if(this.first){f.first=true;f.connection_id=this.connection_id;f.connection_type=this.connection_type}if(this.last)f.last=true;if(this.parentLogic)f.parentLogic=
this.parentLogic.id;if(this.label){var i=this.label;f.label={text:i.label_text,pos:{x:i.posX,y:i.posY},base:baseToSerialize(this.label)}}return f};g.firstButton=function(){for(var f=this;!f.first;)f=f.prevBtn;return f};g.lastButton=function(){for(var f=this;!f.last;)f=f.nextBtn;return f};g.redraw=function(){var f=this.firstButton().connection_type,i=this.lastButton();i.drawSign(f);buttonMaker._setPos(i.conn.one.wire,i,i.conn.one.pos);(f=moveManager._box_difference(this,{x:0,y:0}))&&f.wx>=0&&dbg("error during redrawing wire btn")};
g.drawSign=function(f){this.style.width=this.style.height=1;f="/site_media/"+f+this.conn.one.pos.substring(0,3)+this.conn.one.wire.orientation.substring(0,3)+".png";var i=0,h=0;if(this.conn.one.wire.orientation==="wide"){i=-(defaults.arrowSize/2);h=0}else{i=0;h=-(defaults.arrowSize/2)}h=h.toString();i=i.toString();f=$('<img src="'+f+'"/>').css({left:h,top:i,position:"absolute"});$(this).children().remove();this.appendChild(f.get(0));f.click(function(j){return function(k){return j.onclick(k)}}(this)).mouseover(function(j){return function(k){j.onmouseover(k)}}(this))};
return g},createMovingBtn:function(a,b){var c=document.createElement("div");c.id=idManager.getNewId();c.className="movingDiv";c.style.height=b||defaults.movingBtnHeight;c.style.width="100%";c.style.left=0;c.style.top=0;c.getBoundingBox=function(){return{ne:{x:toInt(this.style.left)+toInt(this.style.width),y:toInt(this.style.top)},sw:{x:toInt(this.style.left),y:toInt(this.style.top)+toInt(this.style.height)}}};c._parent=a;wm._assignEvents(c);c.onmousedown=function(d){if(wm.__marked_info.type!="resize")if(!wm.__marked_info.obj){wm.__marked_info.type=
"down";wm.__marked_info.top=this._parent.style.top;wm.__marked_info.left=this._parent.style.left;var e=wm.__marked_info.obj=this._parent;wm.__marked_info.diffX=d.pageX-toInt(e.style.left);wm.__marked_info.diffY=d.pageY-toInt(e.style.top);document.onmousemove=moveManager.moveMarked}};c.onmouseup=document.onmouseup;c.onclick=document.onclick;a.appendChild(c)},createConnectBtn:function(a,b,c){return $("<button>"+b+"</button>").click(function(d){return c(d,a)})},_getStyleTxt:function(a,b,c){b="width: "+
b+"px; height: "+c+"px;";b+=" position: absolute; background: "+a;return b},_createWireBtnHtml:function(a,b){a='<div class="wirehandle"';var c=this._getStyleTxt(defaults.wireBtnColor,defaults.wireMovingButtonWidth,defaults.wireMovingButtonHeight),d=undefined;d=b?b:idManager.getNewId();a+=' id="'+d+'"';a+=' style="'+c+'"';a+="</div>";return{txt:a,id:d}},_setPos:function(a,b,c){var d=0,e=0;if(c==="widehigh"){d=toInt(a.style.width)-toInt(b.style.width);e=toInt(a.style.height)-toInt(b.style.height)}b.style.top=
e;b.style.left=d}};idManager={max_id_number:0,prefix:"i",getNewId:function(){this.max_id_number+=1;if(document.getElementById(this.prefix+this.max_id_number)){dbg("znalazlem !!");dbg(this.max_id_number)}return this.prefix+this.max_id_number}};
defaults={windowWidth:100,windowHeight:100,wireSize:1,windowClassName:"orange",resizeButtonWidth:15,resizeButtonHeight:15,movingBtnHeight:10,wireBtnColor:"silver",asmViewWidth:100,asmViewHeight:100,wireMovingButtonWidth:10,wireMovingButtonHeight:10,wireMovingButtonEndWidth:30,wireMovingButtonEndHeight:30,wireLabel:"Enter label here",wireLabelDiffX:30,wireLabelDiffY:0,wireLabelWidth:100,wireLabelHeight:100,arrowSize:30,stateDescription:"New state",condition:"enter your condition here",classesDoesNotCollide:["add"],
propertyVisibility:"protected",className:"New class name",interfaceName:"New interface",prefixes:{"private":"-","public":"+","protected":"#"},visSet:[{name:"public",val:"public"},{name:"protected",val:"protected"},{name:"private",val:"private"}]};
initialize=function(){var a={1:classFactory,2:asmFactory};language=cs;wm.init(false,false);modelManager.initialize();factory=a[window.diagramData.type];window.diagramData.load&&deserializer.deserialize(window.serialized_data);document.getElementById("main_div").classes=[];BaseGui.createGui($("#userGui > #genericGui"),diagramData.read_only);factory.gui.createGui($("#userGui > #specificGui"))};
windowCreator={_createJoiningElement:function(a,b,c,d,e){var g=defaults.wireSize;e=this._createBaseWindow(a,c,"",undefined,e);var f=Math.abs(b-a),i=Math.abs(d-c),h=e.orientation=f<i&&"high"||"wide",j=undefined,k=undefined;if(h==="wide"){j=f;k=g}else{j=g;k=i}e.zwrot=h==="wide"?b<a?"left":"right":d-c<0?"up":"down";e.btns=[];styleManager.setWireStyle(e,j,k);e.toSerialize=function(){var l=baseToSerialize(this);l.orientation=this.orientation;return l};e.addButton=function(l){this.btns.push(l)};e.onmousedown=
function(){};return e},_createBaseWindow:function(a,b,c,d,e){var g=document.createElement("div");g.innerHTML=c||"";g.id=typeof e==="string"?e:idManager.getNewId();g.connections={assocation:[]};g._cached_pos={top:0,left:0};g.getBoundingBox=function(){return this._cached_bounding_box};g.updatePos=function(f,i){this.style.top=f;this.style.left=i;this._cached_bounding_box={ne:{x:parseInt(i)+parseInt(this.style.width),y:parseInt(this.style.top)},sw:{x:parseInt(this.style.left),y:parseInt(f)+parseInt(this.style.height)}}};
if(typeof a!=="undefined"&&typeof b!=="undefined"){g.style.top=b||b+"px";g.style.left=a||a+"px"}a=d||document.getElementById("main_div");a.appendChild(g);g._parent=a;return g}};
BaseGui={showInputs:true,showWireButtons:true,createInput:function(a){return'<input type="submit" value="'+a+'"/>'},changeModeId:undefined,createGui:function(a,b){var c=function(j){return'<div id="'+j+'" />'},d={state:0,getNewId:function(){this.state+=1;return"guiid"+this.state}},e=BaseGui.methods,g=BaseGui.createInput,f=d.getNewId(),i=d.getNewId(),h=d.getNewId();$(a).append(c(f)).append(c(i)).append(c(h));a=$("#"+f);i=$("#"+i);h=$("#"+h);a.append("<span>Managing wires: </span>");a.append($(g("Split wire")).click(e.splitWire));
a.append($(g("Delete wire")).click(e.deleteWire));a.append($(g("Cut wire")).click(e.cutWire));a.append($(g("add label to wire")).click(e.addLabel));a=$(g("hide wire buttons")).click(e.toogleWireButtons);$(a).attr("id",d.getNewId());BaseGui.toogleWireButtonsId=$(a).attr("id");d=$(g("turn collision neighbour objects on")).click(e.toogleNeighbourCollision);wm.__colllisionNeighbours=true;d.click(undefined);i.append("<span>Visibility/behaviour:</span>");i.append(a).append(d);$("#main_div").find("input").hide();
d=$(g("save")).click(function(){$("#idSerializedData").val(serializator.serializeAll());$("#save_form").submit()});if(b)d=$("");h.append("<span>File options:</span>").append(d).append($(g("close")).click(function(){window.location=project_id==-1?"/demo_choose_type/":"/project/"+project_id+"/"}))},methods:{splitWire:function(a){wm.__marked_info.type="split_wire";return tm.movingTooltip(a,"click on box on wire to split that wire",-3*defaults.wireMovingButtonWidth,0)},deleteWire:function(a){wm.__marked_info.type=
"delete_wire";return tm.movingTooltip(a,"click on a wire to delete",-20,0)},cutWire:function(a){wm.__marked_info.type="cut_wire";return tm.movingTooltip(a,"click on a box of the wire you wish to cut",-20,0)},addLabel:function(a){wm.__marked_info.type="add_label_wire";return tm.movingTooltip(a,"click on a box of the wire to add a label to it",-20,0)},toogleWireButtons:function(){var a=$(".wirehandle").filter(function(){return!this.last});BaseGui.showWireButtons=!BaseGui.showWireButtons;if(BaseGui.showWireButtons){a.show();
a="hide wire buttons"}else{a.hide();a="show wire buttons"}$("#"+BaseGui.toogleWireButtonsId).val(a)},toogleNeighbourCollision:function(){var a=!wm.__colllisionNeighbours;a=(wm.__colllisionNeighbours=a)&&"turn off collision detection"||"turn on collision detection";$(this).val(a)}}};
moveManager={moveMarked:function(a){if(wm.__marked_info.type!="resize"){var b=wm.__marked_info.obj,c=undefined;if(b!==undefined){c=b.className==="wirehandle"?moveManager._moveWire:moveManager._moveElement;c(b,a)}}},_getNewTopLeft:function(a){return{top:a.pageY-wm.__marked_info.diffY,left:a.pageX-wm.__marked_info.diffX}},_moveElement:function(a,b){var c={top:a.style.top,left:a.style.left},d=moveManager._getNewTopLeft(b).top;b=moveManager._getNewTopLeft(b).left;a.updatePos(d,b);if(moveManager._collide(a))a.updatePos(c.top,
c.left);else{c={x:b-parseInt(c.left),y:d-parseInt(c.top)};moveManager._moveAssocations(a,c)}dbg("_moveElement: moved.id: "+a.id);a.updateRelativePos&&a.updateRelativePos()},_moveAssocations:function(a,b){if(a.connections)for(var c=0,d=a.connections.length;c<d;c++)moveManager._move_wire(b,a.connections[c].btn)},_moveWire:function(a,b){diff={};diff.x=b.pageX-wm.__marked_info.pageX;diff.y=b.pageY-wm.__marked_info.pageY;wm.__marked_info.pageX=b.pageX;wm.__marked_info.pageY=b.pageY;moveManager._move_wire(diff,
a,"one",0)},_update_wire_buttons:function(a){for(var b=0;b<a.btns.length;b++)buttonMaker._setPos(a,a.btns[b],a.btns[b].place)},unprecedented:{active:false,type:undefined,direction:undefined,setActive:function(){this.active=true;var a="undirect";if(wm.__marked_info.obj.className==="wirehandle")a="direct";this.type=a},setNewMargin:function(a,b){if(b==="high"){if(a.wx>=0)moveManager._diff_margin.wx=a.wx;if(a.ex<=0)moveManager._diff_margin.ex=a.ex}else if(b==="width"){if(a.ny>=0)moveManager._diff_margin.ny=
a.ny;if(a.sy<=0)moveManager._diff_margin.ex=a.ex}},clearMargin:function(){moveManager._diff_margin={wx:0,ex:0,ny:0,sy:0}}},_move_wire_by_diff:function(a,b,c,d,e,g){var f=function(k){var l=k==="widehigh"&&"topleft"||"widehigh";if(d.first){d.conn.one.pos=d.place=k;d.nextBtn.conn.one.pos=d.nextBtn.place=l}else if(d.last){d.conn.one.pos=d.place=k;d.prevBtn.conn.two.pos=l}else{if(d.conn.one.wire===a)d.conn.one.pos=d.place=k;else d.conn.two.pos=k;k=["nextBtn","prevBtn"];for(var m,n=0;n<2;n++){m=k[n];if(d[m].conn.one.wire===
a)d[m].conn.one.pos=d[m].place=l;else if(d[m].conn.two.wire===a)d[m].conn.two.pos=l}}};if(!moveManager._check_collide_parent(d,b)){if(a.orientation==="wide"){if(b.x!==0){var i=width=parseInt(a.style.width),h=oldLeft=parseInt(a.style.left);if(c==="topleft"){h+=b.x;width-=b.x}else width+=b.x;if(width<0){width=Math.abs(width);if(c==="topleft"){h=oldLeft+i;a.style.width=width;a.style.left=h;f("widehigh")}else{h=oldLeft-width;a.style.width=width;a.style.left=h;f("topleft")}}a.style.width=width;a.style.left=
h}if(b.y!==0){i=parseInt(a.style.top);a.style.top=parseInt(a.style.top)+b.y;if(e===0){c=undefined;if(g==="next"){c=d.nextBtn;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.two.wire,{x:0,y:b.y},c.conn.two.pos,c,e+1,g)}else if(g==="previous"){c=d.prevBtn;if(c.first||c.last){moveManager._check_collide_parent(c,{x:0,y:b.y});return}moveManager._move_wire_by_diff(c.conn.one.wire,{x:0,y:b.y},c.conn.one.pos,c,e+1,g)}}}}else{if(b.y!==0){h=oldHeight=parseInt(a.style.height);var j=i=parseInt(a.style.top);
if(c==="topleft"){j+=b.y;h-=b.y}else h+=b.y;if(h<0){h=Math.abs(h);if(c==="topleft"){j=i+oldHeight;a.style.height=width;a.style.top=j;f("widehigh")}else{j=i-h;a.style.height=h;a.style.top=j;f("topleft")}}a.style.height=h;a.style.top=j}if(b.x!==0){a.style.left=parseInt(a.style.left)+b.x;if(e===0){c=undefined;if(g==="next"){c=d.nextBtn;if(c.last)return;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.two.wire,{x:b.x,y:0},c.conn.two.pos,c,e+1,g)}else if(g==="previous"){c=d.prevBtn;if(c.last||
c.first)return;moveManager._move_wire_by_diff(c.conn.one.wire,{x:b.x,y:0},c.conn.one.pos,c,e+1,g)}}}}moveManager._update_wire_buttons(a);d.label&&d.label.moveAfterFollowedBtn()}},_diff_margin:{wx:0,ex:0,sy:0,ny:0},_box_difference:function(a,b){if((a.first||a.last)&&a.parentLogic){var c=a.parentNode.style;b={left:parseInt(c.left)+parseInt(a.style.left)+b.x,top:parseInt(c.top)+parseInt(a.style.top)+b.y};b={ne:{x:parseInt(b.left)+parseInt(a.style.width),y:parseInt(b.top)},sw:{x:parseInt(b.left),y:parseInt(b.top)+
parseInt(a.style.height)}};a=a.parentLogic.style;a={ne:{x:parseInt(a.left)+parseInt(a.width),y:parseInt(a.top)},sw:{x:parseInt(a.left),y:parseInt(a.top)+parseInt(a.height)}};return{wx:a.sw.x-b.sw.x,ex:a.ne.x-b.ne.x,sy:a.sw.y-b.sw.y,ny:a.ne.y-b.ne.y}}},_check_collide_parent:function(a,b){if(wm.__marked_info.obj.className==="wirehandle"){if((a.first||a.last)&&a.parentLogic){a=this._box_difference(a,b);if(a.wx>=this._diff_margin.wx)return true;if(a.ex<=this._diff_margin.ex)return true;if(a.sy<=this._diff_margin.sy)return true;
if(a.ny>=this._diff_margin.ny)return true}return false}},_move_wire:function(a,b){var c=b.conn.one.wire,d=b.conn.two.wire;if(!function(e,g){if(e.first||e.last){if(moveManager._check_collide_parent(e,g))return true;return false}for(var f=["prevBtn","nextBtn"],i=0,h=c.orientation==="wide"?0:0;h<2;h++){i=f[h];if((e[i].first||e[i].last)&&e[i].parentLogic)if(e[i].conn.one.wire.orientation==="wide"){if(moveManager._check_collide_parent(e[i],{x:0,y:g.y}))return true}else if(moveManager._check_collide_parent(e[i],
{x:g.x,y:0}))return true}return false}(b,a))if(b.first)moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"next");else if(b.last)moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"previous");else{moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"previous");d&&moveManager._move_wire_by_diff(d,a,b.conn.two.pos,b,0,"next")}},_collide:function(a){if(wm.__colllisionNeighbours)if(collisionDetector.collideWithNeighbours(a))return true;if(wm.__colllisionParent)if(collisionDetector.collideWithParent(a))return true;
return false}};
resizer={resizeMarked:function(a){var b=wm.__marked_info.obj,c={top:parseInt(b.style.top),left:parseInt(b.style.left),width:parseInt(b.style.width),height:parseInt(b.style.height)};b.style.width=a.pageX-wm.__marked_info.resizeDiff.left;b.style.height=a.pageY-wm.__marked_info.resizeDiff.top;a=false;if(wm.__colllisionNeighbours)if(collisionDetector.collideWithNeighbours(b))a=true;if(wm.__colllisionParent&&!a)if(collisionDetector.collideWithParent(b))a=true;if(a||parseInt(b.style.width)<10||parseInt(b.style.height)<
10){b.style.width=parseInt(c.width);b.style.height=parseInt(c.height)}b.updatePos(parseInt(b.style.top),parseInt(b.style.left));a||buttonMaker.moveButton(b);b.afterResize&&b.afterResize()}};
serializator={serializeAll:function(){var a="{models: "+this._serializeModels();a+=", wires: "+this._serializeWires();a+=",views: "+this._serializeViews();a+=",buttons: "+this._serializeButtons();a+=",connections: "+this._serializeConnections();a+=",max_id_number: "+idManager.max_id_number;a+="}";return a},_serializeModels:function(){var a="[",b=0;ct.models.foreach(function(){if(b>0)a+=",";a+=serializator._serialize(this.toSerialize());b++});a+="]";return a},_serializeViews:function(){var a="[",b=
0;for(var c in viewManager.views)for(var d=0;d<viewManager.views[c].length;d++){var e=viewManager.views[c][d];if(b>0)a+=",";a+=this._serialize(e.toSerialize());b+=1}a+="]";return a},_serializeConnections:function(){var a=0,b="";for(var c in viewManager.connections){var d=viewManager.connections[c];if(a>0)b+=",";b+=this._serialize(d.toSerialize());a+=1}},_serializeWires:function(){return this._genericSerializeByClass("wire")},_serializeButtons:function(){return this._genericSerializeByClass("wirehandle")},
_genericSerializeByClass:function(a){var b="[",c=0;$("."+a).each(function(){if(c>0)b+=",";b+=serializator._serialize(this.toSerialize());c+=1});b+="]";return b},_serialize:function(a){var b="",c=typeof a;if(c==="string")b="'"+a+"'";else if(c==="function")b="";else if(c==="number"||c==="boolean")b=a;else if(a instanceof Array){b+="[";for(c=0;c<a.length;c++){if(c>0)b+=",";b+=this._serialize(a[c])}b+="]"}else{b+="{";c=0;for(var d in a){if(c>0)b+=",";b+=d+":"+this._serialize(a[d]);c+=1}b+="}"}return b}};
deserializer={restricted_ids:{},deserialize:function(a){var b=ClassDeserializer;idManager.max_id_number=toInt(serialized_data.max_id_number);b.deserializeModels(a.models);b.deserializeViews(a.views);viewManager.redrawAll()}};createInitialOpts=function(a){a||(a={id:undefined,type:undefined});if(!a.id)a.id=undefined;if(!a.type)a.type=undefined;return a};
wdwObj=function(a){a=createInitialOpts(a);if(!a.id)a.id=idManager.getNewId();this.id=a.id;this.type=a.type;this.connections=new Earray;this.addConnection=function(b){this.connections.push(b)};this.removeConnection=function(b){for(var c=0;c<this.connections.length;c++)if(this.connections[c].connection_id===b)break;this.connections.removeAt(c)};if(a.initial){this.id=a.initial.id;this.type=a.initial.type}};
classObj=function(a){wdwObj.call(this,a);this.idxs={properties:0};this.attribs={};this.getParamValue=function(b){return this._getObjVal(this.attribs,b)};this.setClassAttrib=function(b,c){this._setClassParam(this.attribs,b,c)};this.addProperty=function(b,c,d){var e=this.idxs.properties;this.idxs.properties+=1;this.attribs.properties[e]={name:b,type:c,visibility:d}};this.deleteClassParam=function(){};this.deleteMethod=function(b){this.attribs.methods[b]!==undefined&&delete this.attribs.methods[b]};
this.toSerialize=function(){var b=[];this.connections.foreach(function(){b.push({id:this.id,type:this.type,stat:this.stat,connected:this.connected.id})});return{id:this.id,type:this.type,connections:b,attribs:this.attribs,idxs:this.idxs}};this._getObjVal=function(b,c){var d=c.indexOf(".");return d!==-1?this._getObjVal(b[c.substring(0,d)],c.substring(d+1)):b[c]};this._setClassParam=function(b,c,d){var e=c.indexOf(".");if(e!==-1){var g=c.substring(0,e);c=c.substring(e+1);this._setClassParam(b[g],c,
d)}else b[c]=d};if(a.initial){this.idxs=a.initial.idxs;this.attribs=a.initial.attribs}};classObj.prototype=new wdwObj({});InterfaceModel=function(a){a.type="interface";classObj.call(this,a);if(!a.initial){this.attribs.methods={};this.attribs.interfaceName=defaults.interfaceName}this.getTypeName=function(){return this.attribs.interfaceName}};InterfaceModel.prototype=new classObj({});
classModel=function(a){classObj.call(this,a);if(a.initial){this.idxs=a.initial.idxs;this.attribs=a.initial.attribs}else{this.attribs.className=defaults.className;this.attribs.properties={};this.attribs.methods={}}this.setClassName=function(b){this.attribs.className=b};this.getTypeName=function(){return this.attribs.className};this.deleteProperty=function(b){if(this.attribs.properties[b]!==undefined)delete this.attribs.properties[b];else dbg("deleteProperty: property with id: "+b+" isn't defined")}};
classModel.prototype=new classObj({});
ct=modelManager={models:new Earray,_baseTypes:new Earray,initialize:function(){this.models=new Earray;this._baseTypes=cs.getBaseTypes()},getTypes:function(){if(modelManager._baseTypes.length===0)modelManager._baseTypes=cs.getBaseTypes();var a=[];modelManager._baseTypes.foreach(function(){a.push({val:this.id,name:this.getTypeName()})});modelManager.models.foreach(function(){a.push({val:this.id,name:this.getTypeName()})});return a},getType:function(a){for(var b=this.getTypes(),c=0;c<b.length;c++){var d=
b[c];if(d.val===a)return d}return{val:"undefined",name:"type not defined"}},addModel:function(a){this.models.push(a);return a},createWindow:function(a){a=new wdwObj(a);this.models.push(a);return a},getWdwById:function(a){for(var b=0;b<this.models.length;b++)if(this.models[b].id===a)return this.models[b]},getModel:function(a){return this.getWdwById(a)},getObjectsByType:function(a){var b=[];this.models.foreach(function(){this.type===a&&b.push(this)});return b},deleteModel:function(a){for(var b=0;b<
this.models.length;b++)if(this.models[b].id===a)break;if(b===this.models.length-1)this.models.pop();else this.models[b]=this.models.pop()}};
tm={ttId:undefined,destroyToolTip:function(){dbg("in destroyToolTip");$(document.getElementById(this.ttId)).remove();wm.__marked_info.obj=undefined;document.onmousemove=undefined;wm.__marked_info.type="";this.ttId=undefined},movingTooltip:function(a,b,c,d){if(this.ttId)alert("tooltip already defined");else{a=wm.createWindow({top:a.pageY,left:a.pageX,width:130,height:60,moveable:false,notResizable:true,className:"add"});this.ttId=a.id;a.innerHTML=b;wm.__marked_info.obj=a;wm.__marked_info.diffX=c;wm.__marked_info.diffY=
d;wm.__marked_info.clicks=0;document.onmousemove=moveManager.moveMarked}}};tempIdGenerator={max_id_number:0,getNewId:function(){return 12}};
widgetGenerator={input:function(a,b){return'<input style="text" id="'+a+'" value="'+(b&&b||"")+'"/>'},textarea:function(a,b){return'<textarea id="'+a+'" value="'+(b&&b||"")+'" rows="5" cols="20"></textarea>'},radioSet:function(a,b,c){for(var d="",e=0;e<b.length;e++){var g=b[e],f="";if(c===g.val)f=' checked="true" ';d+='<input type="radio" name="'+a+'" value="'+g.val+'"'+f+"/>"+g.name+"<br/>"}return d},select:function(a,b,c){a='<select id="'+a+'">';for(var d=0;d<b.length;d++){var e=b[d],g="";if(c===
e.val)g=' selected="true" ';a+='<option value="'+e.val+'"'+g+">"+e.name+"</option>"}a+="</select>";return a},checkbox:function(a,b,c,d){d=d||"";return'<input class="'+d+'" type="checkbox" id="'+a+'"/>'+c},className:function(a){return this.genericWidgetGenerator("className",{className:a})},properties:function(a){return this.genericWidgetGenerator("properties",a)},methods:function(a){return this.genericWidgetGenerator("methods",a)},stateDescription:function(a){return this.genericWidgetGenerator("stateDescription",
{stateDescription:a})},condition:function(a){return this.genericWidgetGenerator("condition",{condition:a})},interfaceName:function(a){return this.genericWidgetGenerator("interfaceName",{interfaceName:a})},removeElementFromList:function(a){$("#"+a+" > .deleted:first").attr("checked","true");$("#"+a).hide()},elementsCounter:0,addElementTxt:function(a,b,c,d,e){var g=this.elementsCounter,f="el"+d+g,i=d+g+"deleted";c='<br/><div id="'+f+'" class="'+c+'">';c+=this.genericWidgetGenerator("",e,widgetDefinition[a][b].elements,
d+g);c+=this.checkbox(i,"","","deleted");c+=this.submitButton("widgetGenerator.removeElementFromList",genericgui.getParams(f),"delete");c+="</div>";this.elementsCounter+=1;return c},addElement:function(a,b,c,d,e,g){$("#"+c).append($(this.addElementTxt(a,b,d,e,g)));$("#"+c).find(".deleted").hide()},genericWidgetGenerator:function(a,b,c,d){var e="",g=widgetDefinition[a];if(c)g=c;d=d&&d||"";for(c=0;c<g.length;c++){var f=g[c],i=b&&b[f.id]||f.def;if(f.type==="input")e+="<span>"+f.description+"</span>"+
this.input(d+f.id,i);else if(f.type==="textarea")e+=f.description+this.textarea(d+f.id,i);else if(f.type==="radio"){var h=f.values;if(typeof h==="function")h=h();e+=f.description+"<br/>"+this.radioSet(d+f.name,h,i)}else if(f.type==="select"){h=f.values;if(typeof h==="function")h=h();e+=f.description+this.select(d+f.id,h,i)}else if(f.type==="list"){var j="id_div"+f.classSelector;e+=this.submitButton("widgetGenerator.addElement",genericgui.getParams(a,c,j,f.classSelector,f.id),"add element");e+=f.description+
"<br/>";h=i&&i.length||1;e+='<div id="'+j+'">';for(j=0;j<h;j++)e+=this.addElementTxt(a,c,f.classSelector,f.id,i&&i[j]||undefined);e+="</div>"}e+="<br/>"}return e},submitButton:function(a,b,c){var d="save";if(typeof c==="string")d=c;return'<input type="submit" value="'+d+'" onclick="'+a+"("+b+');"/>'},cancelButton:function(){return this.submitButton("genericgui.destroyEditAttribForm","","cancel")}};
widgetDefinition={className:[{type:"input",id:"className",description:"Class name: "}],properties:[{type:"input",id:"name",description:"Property name: "},{type:"select",id:"type",name:"type",description:"Property type: ",values:modelManager.getTypes},{type:"radio",id:"visibility",description:"Visibility: ",values:defaults.visSet,name:"visibility",def:defaults.propertyVisibility}],methods:[{type:"input",id:"name",description:"Method name: "},{type:"select",id:"type",name:"type",description:"Method type: ",
values:modelManager.getTypes},{type:"radio",id:"visibility",description:"Visibility: ",values:defaults.visSet,name:"visibility",def:defaults.propertyVisibility},{type:"list",id:"parameters",description:"Parameters: ",classSelector:"methodsparams",elements:[{type:"input",id:"name",description:"name"},{type:"select",id:"type",name:"type",description:"Parameter type: ",values:modelManager.getTypes}]}],stateDescription:[{type:"input",id:"stateDescription",description:"State description: "}],condition:[{type:"textarea",
id:"condition",description:"Condition: "}],interfaceName:[{type:"input",id:"interfaceName",description:"Interface name: "}],initialize:function(){this.properties[1].values=modelManager.getTypes()}};
valueReader={generic:function(a,b,c){var d=a.indexOf(".");if(d!==-1)a=a.substring(0,d);d={};a=widgetDefinition[a];if(b)a=b;c=c&&c||"";for(b=0;b<a.length;b++){var e=a[b].id;if(a[b].type==="input")d[e]=$("#"+c+e).val();else if(a[b].type==="textarea")d[e]=$("#"+c+e).val();else if(a[b].type==="radio")d[e]=$("input[name="+c+a[b].name+"]:checked").val();else if(a[b].type==="select")d[e]=$("#"+c+e).val();else if(a[b].type==="list"){d[e]=[];for(var g=widgetGenerator.elementsCounter,f=0,i=0;i<g;i++)if(!$("#"+
("el"+e+i)+"> .deleted:first").attr("checked")){d[e][f]=valueReader.generic("",a[b].elements,e+i);f+=1}}}widgetGenerator.elementsCounter=0;return d},noObjectValues:["className","stateDescription","condition","interfaceName"]};
viewManager={views:{},connections:{},redrawViews:function(a){this.applyForViews(a,function(b){b.redraw()})},addView:function(a,b){var c=false;for(var d in this.views)if(d===a)c=true;c||(this.views[a]=[]);this.views[a].push(b)},applyForViews:function(a,b){for(var c=0;c<this.views[a].length;c++)b(this.views[a][c])},getView:function(a){for(key in this.views)for(var b=0;b<this.views[key].length;b++)if(this.views[key][b].id===a)return this.views[key][b]},getViewsForModel:function(a){return this.views[a]},
addConnection:function(a){this.connections[a.connection_id]=a},removeConnection:function(a){var b=this.connections[a];b.parentLogic.removeConnectionById(b.connection_id);(b.first?b.lastButton():b.firstButton()).parentLogic.removeConnectionById(b.connection_id);this.delete_wire(b);delete this.connections[a]},delete_wire:function(a){a=a.firstButton();for(var b=new Earray;!a.last;){b.push(a.conn.one.wire);a.label&&$(a.label).remove();a=a.nextBtn}b.push(a.conn.one.wire);b.foreach(function(){$(this).remove()})},
deleteModel:function(a){this.applyForViews(a,function(b){for(var c=b.connections.length,d=new Earray,e=0;e<c;e++)d.push(b.connections[e].id);d.foreach(function(){viewManager.removeConnection(this)});delete b.connections;$(b).remove()});delete this.views[a]},redrawAll:function(){for(var a in this.connections)this.connections[a].redraw();for(a in this.views)for(var b=this.views[a],c=0;c<b.length;c++)b[c].redraw()}};
StateModel=function(a){classObj.call(this,a);if(!a.initial)this.attribs.stateDescription=defaults.stateDescription};StateModel.prototype=new classObj({});ConditionalModel=function(a){classObj.call(this,a);if(!a.initial)this.attribs.conditions=defaults.condition};ConditionalModel.prototype=new classObj({});
makeMoveable=function(a,b){a.updatePos=function(c){return function(d,e){return c.updatePos.call(this,d,e)}}(b);a.getBoundingBox=function(c){return function(){return c.getBoundingBox.call(this)}}(b);if(!a.style.left)a.style.left=0;if(!a.style.top)a.style.top=0;a.style.position="absolute"};
createImageView=function(a){a.width=a.width||defaults.asmViewWidth;a.height=a.height||defaults.asmViewHeight;var b=createBaseView(a);b.baseToSerialize=b.toSerialize;b.bgImage="/site_media/"+a.bgImage;$(b.options).remove();$(b.content).remove();b.realContent=genericgui.createNewDiv();b.realContent.style.position="absolute";b.realContent.style.left=b.realContent.style.top=0;$(b).append($('<img src="'+b.bgImage+'"/>'));b.appendChild(b.realContent);var c=genericgui.createNewDiv();buttonMaker.createMovingBtn(c,
5);makeMoveable(c,b);b.realContent.appendChild(c);$(b).find("div:not(.movingDiv):not(.value)").each(function(){this.className=""});$(b).find("hr").remove();$(b).removeClass("orange");b.origClass="";$(b).find(".movingDiv").removeClass("movingDiv").mouseover(function(){this.className="movingDiv"}).mouseout(function(){this.className=""});b.divs={holder:c};b.afterResize=function(){var d=this.divs.holder;d.style.top=toInt(b.style.height)/3;d.style.left=toInt(b.style.width)/3;$(b).find("img:first").css({width:b.style.width,
height:b.style.height,top:"0px",left:"0px"});this.redraw&&this.redraw()};b.drawBackground=function(){};b.toSerialize=function(){var d=this.baseToSerialize.call(this);d.holder=baseToSerialize(this.divs.holder);return d};if(a.initial){a=a.initial.holder;b.divs.holder.style.top=a.top;b.divs.holder.style.left=a.left}b.getOptions=function(){return $("<div>").append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),"delete"))).append("<br/>").append(buttonMaker.createConnectBtn(this.id,
"connect",wm.connectAsm))};b.afterResize();return b};createStateView=function(a){a.type="state";a.bgImage="state.gif";var b=createImageView(a);a=genericgui.createEditablePropDiv({par:b,cssClass:"stateDiv",value:"state value",desc:""},"stateDescription");b.divs.holder.appendChild(a);b.redraw=function(){b.drawBackground();var c=modelManager.getModel(this._modelId);$(this).find(".stateDiv:first").children(".value:first").text(c.attribs.stateDescription)};return b};
createConditionalView=function(a){a.type="conditional";a.bgImage="condition.gif";var b=createImageView(a);a=genericgui.createEditablePropDiv({par:b,cssClass:"conditionDiv",value:"condition",desc:"",btnText:"Edit contidion"},"condition");b.divs.holder.appendChild(a);b.redraw=function(){b.drawBackground();var c=modelManager.getModel(this._modelId);$(this).find(".conditionDiv:first").children(".value:first").text(c.attribs.condition)};return b};
asmFactory={creator:{model:{createState:function(a){a=a||idManager.getNewId();return new StateModel({id:a,type:"state"})},createConditional:function(a){a=a||idManager.getNewId();return new ConditionalModel({id:a,type:"conditional"})}},view:{createState:function(a){a.width=a.height=100;return createStateView(a)},createConditional:function(a){a.width=a.height=100;return createConditionalView(a)}}},serializator:{serialize:function(){}},deserializator:{model:{createState:function(a){return new StateModel({initial:a,
id:a.id})},createConditional:function(a){return new ConditionalModel({initial:a,id:a.id})}},view:{create_state:function(a){return factory.creator.view.createState({initial:a,model:a.model,id:a.id})},create_conditional:function(a){return factory.creator.view.createConditional({initial:a,model:a.model,id:a.id})}}},gui:{createGui:function(a){var b=factory.gui.methods,c=BaseGui.createInput;$(c("Add new state")).click(b.newState).appendTo(a);$(c("Add new conditional")).click(b.newConditional).appendTo(a)},
methods:{changeState:function(){},defaultViewPos:{top:100,left:100,moveable:true},newState:function(){controller.createNewState(asmFactory.gui.methods.defaultViewPos)},newConditional:function(){controller.createNewConditional(asmFactory.gui.methods.defaultViewPos)}}}};Earray=function(){};
EarrayProt=function(){this.foreach=function(a){for(var b=0;b<this.length;b++)a.call(this[b])};this.remove=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)break;if(b===this.length-1)this.pop();else this[b]=this.pop()};this.removeAt=function(a){if(a>=this.length-1)this.pop();else this[a]=this.pop()}};EarrayProt.prototype=[];Earray.prototype=new EarrayProt;
genericgui={getParams:function(){for(var a=arguments.length,b="",c=0;c<a;c++){var d=arguments[c];if(c!==0)b+=",";if(typeof d===Number)b+=""+d+"";else if(typeof d!=="object")b+="'"+d+"'"}return b},createNewDiv:function(a,b){var c=document.createElement("div");c.id=idManager.getNewId();if(a)c.innerHTML=a;if(b)c.className=b;return c},createEditablePropDiv:function(a,b,c){var d=this.createNewDiv();d.className=a.cssClass;var e=a.desc&&a.desc||"",g=a.btnText||"edit",f="";if(c){buttonMaker.createMovingBtn(d,
5);f="<span>"+e+'</span><span class="value">'+a.value+"</span>";c=this.getParams(a.par._modelId,b);f+=widgetGenerator.submitButton("genericgui.showEditForm",c,g);$(d).append($(f))}else{g=$("<a>").addClass("value").append(a.value).mouseover(function(){$(this).removeClass("normalLink").addClass("hoverLink")}).mouseout(function(){$(this).removeClass("hoverLink").addClass("normalLink")}).click(function(){genericgui.showEditForm(a.par._modelId,b)});$(d).append(a.desc).append(g)}return d},createForm:function(a){a=
a&&a||{};return wm.createWindow({width:a.width||500,height:a.height||500,top:a.top||100,left:a.left||100,className:"add",moveable:a.moveable||true,notResizable:a.notResizable||true})},showEditForm:function(a,b){if(this.attribForm)alert("only one window of editing attribute is allowed at time");else{var c=wm.createWindow({width:500,height:0,top:100,left:100,className:"add",moveable:true,notResizable:true});this.attribForm=c;value=modelManager.getModel(a).getParamValue(b);a=this.getParams(a,b);var d=
b.indexOf("."),e=b;if(d!==-1)e=b.substring(0,d);b=widgetGenerator[e](value);b+="<br/>";b+=widgetGenerator.submitButton("genericgui.saveObjAttrib",a);b+=widgetGenerator.cancelButton();c.appendChild(this.createNewDiv(b,"add"));$(c).find(".deleted").hide()}},saveObjAttrib:function(a,b){a=modelManager.getModel(a);var c=undefined,d=false;for(c=0;c<valueReader.noObjectValues.length;c++)if(b===valueReader.noObjectValues[c])d=true;c=valueReader.generic(b);if(d)c=c[b];if(d=language.checkAttrib(a,b,c))alert(d);
else{a.setClassAttrib(b,c);viewManager.redrawViews(a.id);this.destroyEditAttribForm()}viewManager.redrawAll()},destroyEditAttribForm:function(){if(this.attribForm){$(this.attribForm).remove();this.attribForm=undefined}else dbg("called destroyEditAttribForm when no cmv.attribForm was defined")}};
controller=classController={createNewClass:function(a){var b=factory.creator.createClassModel();modelManager.addModel(b);a.model=b;a=factory.creator.createClassView(a);viewManager.addView(b.id,a);a.redraw()},createNewInterface:function(a){var b=factory.creator.createInterfaceModel();modelManager.addModel(b);a.model=b;a=factory.creator.createInterfaceView(a);viewManager.addView(b.id,a);a.redraw()},createNewState:function(a){return this._genericCreateNewModel("State",a)},createNewConditional:function(a){return this._genericCreateNewModel("Conditional",
a)},_genericCreateNewModel:function(a,b){var c="create"+a;a=factory.creator.model[c]();modelManager.addModel(a);b.model=a;b=factory.creator.view[c](b);viewManager.addView(a.id,b);b.redraw()},deleteModel:function(a){viewManager.deleteModel(a);modelManager.deleteModel(a);viewManager.redrawAll()},deleteProperty:function(a,b){modelManager.getModel(a).deleteProperty(b);viewManager.redrawViews(a)},deleteMethod:function(a,b){modelManager.getModel(a).deleteMethod(b);viewManager.redrawViews(a)},deleteConnectionByBtn:function(){},
deleteConnection:function(a,b,c){a=modelManager.getModel(a);b=modelManager.getModel(b);a.removeConnection(c);b.removeConnection(c);viewManager.removeConnection(c)},addConnection:function(a,b,c,d){a=modelManager.getModel(a);b=modelManager.getModel(b);a.addConnection({connected:b,type:c,id:d,stat:"child"});b.addConnection({connected:a,type:c,id:d,stat:"parent"})}};
InterfaceView=function(a){a.type="interface";a=createBaseView(a);var b=genericgui.createEditablePropDiv({par:a,cssClass:"classNameDiv",value:"new class",desc:""},"interfaceName");a.content.appendChild(b);var c=genericgui.createNewDiv("","propertiesDiv");a.content.appendChild(c);a.divs={interfaceName:b,properties:c};a.getOptions=function(){var d=$("<div>");d.append($(widgetGenerator.submitButton("factory.gui.addMethod",genericgui.getParams(this.id),"add method")));d.append("<br/>");d.append($(widgetGenerator.submitButton("controller.deleteModel",
genericgui.getParams(this._modelId),"delete")));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"iherit",wm.connectInheritance));return d};a.redraw=function(){var d=modelManager.getModel(this._modelId);$(this.divs.interfaceName).children(".value:first").html(d.attribs.interfaceName);var e=$(this.divs.properties);e.html("");for(var g in d.attribs.methods){var f=d.attribs.methods[g];if(typeof f!==undefined){var i=this._modelId,h=modelManager.getType(f.type).name;f=defaults.prefixes[f.visibility]+
f.name+"( "+drawParams(f)+") : "+h;f+="<br/>";i=getOnclickProperty("methods",f,i,g);e.append(i)}}};return a};
createClassView=function(a){a.type="class";a=createBaseView(a);var b=genericgui.createEditablePropDiv({par:a,cssClass:"classNameDiv",value:"new class",desc:""},"className");a.content.appendChild(b);var c=genericgui.createNewDiv("","propertiesDiv");a.content.appendChild(c);a.divs={properties:c,classname:b};a.getOptions=function(){var d=$("<div>");d.append($(widgetGenerator.submitButton("factory.gui.addProperty",genericgui.getParams(this.id),"addProperty")));d.append("<br/>");d.append($(widgetGenerator.submitButton("factory.gui.addMethod",
genericgui.getParams(this.id),"add method")));d.append("<br/>");d.append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),"delete")));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"implement interface",wm.connectInterface));d.append("<br/>");d.append(buttonMaker.createConnectBtn(this.id,"iherit",wm.connectInheritance));return d};a.redraw=function(){var d=modelManager.getModel(this._modelId);$("#"+this.divs.classname.id+" > .value").html(d.attribs.className);
var e=$(this.divs.properties);e.html("").append("<hr/>");for(var g in d.attribs.properties){var f=d.attribs.properties[g];if(typeof f!=="undefined"){var i=this._modelId,h=modelManager.getType(f.type).name;h=defaults.prefixes[f.visibility]+f.name+" : "+h;i=getOnclickProperty("properties",h,i,g);e.append(i).append("<br/>")}}e.append("<hr/>");for(g in d.attribs.methods){f=d.attribs.methods[g];if(typeof f!==undefined){i=this._modelId;h=modelManager.getType(f.type).name;h=defaults.prefixes[f.visibility]+
f.name+"( "+drawParams(f)+") : "+h;i=getOnclickProperty("methods",h,i,g);e.append(i).append("<br/>")}}};return a};drawParams=function(a){for(var b="",c=0;c<a.parameters.length;c++){if(c>0)b+=",";var d=a.parameters[c],e=modelManager.getType(d.type).name;b+=d.name+" : "+e}return b};
getOnclickProperty=function(a,b,c,d){b=$("<span>").append(b);b.mouseover(function(){$(this).removeClass("normalLink").addClass("hoverLink")});b.mouseout(function(){$(this).removeClass("hoverLink").addClass("normalLink")});b.get(0).onclick=function(i,h){return function(){return genericgui.showEditForm(i,a+"."+h)}}(c,d);var e=$("<span>").append("delete").addClass("normalBtn").mouseover(function(){$(this).removeClass("normalBtn").addClass("hoverLink")}).mouseout(function(){$(this).removeClass("hoverLink").addClass("normalBtn")});
if(a==="properties")e.click(function(){controller.deleteProperty(c,d)});else a==="methods"&&e.click(function(){controller.deleteMethod(c,d)});for(var g="",f=0;f<5;f++)g+="&nbsp;";return $("<span>").append(b).append(g).append(e)};
factory=classFactory={creator:{model:{},createClassModel:function(a){a||(a=idManager.getNewId());return new classModel({id:a,type:"class"})},createClassView:function(a){a.width=a.height=250;return createClassView(a)},createInterfaceModel:function(a){a||(a=idManager.getNewId());return new InterfaceModel({id:a})},createInterfaceView:function(a){return InterfaceView(a)}},serializator:{serialize:function(){}},deserializator:{createClassModel:function(a){return new classModel({initial:a,id:a.id})},createClassView:function(a){return createClassView({initial:a,
model:a.model,width:a.width,height:a.height,id:a.id})},createInterfaceModel:function(a){return new InterfaceModel({initial:a,model:a.model,id:a.id})},createInterfaceView:function(a){return factory.creator.createInterfaceView({initial:a,model:a.model,id:a.id})}},gui:{addProperty:function(a){return this.genericAdd(a,"properties")},addMethod:function(a){return this.genericAdd(a,"methods")},genericAdd:function(a,b){a=modelManager.getModel(document.getElementById(a)._modelId);var c=[];for(var d in a.attribs[b])c.push(d);
c.sort();for(var e=0,g=0;g<c.length;g++){e=parseInt(d[g])+1;if(a.attribs[b][e]===undefined)break}genericgui.showEditForm(a.id,b+"."+e)},createGui:function(a){var b=factory.gui.methods,c=BaseGui.createInput;$(a).append("Adding/removing class diagram objects:");$(c("Add new class","factory.gui.newClass")).click(b.newClass).appendTo(a);$(c("Add new interface")).click(b.newInterface).appendTo(a)},methods:{newClass:function(){controller.createNewClass({top:200,left:100,moveable:true})},newInterface:function(){controller.createNewInterface({top:200,
left:100,moveable:true})}}}};allowed_connections={implementation:[{0:"class",1:"interface"}],inheritance:[{0:"class",1:"class"}],asm:[{0:"state",1:"state"},{0:"conditional",1:"state"},{0:"state",1:"conditional"}]};
createBaseView=function(a){a.moveable=true;var b=wm.createWindow(a),c=$("#"+b.id+"> .movingDiv:first"),d=c.attr("onmousedown");c.removeAttr("onmousedown").mousedown(function(e){wm._forceInputs||b.hideInputs();d.call(this,e)});b.origClass=b.className;b._modelId=a.model.id;b.connections=new Earray;b.inner=genericgui.createNewDiv("","innerDiv");b.appendChild(b.inner);b.content=genericgui.createNewDiv();b.inner.appendChild(b.content);b.mouseIO=0;b.addConnection=function(e){this.connections.push(e)};b.removeConnection=
function(e){for(var g=0;g<this.connections.length;g++)if(this.connections[g].btn===e)break;if(g===this.connections.length-1)this.connections.pop();else this.connections[g]=this.connections.pop()};b.removeConnectionById=function(e,g){if(g)this.connections.removeAt(g);else{for(g=0;g<this.connections.length;g++)if(this.connections[g].id===e)break;g<this.connections.length&&this.connections.removeAt(g)}};b.callLater=function(e){return function(){if(e.optionsDiv){e.optionsDiv.remove();e.optionsDiv=undefined}}};
b.hideInputs=function(){if(this.optionsDiv)if(!this.interval)this.interval=setTimeout(this.callLater(this),1E3)};b.showInputs=function(){if(this.interval){clearTimeout(this.interval);this.interval=undefined}var e=toInt(this.style.left),g=toInt(this.style.top),f=toInt(this.style.width);toInt(this.style.height);if(this.optionsDiv){this.optionsDiv.remove();clearTimeout(this.interval);this.optionsDiv=this.interval=undefined}this.optionsDiv=$("<div>").append(this.getOptions()).append("<br/>").mouseover(function(){if(this.associatedView.interval){clearTimeout(this.associatedView.interval);
this.associatedView.interval=undefined}}).mouseout(function(){this.associatedView.interval=setTimeout(this.associatedView.callLater(this.associatedView),1E3)}).css({left:e+f,top:g,position:"absolute"}).appendTo("#main_div").fadeIn();this.optionsDiv.get(0).associatedView=this};b.onmouseover=function(){this.mouseIO+=1;var e=wm.__marked_info.type;if(e==="connecting"){this.origClass=this.className;this.className="over"}var g=wm._forceInputs;if(g!=="show")if(g!=="hide")if(!e&&e!=="resize")this.showInputs();
else e==="resize"&&this.hideInputs()};b.onmouseout=function(){this.mouseIO-=1;this.className=this.origClass;var e=wm.__marked_info.type,g=wm._forceInputs;if(g!=="show")if(g!=="hide")if(!e||e==="resize")this.hideInputs()};b.onclick=function(){if(wm.__marked_info.type==="connecting")if(wm.connectedFirstClass===this){viewManager.delete_wire(wm.__marked_info.obj);wm.__marked_info.obj=undefined;wm.__marked_info.type=wm.__marked_info.connection_type=""}else{for(var e=false,g=wm.connectedFirstClass,f=this,
i=allowed_connections[wm.__marked_info.connection_type],h=0;h<i.length;h++)if(i[h][0]===g.type&&i[h][1]===f.type){e=true;break}if(e)if(wm.connectedFirstClass!==this)if(!(wm.__marked_info.connection_type==="implementation"&&this.type!=="interface")){e=wm.__marked_info.obj;g=e.firstButton();f=this._modelId;i=wm.connectedFirstClass._modelId;h=idManager.getNewId();var j=wm.__marked_info.connection_type;g.connection_id=h;g.connection_type=j;this.addConnection({btn:e,id:h});e.parentLogic=this;wm.connectedFirstClass.addConnection({btn:g,
id:h});g.parentLogic=wm.connectedFirstClass;e.redraw();viewManager.addConnection(g);controller.addConnection(i,f,j,h);wm.__marked_info.obj=undefined;wm.__marked_info.type=wm.__marked_info.connection_type=""}}};b.toSerialize=function(){var e=baseToSerialize(this);e.connections=[];this.connections.foreach(function(){e.connections.push({id:this.id,btnid:this.btn.id})});e.modelId=this._modelId;e.type=this.type;return e};if(a.initial){b.style.top=a.initial.top;b.style.left=a.initial.left;b.style.width=
a.initial.width;b.style.height=a.initial.height;b._modelId=a.initial.modelId;b.type=a.initial.type;dbg(document.getElementById(a.initial.id));b.id=a.initial.id}return b};
ClassDeserializer={deserializeModels:function(){for(var a=serialized_data.models,b=0;b<a.length;b++){var c=a[b],d;if(c.type==="class")d=factory.deserializator.createClassModel(c);else if(c.type==="interface")d=factory.deserializator.createInterfaceModel(c);else if(c.type==="state")d=factory.deserializator.model.createState(c);else if(c.type==="conditional")d=factory.deserializator.model.createConditional(c);modelManager.addModel(d)}for(b=0;b<a.length;b++){c=a[b];var e=c.connections;d=modelManager.getModel(c.id);
for(c=0;c<e.length;c++){var g=e[c];g={connected:modelManager.getModel(g.connected),type:g.type,stat:g.stat,id:g.id};d.addConnection(g)}}},deserializeViews:function(){for(var a=serialized_data.views,b=0;b<a.length;b++){var c=a[b];c.model=modelManager.getModel(c.modelId);c=c.type==="class"?factory.deserializator.createClassView(c):c.type==="interface"?factory.deserializator.createInterfaceView(c):factory.deserializator.view["create_"+c.type](c);viewManager.addView(c._modelId,c);c.redraw();c.updatePos(parseInt(c.style.top),
parseInt(c.style.left))}for(b=0;b<serialized_data.wires.length;b++){a=serialized_data.wires[b];a.orientation==="wide"?wm.createHorizontalWire(parseInt(a.left),parseInt(a.left)+parseInt(a.width),parseInt(a.top),a.id):wm.createVerticalWire(parseInt(a.top),parseInt(a.top)+parseInt(a.height),parseInt(a.left),a.id)}for(b=0;b<serialized_data.buttons.length;b++){a=serialized_data.buttons[b];c=document.getElementById(a.conn.one.wire);var d=a.conn.one.pos,e=line2pos=undefined;if(a.conn.two){e=document.getElementById(a.conn.two.wire);
line2pos=a.conn.two.pos}buttonMaker.createWireBtn(c,e,d,d,line2pos,a.id);a.label&&buttonMaker.createLabel({text:a.label.text,btn:document.getElementById(a.id),posRelative:{x:a.label.pos.x,y:a.label.pos.y},width:a.label.base.width,height:a.label.base.height})}for(b=0;b<serialized_data.buttons.length;b++){c=serialized_data.buttons[b];a=document.getElementById(c.id);if(c.first)a.first=true;if(c.last)a.last=true;if(c.parentLogic)a.parentLogic=document.getElementById(c.parentLogic);if(c.connection_id)a.connection_id=
c.connection_id;if(c.connection_type)a.connection_type=c.connection_type;a.nextBtn=document.getElementById(c.nextBtn);a.prevBtn=document.getElementById(c.prevBtn)}for(b=0;b<serialized_data.views.length;b++){c=serialized_data.views[b];for(d=0;d<c.connections.length;d++){e=c.connections[d];a=document.getElementById(e.btnid);a.parentLogic.addConnection({btn:a,id:e.id});a.connection_id&&viewManager.addConnection(a)}}}};
cs={checkPropertyName:function(a,b,c){if(a.length<=2)return"too short";if(c)for(c=0;c<b.idxs.properties;c++)if(b.attribs.properties[c].name===a)return"property with name "+a+" already exists in that class";return""},checkAttrib:function(){return""},getBaseTypes:function(){if(this._type_cache)return this._type_cache;for(var a=new Earray,b=["int","string","double","bool"],c=0;c<b.length;c++){var d=new classModel({});d.attribs.className=b[c];a.push(d)}return this._type_cache=a}};FF_DEBUG=false;
dbg=function(a){FF_DEBUG&&console.log(a)};document.onclick=function(){var a=wm.__marked_info.type;if(a==="moving_wire"){wm.__marked_info.obj.redraw();wm.__marked_info.obj=wm.__marked_info.type=undefined}else if(a==="split_wire"||a==="delete_wire"||a==="cut_wire"||a==="add_label_wire"){wm.__marked_info.clicks+=1;if(wm.__marked_info.clicks===2||wm.__marked_info.clicks>2)tm.destroyToolTip()}else if(a==="down"){wm.__marked_info.obj=undefined;wm.__marked_info.type=undefined}};document.onmouseup=function(){};
types={property:{text:"Property",attribName:"properties"}};
wm={formShown:false,init:function(a,b){document.getElementById("main_div").getBoundingBox=function(){return{ne:{x:500,y:0},sw:{x:0,y:500}}};this.__colllisionNeighbours=b;this.__colllisionParent=a;this.__marked_info={obj:undefined,type:undefined}},markResized:function(a){obj=document.getElementById(a);a=wm.__marked_info.obj=obj;for(var b=document.getElementById("main_div"),c={top:0,left:0};a!==b;){c.top=parseInt(c.top)+parseInt(a.style.top);c.left=parseInt(c.left)+parseInt(a.style.left);a=a.parentNode}wm.__marked_info.resizeDiff=
{top:c.top,left:c.left};wm.__marked_info.type="resize";document.onmousemove=resizer.resizeMarked;document.onmouseup=wm._stopResize},createWindow:function(a){var b=windowCreator._createBaseWindow(a.left,a.top,a.inner,a.parentEl,a.id);if(a.type)b.type=a.type;a.firstObjects&&$(b).append(a.firstObjects);a.moveable?buttonMaker.createMovingBtn(b):this._assignEvents(b);styleManager.setBaseWindowStyle(b,{width:a.width,height:a.height,className:a.className});b.updatePos(parseInt(b.style.top),parseInt(b.style.left));
a.notResizable||buttonMaker.createBtn(b);return b},getPrefixForProp:function(){},createHorizontalWire:function(a,b,c,d){return windowCreator._createJoiningElement(a,b,c,c,d)},createVerticalWire:function(a,b,c,d){return windowCreator._createJoiningElement(c,c,a,b,d)},getConnPoint:function(a){return{x:parseInt(a.style.left)+parseInt(a.style.width)-defaults.wireMovingButtonWidth-10,y:parseInt(a.style.top)+parseInt(a.style.height)/2}},connectInterface:function(a,b){wm.__marked_info.connection_type="implementation";
wm.connect(a,b)},connectInheritance:function(a,b){wm.__marked_info.connection_type="inheritance";wm.connect(a,b)},connectAsm:function(a,b){wm.__marked_info.connection_type="asm";wm.connect(a,b)},connect:function(a,b){if(wm.__marked_info.type!=="connecting"){var c=connector.startConnecting(document.getElementById(b)).line2.btns[0];c.onmousedown(a);a={x:15+a.pageX-(parseInt(c.conn.one.wire.style.left)+parseInt(c.style.left)),y:a.pageY-(parseInt(c.conn.one.wire.style.top)+parseInt(c.style.top))};moveManager._move_wire_by_diff(c.conn.one.wire,
a,c.place,c,0,"previous");wm.__marked_info.type="connecting";wm.connectedFirstClass=viewManager.getView(b)}},__marked_info:{},__over_info:{},__colllisionNeighbours:false,__colllisionParent:false,_forceInputs:undefined,_assignEvents:function(a){a.onmouseover=this._manageMouseOver;a.onmouseout=this._manageMouseOut;a.onmousedown=this._manageMouseDown;document.mouseup=a.onmouseup=this._manageMouseUp},_stopResize:function(){wm.__marked_info.obj=undefined;document.onmousemove=document.onmouseup=undefined;
wm.__marked_info.type=undefined},_manageMouseClick:function(){},_genericManageMouseDown:function(){},_manageMouseDown:function(a){return wm._genericManageMouseDown(a,this)},_manageMouseUp:function(){if(wm.__marked_info.type!=="connecting")if(wm.__marked_info.obj)if(wm.__marked_info.type!=="resize")if(wm.__marked_info.type!=="split_wire")if(wm.__marked_info.type!=="delete_wire"){wm.__marked_info.obj=undefined;wm.__marked_info.type="";document.onmousemove=undefined}},_manageMouseOver:function(){},_manageMouseOut:function(){}};
baseToSerialize=function(a){return{id:a.id,top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height}};
collisionDetector={collideWithNeighbours:function(a){for(var b=0;b<defaults.classesDoesNotCollide.length;b++)if(a.className===defaults.classesDoesNotCollide[b])return false;b=this._getNeighbourDivs(a);a=a.getBoundingBox();for(var c=0;c<b.length;c++)if(b[c].getBoundingBox){var d=b[c].getBoundingBox();if(this._collide(a,d))return true;if(this._collide(d,a))return true}return false},collideWithParent:function(a){for(var b=0;b<defaults.classesDoesNotCollide.length;b++)if(a.className===defaults.classesDoesNotCollide[b])return false;
b=a.parentNode;b={ne:{x:parseInt(b.style.width),y:0},sw:{x:0,y:parseInt(b.style.height)}};a={ne:{x:parseInt(a.style.left)+parseInt(a.style.width),y:parseInt(a.style.top)},sw:{x:parseInt(a.style.left),y:parseInt(a.style.top)+parseInt(a.style.height)}};if(a.ne.x>=b.ne.x)return true;if(a.ne.y<=b.ne.y)return true;if(a.sw.x<=b.sw.x)return true;if(a.sw.y>=b.sw.y)return true;return false},_getNeighbourDivs:function(a){return $(a).parent().children("div").not(".cres").not(".wire").not("#"+a.id).not(".propertiesDiv").not(".add")},
_getBorderingDiv:function(a){return $(a).parent(":not(#main_div)")},_collide:function(a,b){if(a.ne.x>=b.sw.x&&a.ne.x<=b.ne.x){if(a.ne.y<=b.sw.y&&a.ne.y>=b.ne.y)return true;if(a.sw.y<=b.sw.y&&a.sw.y>=b.ne.y)return true}if(a.sw.x>=b.sw.x&&a.sw.x<=b.ne.x){if(a.sw.y>=b.sw.y&&a.sw.y<=b.ne.y)return true;if(a.ne.y<=b.sw.y&&a.ne.y>=b.ne.y)return true}return false}};connection=function(){};
connector={startConnecting:function(a){a=wm.getConnPoint(a);return connector._create_wire_points(a,{x:a.x+100,y:a.y+100})},connectToWdw:function(){},_getPlace:function(a){return{x:parseInt(a.style.left)+parseInt(a.style.width)/2,y:parseInt(a.style.top)+parseInt(a.style.height)/2}},_create_wire:function(a,b){a=this._getPlace(a);b=this._getPlace(b);return connector._create_wire_points(a,b)},_create_wire_points:function(a,b){var c=wm.createHorizontalWire(a.x,b.x,a.y);a=wm.createVerticalWire(a.y,b.y,
b.x);b=buttonMaker.createWireBtn(c,undefined,"topleft","topleft",undefined);var d=buttonMaker.createWireBtn(c,a,"widehigh","widehigh","topleft"),e=buttonMaker.createWireBtn(a,undefined,"widehigh","widehigh",undefined);b.first=true;b.nextBtn=d;d.prevBtn=b;d.nextBtn=e;e.prevBtn=d;e.last=true;return{line1:c,line2:a}},addWire:function(a){var b=a.conn.one.wire;if(b.orientation!=="wide"){var c=a.nextBtn;if(a.last)c=a.prevBtn;return connector.addWire(c)}if(a.first||a.last)alert("cant split wires here");
else{var d=a.conn.two.wire,e=undefined,g=e=40,f={x:undefined,y:undefined};c=a.nextBtn;var i=wire2place=undefined;if(b.orientation==="wide"){i=a.conn.one.pos;wire2place=c.conn.one.pos;f.y=parseInt(d.style.top)+parseInt(d.style.height)-parseInt(b.style.top);if(a.conn.two.pos==="topleft"){e=d;g=b}else{e=b;g=d}f.y=parseInt(e.style.top)+parseInt(e.style.height)-parseInt(g.style.top);if(a.conn.one.pos==="widehigh"){e=d;g=b}else{e=b;g=d}f.x=parseInt(e.style.left)+parseInt(e.style.width)-parseInt(g.style.left)}e=
f.y/2;g=f.x/2;if(b.orientation==="wide"){var h=wire3y=newWire3=undefined,j=newWire2y2=undefined;f=newWire3x2=undefined;if(a.conn.one.pos==="widehigh"){b.style.width=parseInt(b.style.width)-g;h=parseInt(b.style.left)+parseInt(b.style.width);f=parseInt(b.style.left)+parseInt(b.style.width);newWire3x2=parseInt(d.style.left)}else{b.style.left=parseInt(b.style.left)+g;b.style.width=parseInt(b.style.width)-g;h=parseInt(b.style.left);f=parseInt(d.style.left);newWire3x2=parseInt(b.style.left)}moveManager._update_wire_buttons(b);
if(a.conn.two.pos==="topleft"){d.style.top=parseInt(d.style.top)+e;d.style.height=parseInt(d.style.height)-e;wire3y=parseInt(d.style.top);j=parseInt(b.style.top);newWire2y2=j+e}else{d.style.height=parseInt(d.style.height)-e;wire3y=parseInt(d.style.top)+parseInt(d.style.height);j=parseInt(d.style.top)+parseInt(d.style.height);newWire2y2=parseInt(b.style.top)}moveManager._update_wire_buttons(d);e=wm.createVerticalWire(j,newWire2y2,h);newWire3=wm.createHorizontalWire(f,newWire3x2,wire3y);f=a.conn.two.pos;
b=buttonMaker.createWireBtn(e,newWire3,wire2place,wire2place,a.conn.one.pos==="widehigh"&&"topleft"||"widehigh");d=buttonMaker.createWireBtn(newWire3,d,i,i,f);if(a.last){a.last=undefined;newBtn4.last=true}c.prevBtn=d;d.prevBtn=b;d.nextBtn=c;b.nextBtn=d;b.prevBtn=a;a.conn.two.wire=e;a.nextBtn=b}}},_create_assocation:function(){},_connect_assocation:function(){},connect:function(a,b){var c=this._create_wire(a,b);this._create_assocation(a,c.line1,b);this._create_assocation(b,c.line2,a);this.addWire(c.line1.btns[1])}};
styleManager={setBaseWindowStyle:function(a,b){this._baseSetStyle(a,b.width,b.height);a.className=b.className||defaults.windowClassName},setWireStyle:function(a,b,c){this._baseSetStyle(a,b,c);a.className="wire"},_baseSetStyle:function(a,b,c){if(typeof b==="undefined")b=defaults.windowWidth;if(typeof c==="undefined")c=defaults.windowHeight;a.style.position="absolute";a.style.width=b;a.style.height=c}};toInt=function(a){return parseInt(a,10)};
buttonMaker={height:15,width:15,moveButton:function(a){var b=document.getElementById("r"+a.id);buttonMaker._setPos(a,b,"widehigh")},showLabelForm:function(a,b,c){a=document.getElementById(a);var d=genericgui.createForm({height:5});d.id=idManager.getNewId();var e="Enter label here: ";e+=widgetGenerator.input("idlabel",a.label_text||defaults.wireLabel);e+="<br/>";e+=widgetGenerator.submitButton(b,genericgui.getParams(a.id,d.id),c||"Add label");e+=widgetGenerator.submitButton("buttonMaker.closeLabelForm",
genericgui.getParams(d.id),"cancel");e+="<br/>";e+="<br/>";d.appendChild(genericgui.createNewDiv(e,"add",true))},addLabel:function(a,b){this.createLabel({btn:document.getElementById(a),text:$("#idlabel").val()});buttonMaker.closeLabelForm(b)},editLabel:function(a,b){a=document.getElementById(a);var c=$("#idlabel").val();a.label_text=c;$(a.label).find(".inner:first").html(c);a.label.label_text=c;buttonMaker.closeLabelForm(b)},removeLabel:function(a){a=document.getElementById(a);delete a.btn.label;
$(a).remove()},createLabel:function(a){var b=wm.createWindow({type:"label",width:a.width&&a.width||defaults.wireLabelWidth,height:a.height&&a.height||defaults.wireLabelHeight,top:100,left:100,className:"buttonlabel",moveable:true,notResizable:false});b.btn=a.btn;b.updateRelativePos=function(){this.posX=toInt(this.style.left)-this.btn.getAbsolutePos().x;this.posY=toInt(this.style.top)-this.btn.getAbsolutePos().y};b.moveAfterFollowedBtn=function(){b.style.left=a.btn.getAbsolutePos().x+b.posX;b.style.top=
a.btn.getAbsolutePos().y+b.posY};$(b).append($('<span class="inner">'+a.text+"</span>")).append($(widgetGenerator.submitButton("buttonMaker.removeLabel",genericgui.getParams(b.id),"delete"))).append($(widgetGenerator.submitButton("buttonMaker.showLabelForm",genericgui.getParams(a.btn.id,"buttonMaker.editLabel","save"),"edit")));b.label_text=a.text;if(a.posRelative){b.posX=a.posRelative.x;b.posY=a.posRelative.y}else{b.posX=defaults.wireLabelDiffX;b.posY=defaults.wireLabelDiffY}b.moveAfterFollowedBtn();
b.onmouseover=function(){wm._forceInputs||wm.__marked_info.type||$(this).find("input").show()};b.onmouseout=function(){wm._forceInputs||wm.__marked_info.type||$(this).find("input").hide()};a.btn.label=b;b.updateRelativePos();b.onmouseout();document.getElementById("main_div").appendChild(b)},closeLabelForm:function(a){$("#"+a).remove()},createBtn:function(a){var b=this._getStyleTxt("silver",defaults.resizeButtonWidth,defaults.resizeButtonHeight),c='<div class="cres"';c+=' id="r'+a.id+'"';c+=' style="'+
b+'"';c+='" onmousedown="wm.markResized(\''+a.id+"')\"";c+="</div>";$(a).append(c);this._setPos(a,document.getElementById("r"+a.id),"widehigh")},createWireBtn:function(a,b,c,d,e,g){g=this._createWireBtnHtml(a,g);$(a).append(g.txt);g=document.getElementById(g.id);g._parent=a;this._setPos(g._parent,g,c);g.place=c;g.conn={};g.conn.one={};g.conn.one.pos=d;g.conn.one.wire=a;g.conn.two={};g.conn.two.pos=e;g.conn.two.wire=b;a.btns.push(g);g.getAbsolutePos=function(){return{x:toInt(this.style.left)+toInt(this.parentNode.style.left),
y:toInt(this.style.top)+toInt(this.parentNode.style.top)}};g.getDataToCopy=function(f){for(var i=["first","last","parentLogic","label"],h=0;h<i.length;h++)if(this[i[h]])f[i[h]]=this[i[h]];if(this.first){f.connection_id=this.connection_id;f.connection_type=this.connection_type}};g.onmousedown=wm._manageMouseDown;g.onmouseup=function(){this.redraw();if(wm.__marked_info.type==="moving_wire")wm.__marked_info.obj=wm.__marked_info.type=undefined};g.onmouseover=function(){var f=wm.__marked_info.type;if(f===
"split_wire"||f==="delete_wire"||f==="cut_wire"||f==="add_label_wire"){f=defaults.wireMovingButtonWidth;var i=defaults.wireMovingButtonHeight,h=3;if(this.last){i=f=defaults.wireMovingButtonEndWidth;h=2}this.style.width=h*f;this.style.height=h*i}};g.onmouseout=function(){var f=wm.__marked_info.type;if(f==="split_wire"||f==="delete_wire"||f==="cut_wire"||f==="add_label_wire")if(this.last){this.style.width=defaults.wireMovingButtonEndWidth;this.style.height=defaults.wireMovingButtonEndHeight}else{this.style.width=
defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonHeight}};g.onclick=function(){var f=wm.__marked_info.type;if(f==="split_wire"){this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonHeight;connector.addWire(this);this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;tm.destroyToolTip()}else if(f==="delete_wire"){f=this.firstButton();var i=this.lastButton();controller.deleteConnection(f.parentLogic._modelId,
i.parentLogic._modelId,f.connection_id);tm.destroyToolTip()}else if(f!=="change_connection_type")if(f==="add_label_wire"){this.label?alert("This button already has a label. To add new label, please remove the existing one."):buttonMaker.showLabelForm(this.id,"buttonMaker.addLabel");this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;tm.destroyToolTip()}else if(f==="cut_wire"){this.style.width=defaults.wireMovingButtonWidth;this.style.height=defaults.wireMovingButtonWidth;
if(!this.first&&!this.last)alert("can cut only first and last button");else{if(this.first){f=this;for(var h=0;h<2;h++)f=f.nextBtn;if(f.last){alert("too little boxes");return}}else{f=this;for(h=0;h<2;h++)f=f.prevBtn;if(f.first){alert("too little boxes");return}}var j=h=undefined;f=undefined;var k=0,l=0;if(this.conn.one.wire.orientation==="high"){h="nextBtn";j="prevBtn";f="two";if(this.last){h="prevBtn";j="nextBtn";f="one"}k=toInt(this.conn.one.wire.style.height)}else{h="nextBtn";j="prevBtn";f="two";
if(this.last){h="prevBtn";j="nextBtn";f="one"}l=toInt(this.conn.one.wire.style.width)}i=this[h];var m=this[h][h];if(this.conn.one.pos!=="widehigh"){k=-k;l=-l}moveManager._move_wire({x:l,y:k},m);k=buttonMaker.createWireBtn(i.conn[f].wire,undefined,i.conn[f].pos,i.conn[f].pos,undefined);this.getDataToCopy(k);k[h]=m;k[j]=undefined;m[j]=k;for(h=0;h<this.parentLogic.connections.length;h++)if(this.parentLogic.connections[h].btn.id===this.id)break;this.parentLogic.connections[h]={btn:k};i.conn[f].wire.appendChild(k);
buttonMaker._setPos(k.conn.one.wire,k,k.place);$(this.conn.one.wire).remove();$(i).remove();k.redraw()}}};g.onmousedown=function(f){if(wm.__marked_info.type!="resize")if(!wm.__marked_info.obj){wm.__marked_info.type="moving_wire";wm.__marked_info.obj=this;wm.__marked_info.top=this._parent.style.top;wm.__marked_info.left=this._parent.style.left;wm.__marked_info.pageX=f.pageX;wm.__marked_info.pageY=f.pageY;wm.__marked_info.diffX=f.pageX-toInt(this.style.left);wm.__marked_info.diffY=f.pageY-toInt(this.style.top);
document.onmousemove=moveManager.moveMarked}};g.toSerialize=function(){var f=baseToSerialize(this);f.parentNodeId=this.parentNode.id;f.conn={one:{wire:this.conn.one.wire.id,pos:this.conn.one.pos}};if(this.conn.two.wire)f.conn.two={wire:this.conn.two.wire.id,pos:this.conn.two.pos};if(this.nextBtn)f.nextBtn=this.nextBtn.id;if(this.prevBtn)f.prevBtn=this.prevBtn.id;if(this.first){f.first=true;f.connection_id=this.connection_id;f.connection_type=this.connection_type}if(this.last)f.last=true;if(this.parentLogic)f.parentLogic=
this.parentLogic.id;if(this.label){var i=this.label;f.label={text:i.label_text,pos:{x:i.posX,y:i.posY},base:baseToSerialize(this.label)}}return f};g.firstButton=function(){for(var f=this;!f.first;)f=f.prevBtn;return f};g.lastButton=function(){for(var f=this;!f.last;)f=f.nextBtn;return f};g.redraw=function(){var f=this.firstButton().connection_type,i=this.lastButton();i.drawSign(f);buttonMaker._setPos(i.conn.one.wire,i,i.conn.one.pos);(f=moveManager._box_difference(this,{x:0,y:0}))&&f.wx>=0&&dbg("error during redrawing wire btn")};
g.drawSign=function(f){this.style.width=this.style.height=1;f="/site_media/"+f+this.conn.one.pos.substring(0,3)+this.conn.one.wire.orientation.substring(0,3)+".png";var i=0,h=0;if(this.conn.one.wire.orientation==="wide"){i=-(defaults.arrowSize/2);h=0}else{i=0;h=-(defaults.arrowSize/2)}h=h.toString();i=i.toString();f=$('<img src="'+f+'"/>').css({left:h,top:i,position:"absolute"});$(this).children().remove();this.appendChild(f.get(0));f.click(function(j){return function(k){return j.onclick(k)}}(this)).mouseover(function(j){return function(k){j.onmouseover(k)}}(this))};
return g},createMovingBtn:function(a,b){var c=document.createElement("div");c.id=idManager.getNewId();c.className="movingDiv";c.style.height=b||defaults.movingBtnHeight;c.style.width="100%";c.style.left=0;c.style.top=0;c.getBoundingBox=function(){return{ne:{x:toInt(this.style.left)+toInt(this.style.width),y:toInt(this.style.top)},sw:{x:toInt(this.style.left),y:toInt(this.style.top)+toInt(this.style.height)}}};c._parent=a;wm._assignEvents(c);c.onmousedown=function(d){if(wm.__marked_info.type!="resize")if(!wm.__marked_info.obj){wm.__marked_info.type=
"down";wm.__marked_info.top=this._parent.style.top;wm.__marked_info.left=this._parent.style.left;var e=wm.__marked_info.obj=this._parent;wm.__marked_info.diffX=d.pageX-toInt(e.style.left);wm.__marked_info.diffY=d.pageY-toInt(e.style.top);document.onmousemove=moveManager.moveMarked}};c.onmouseup=document.onmouseup;c.onclick=document.onclick;a.appendChild(c)},createConnectBtn:function(a,b,c){return $("<button>"+b+"</button>").click(function(d){return c(d,a)})},_getStyleTxt:function(a,b,c){b="width: "+
b+"px; height: "+c+"px;";b+=" position: absolute; background: "+a;return b},_createWireBtnHtml:function(a,b){a='<div class="wirehandle"';var c=this._getStyleTxt(defaults.wireBtnColor,defaults.wireMovingButtonWidth,defaults.wireMovingButtonHeight),d=undefined;d=b?b:idManager.getNewId();a+=' id="'+d+'"';a+=' style="'+c+'"';a+="</div>";return{txt:a,id:d}},_setPos:function(a,b,c){var d=0,e=0;if(c==="widehigh"){d=toInt(a.style.width)-toInt(b.style.width);e=toInt(a.style.height)-toInt(b.style.height)}b.style.top=
e;b.style.left=d}};idManager={max_id_number:0,prefix:"i",getNewId:function(){this.max_id_number+=1;if(document.getElementById(this.prefix+this.max_id_number)){dbg("znalazlem !!");dbg(this.max_id_number)}return this.prefix+this.max_id_number}};
defaults={windowWidth:100,windowHeight:100,wireSize:1,windowClassName:"orange",resizeButtonWidth:15,resizeButtonHeight:15,movingBtnHeight:10,wireBtnColor:"silver",asmViewWidth:100,asmViewHeight:100,wireMovingButtonWidth:10,wireMovingButtonHeight:10,wireMovingButtonEndWidth:30,wireMovingButtonEndHeight:30,wireLabel:"Enter label here",wireLabelDiffX:30,wireLabelDiffY:0,wireLabelWidth:100,wireLabelHeight:100,arrowSize:30,stateDescription:"New state",condition:"enter your condition here",classesDoesNotCollide:["add"],
propertyVisibility:"protected",className:"New class name",interfaceName:"New interface",prefixes:{"private":"-","public":"+","protected":"#"},visSet:[{name:"public",val:"public"},{name:"protected",val:"protected"},{name:"private",val:"private"}]};
initialize=function(){var a={1:classFactory,2:asmFactory};language=cs;wm.init(false,false);modelManager.initialize();factory=a[window.diagramData.type];window.diagramData.load&&deserializer.deserialize(window.serialized_data);document.getElementById("main_div").classes=[];BaseGui.createGui($("#userGui > #genericGui"),diagramData.read_only);factory.gui.createGui($("#userGui > #specificGui"))};
windowCreator={_createJoiningElement:function(a,b,c,d,e){var g=defaults.wireSize;e=this._createBaseWindow(a,c,"",undefined,e);var f=Math.abs(b-a),i=Math.abs(d-c),h=e.orientation=f<i&&"high"||"wide",j=undefined,k=undefined;if(h==="wide"){j=f;k=g}else{j=g;k=i}e.zwrot=h==="wide"?b<a?"left":"right":d-c<0?"up":"down";e.btns=[];styleManager.setWireStyle(e,j,k);e.toSerialize=function(){var l=baseToSerialize(this);l.orientation=this.orientation;return l};e.addButton=function(l){this.btns.push(l)};e.onmousedown=
function(){};return e},_createBaseWindow:function(a,b,c,d,e){var g=document.createElement("div");g.innerHTML=c||"";g.id=typeof e==="string"?e:idManager.getNewId();g.connections={assocation:[]};g._cached_pos={top:0,left:0};g.getBoundingBox=function(){return this._cached_bounding_box};g.updatePos=function(f,i){this.style.top=f;this.style.left=i;this._cached_bounding_box={ne:{x:parseInt(i)+parseInt(this.style.width),y:parseInt(this.style.top)},sw:{x:parseInt(this.style.left),y:parseInt(f)+parseInt(this.style.height)}}};
if(typeof a!=="undefined"&&typeof b!=="undefined"){g.style.top=b||b+"px";g.style.left=a||a+"px"}a=d||document.getElementById("main_div");a.appendChild(g);g._parent=a;return g}};
BaseGui={showInputs:true,showWireButtons:true,createInput:function(a){return'<input type="submit" value="'+a+'"/>'},changeModeId:undefined,createGui:function(a,b){var c=function(j){return'<div id="'+j+'" />'},d={state:0,getNewId:function(){this.state+=1;return"guiid"+this.state}},e=BaseGui.methods,g=BaseGui.createInput,f=d.getNewId(),i=d.getNewId(),h=d.getNewId();$(a).append(c(f)).append(c(i)).append(c(h));a=$("#"+f);i=$("#"+i);h=$("#"+h);a.append("<span>Managing wires: </span>");a.append($(g("Split wire")).click(e.splitWire));
a.append($(g("Delete wire")).click(e.deleteWire));a.append($(g("Cut wire")).click(e.cutWire));a.append($(g("add label to wire")).click(e.addLabel));a=$(g("hide wire buttons")).click(e.toogleWireButtons);$(a).attr("id",d.getNewId());BaseGui.toogleWireButtonsId=$(a).attr("id");d=$(g("turn collision neighbour objects on")).click(e.toogleNeighbourCollision);wm.__colllisionNeighbours=true;d.click(undefined);i.append("<span>Visibility/behaviour:</span>");i.append(a).append(d);$("#main_div").find("input").hide();
d=$(g("save")).click(function(){$("#idSerializedData").val(serializator.serializeAll());$("#save_form").submit()});if(b)d=$("");h.append("<span>File options:</span>").append(d).append($(g("close")).click(function(){window.location=project_id==-1?"/demo_choose_type/":"/project/"+project_id+"/"}))},methods:{splitWire:function(a){wm.__marked_info.type="split_wire";return tm.movingTooltip(a,"click on box on wire to split that wire",-3*defaults.wireMovingButtonWidth,0)},deleteWire:function(a){wm.__marked_info.type=
"delete_wire";return tm.movingTooltip(a,"click on a wire to delete",-20,0)},cutWire:function(a){wm.__marked_info.type="cut_wire";return tm.movingTooltip(a,"click on a box of the wire you wish to cut",-20,0)},addLabel:function(a){wm.__marked_info.type="add_label_wire";return tm.movingTooltip(a,"click on a box of the wire to add a label to it",-20,0)},toogleWireButtons:function(){var a=$(".wirehandle").filter(function(){return!this.last});BaseGui.showWireButtons=!BaseGui.showWireButtons;if(BaseGui.showWireButtons){a.show();
a="hide wire buttons"}else{a.hide();a="show wire buttons"}$("#"+BaseGui.toogleWireButtonsId).val(a)},toogleNeighbourCollision:function(){var a=!wm.__colllisionNeighbours;a=(wm.__colllisionNeighbours=a)&&"turn off collision detection"||"turn on collision detection";$(this).val(a)}}};
moveManager={moveMarked:function(a){if(wm.__marked_info.type!="resize"){var b=wm.__marked_info.obj,c=undefined;if(b!==undefined){c=b.className==="wirehandle"?moveManager._moveWire:moveManager._moveElement;c(b,a)}}},_getNewTopLeft:function(a){return{top:a.pageY-wm.__marked_info.diffY,left:a.pageX-wm.__marked_info.diffX}},_moveElement:function(a,b){var c={top:a.style.top,left:a.style.left},d=moveManager._getNewTopLeft(b).top;b=moveManager._getNewTopLeft(b).left;a.updatePos(d,b);if(moveManager._collide(a))a.updatePos(c.top,
c.left);else{c={x:b-parseInt(c.left),y:d-parseInt(c.top)};moveManager._moveAssocations(a,c)}dbg("_moveElement: moved.id: "+a.id);a.updateRelativePos&&a.updateRelativePos()},_moveAssocations:function(a,b){if(a.connections)for(var c=0,d=a.connections.length;c<d;c++)moveManager._move_wire(b,a.connections[c].btn)},_moveWire:function(a,b){diff={};diff.x=b.pageX-wm.__marked_info.pageX;diff.y=b.pageY-wm.__marked_info.pageY;wm.__marked_info.pageX=b.pageX;wm.__marked_info.pageY=b.pageY;moveManager._move_wire(diff,
a,"one",0)},_update_wire_buttons:function(a){for(var b=0;b<a.btns.length;b++)buttonMaker._setPos(a,a.btns[b],a.btns[b].place)},unprecedented:{active:false,type:undefined,direction:undefined,setActive:function(){this.active=true;var a="undirect";if(wm.__marked_info.obj.className==="wirehandle")a="direct";this.type=a},setNewMargin:function(a,b){if(b==="high"){if(a.wx>=0)moveManager._diff_margin.wx=a.wx;if(a.ex<=0)moveManager._diff_margin.ex=a.ex}else if(b==="width"){if(a.ny>=0)moveManager._diff_margin.ny=
a.ny;if(a.sy<=0)moveManager._diff_margin.ex=a.ex}},clearMargin:function(){moveManager._diff_margin={wx:0,ex:0,ny:0,sy:0}}},_move_wire_by_diff:function(a,b,c,d,e,g){var f=function(k){var l=k==="widehigh"&&"topleft"||"widehigh";if(d.first){d.conn.one.pos=d.place=k;d.nextBtn.conn.one.pos=d.nextBtn.place=l}else if(d.last){d.conn.one.pos=d.place=k;d.prevBtn.conn.two.pos=l}else{if(d.conn.one.wire===a)d.conn.one.pos=d.place=k;else d.conn.two.pos=k;k=["nextBtn","prevBtn"];for(var m,n=0;n<2;n++){m=k[n];if(d[m].conn.one.wire===
a)d[m].conn.one.pos=d[m].place=l;else if(d[m].conn.two.wire===a)d[m].conn.two.pos=l}}};if(!moveManager._check_collide_parent(d,b)){if(a.orientation==="wide"){if(b.x!==0){var i=width=parseInt(a.style.width),h=oldLeft=parseInt(a.style.left);if(c==="topleft"){h+=b.x;width-=b.x}else width+=b.x;if(width<0){width=Math.abs(width);if(c==="topleft"){h=oldLeft+i;a.style.width=width;a.style.left=h;f("widehigh")}else{h=oldLeft-width;a.style.width=width;a.style.left=h;f("topleft")}}a.style.width=width;a.style.left=
h}if(b.y!==0){i=parseInt(a.style.top);a.style.top=parseInt(a.style.top)+b.y;if(e===0){c=undefined;if(g==="next"){c=d.nextBtn;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.two.wire,{x:0,y:b.y},c.conn.two.pos,c,e+1,g)}else if(g==="previous"){c=d.prevBtn;if(c.first||c.last){moveManager._check_collide_parent(c,{x:0,y:b.y});return}moveManager._move_wire_by_diff(c.conn.one.wire,{x:0,y:b.y},c.conn.one.pos,c,e+1,g)}}}}else{if(b.y!==0){h=oldHeight=parseInt(a.style.height);var j=i=parseInt(a.style.top);
if(c==="topleft"){j+=b.y;h-=b.y}else h+=b.y;if(h<0){h=Math.abs(h);if(c==="topleft"){j=i+oldHeight;a.style.height=width;a.style.top=j;f("widehigh")}else{j=i-h;a.style.height=h;a.style.top=j;f("topleft")}}a.style.height=h;a.style.top=j}if(b.x!==0){a.style.left=parseInt(a.style.left)+b.x;if(e===0){c=undefined;if(g==="next"){c=d.nextBtn;if(c.last)return;if(c.last||c.first)return;moveManager._move_wire_by_diff(c.conn.two.wire,{x:b.x,y:0},c.conn.two.pos,c,e+1,g)}else if(g==="previous"){c=d.prevBtn;if(c.last||
c.first)return;moveManager._move_wire_by_diff(c.conn.one.wire,{x:b.x,y:0},c.conn.one.pos,c,e+1,g)}}}}moveManager._update_wire_buttons(a);d.label&&d.label.moveAfterFollowedBtn()}},_diff_margin:{wx:0,ex:0,sy:0,ny:0},_box_difference:function(a,b){if((a.first||a.last)&&a.parentLogic){var c=a.parentNode.style;b={left:parseInt(c.left)+parseInt(a.style.left)+b.x,top:parseInt(c.top)+parseInt(a.style.top)+b.y};b={ne:{x:parseInt(b.left)+parseInt(a.style.width),y:parseInt(b.top)},sw:{x:parseInt(b.left),y:parseInt(b.top)+
parseInt(a.style.height)}};a=a.parentLogic.style;a={ne:{x:parseInt(a.left)+parseInt(a.width),y:parseInt(a.top)},sw:{x:parseInt(a.left),y:parseInt(a.top)+parseInt(a.height)}};return{wx:a.sw.x-b.sw.x,ex:a.ne.x-b.ne.x,sy:a.sw.y-b.sw.y,ny:a.ne.y-b.ne.y}}},_check_collide_parent:function(a,b){if(wm.__marked_info.obj.className==="wirehandle"){if((a.first||a.last)&&a.parentLogic){a=this._box_difference(a,b);if(a.wx>=this._diff_margin.wx)return true;if(a.ex<=this._diff_margin.ex)return true;if(a.sy<=this._diff_margin.sy)return true;
if(a.ny>=this._diff_margin.ny)return true}return false}},_move_wire:function(a,b){var c=b.conn.one.wire,d=b.conn.two.wire;if(!function(e,g){if(e.first||e.last){if(moveManager._check_collide_parent(e,g))return true;return false}for(var f=["prevBtn","nextBtn"],i=0,h=c.orientation==="wide"?0:0;h<2;h++){i=f[h];if((e[i].first||e[i].last)&&e[i].parentLogic)if(e[i].conn.one.wire.orientation==="wide"){if(moveManager._check_collide_parent(e[i],{x:0,y:g.y}))return true}else if(moveManager._check_collide_parent(e[i],
{x:g.x,y:0}))return true}return false}(b,a))if(b.first)moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"next");else if(b.last)moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"previous");else{moveManager._move_wire_by_diff(c,a,b.conn.one.pos,b,0,"previous");d&&moveManager._move_wire_by_diff(d,a,b.conn.two.pos,b,0,"next")}},_collide:function(a){if(wm.__colllisionNeighbours)if(collisionDetector.collideWithNeighbours(a))return true;if(wm.__colllisionParent)if(collisionDetector.collideWithParent(a))return true;
return false}};
resizer={resizeMarked:function(a){var b=wm.__marked_info.obj,c={top:parseInt(b.style.top),left:parseInt(b.style.left),width:parseInt(b.style.width),height:parseInt(b.style.height)};b.style.width=a.pageX-wm.__marked_info.resizeDiff.left;b.style.height=a.pageY-wm.__marked_info.resizeDiff.top;a=false;if(wm.__colllisionNeighbours)if(collisionDetector.collideWithNeighbours(b))a=true;if(wm.__colllisionParent&&!a)if(collisionDetector.collideWithParent(b))a=true;if(a||parseInt(b.style.width)<10||parseInt(b.style.height)<
10){b.style.width=parseInt(c.width);b.style.height=parseInt(c.height)}b.updatePos(parseInt(b.style.top),parseInt(b.style.left));a||buttonMaker.moveButton(b);b.afterResize&&b.afterResize()}};
serializator={serializeAll:function(){var a="{models: "+this._serializeModels();a+=", wires: "+this._serializeWires();a+=",views: "+this._serializeViews();a+=",buttons: "+this._serializeButtons();a+=",connections: "+this._serializeConnections();a+=",max_id_number: "+idManager.max_id_number;a+="}";return a},_serializeModels:function(){var a="[",b=0;ct.models.foreach(function(){if(b>0)a+=",";a+=serializator._serialize(this.toSerialize());b++});a+="]";return a},_serializeViews:function(){var a="[",b=
0;for(var c in viewManager.views)for(var d=0;d<viewManager.views[c].length;d++){var e=viewManager.views[c][d];if(b>0)a+=",";a+=this._serialize(e.toSerialize());b+=1}a+="]";return a},_serializeConnections:function(){var a=0,b="";for(var c in viewManager.connections){var d=viewManager.connections[c];if(a>0)b+=",";b+=this._serialize(d.toSerialize());a+=1}},_serializeWires:function(){return this._genericSerializeByClass("wire")},_serializeButtons:function(){return this._genericSerializeByClass("wirehandle")},
_genericSerializeByClass:function(a){var b="[",c=0;$("."+a).each(function(){if(c>0)b+=",";b+=serializator._serialize(this.toSerialize());c+=1});b+="]";return b},_serialize:function(a){var b="",c=typeof a;if(c==="string")b="'"+a+"'";else if(c==="function")b="";else if(c==="number"||c==="boolean")b=a;else if(a instanceof Array){b+="[";for(c=0;c<a.length;c++){if(c>0)b+=",";b+=this._serialize(a[c])}b+="]"}else{b+="{";c=0;for(var d in a){if(c>0)b+=",";b+=d+":"+this._serialize(a[d]);c+=1}b+="}"}return b}};
deserializer={restricted_ids:{},deserialize:function(a){var b=ClassDeserializer;idManager.max_id_number=toInt(serialized_data.max_id_number);b.deserializeModels(a.models);b.deserializeViews(a.views);viewManager.redrawAll()}};createInitialOpts=function(a){a||(a={id:undefined,type:undefined});if(!a.id)a.id=undefined;if(!a.type)a.type=undefined;return a};
wdwObj=function(a){a=createInitialOpts(a);if(!a.id)a.id=idManager.getNewId();this.id=a.id;this.type=a.type;this.connections=new Earray;this.addConnection=function(b){this.connections.push(b)};this.removeConnection=function(b){for(var c=0;c<this.connections.length;c++)if(this.connections[c].connection_id===b)break;this.connections.removeAt(c)};if(a.initial){this.id=a.initial.id;this.type=a.initial.type}};
classObj=function(a){wdwObj.call(this,a);this.idxs={properties:0};this.attribs={};this.getParamValue=function(b){return this._getObjVal(this.attribs,b)};this.setClassAttrib=function(b,c){this._setClassParam(this.attribs,b,c)};this.addProperty=function(b,c,d){var e=this.idxs.properties;this.idxs.properties+=1;this.attribs.properties[e]={name:b,type:c,visibility:d}};this.deleteClassParam=function(){};this.deleteMethod=function(b){this.attribs.methods[b]!==undefined&&delete this.attribs.methods[b]};
this.toSerialize=function(){var b=[];this.connections.foreach(function(){b.push({id:this.id,type:this.type,stat:this.stat,connected:this.connected.id})});return{id:this.id,type:this.type,connections:b,attribs:this.attribs,idxs:this.idxs}};this._getObjVal=function(b,c){var d=c.indexOf(".");return d!==-1?this._getObjVal(b[c.substring(0,d)],c.substring(d+1)):b[c]};this._setClassParam=function(b,c,d){var e=c.indexOf(".");if(e!==-1){var g=c.substring(0,e);c=c.substring(e+1);this._setClassParam(b[g],c,
d)}else b[c]=d};if(a.initial){this.idxs=a.initial.idxs;this.attribs=a.initial.attribs}};classObj.prototype=new wdwObj({});InterfaceModel=function(a){a.type="interface";classObj.call(this,a);if(!a.initial){this.attribs.methods={};this.attribs.interfaceName=defaults.interfaceName}this.getTypeName=function(){return this.attribs.interfaceName}};InterfaceModel.prototype=new classObj({});
classModel=function(a){classObj.call(this,a);if(a.initial){this.idxs=a.initial.idxs;this.attribs=a.initial.attribs}else{this.attribs.className=defaults.className;this.attribs.properties={};this.attribs.methods={}}this.setClassName=function(b){this.attribs.className=b};this.getTypeName=function(){return this.attribs.className};this.deleteProperty=function(b){if(this.attribs.properties[b]!==undefined)delete this.attribs.properties[b];else dbg("deleteProperty: property with id: "+b+" isn't defined")}};
classModel.prototype=new classObj({});
ct=modelManager={models:new Earray,_baseTypes:new Earray,initialize:function(){this.models=new Earray;this._baseTypes=cs.getBaseTypes()},getTypes:function(){if(modelManager._baseTypes.length===0)modelManager._baseTypes=cs.getBaseTypes();var a=[];modelManager._baseTypes.foreach(function(){a.push({val:this.id,name:this.getTypeName()})});modelManager.models.foreach(function(){a.push({val:this.id,name:this.getTypeName()})});return a},getType:function(a){for(var b=this.getTypes(),c=0;c<b.length;c++){var d=
b[c];if(d.val===a)return d}return{val:"undefined",name:"type not defined"}},addModel:function(a){this.models.push(a);return a},createWindow:function(a){a=new wdwObj(a);this.models.push(a);return a},getWdwById:function(a){for(var b=0;b<this.models.length;b++)if(this.models[b].id===a)return this.models[b]},getModel:function(a){return this.getWdwById(a)},getObjectsByType:function(a){var b=[];this.models.foreach(function(){this.type===a&&b.push(this)});return b},deleteModel:function(a){for(var b=0;b<
this.models.length;b++)if(this.models[b].id===a)break;if(b===this.models.length-1)this.models.pop();else this.models[b]=this.models.pop()}};
tm={ttId:undefined,destroyToolTip:function(){dbg("in destroyToolTip");$(document.getElementById(this.ttId)).remove();wm.__marked_info.obj=undefined;document.onmousemove=undefined;wm.__marked_info.type="";this.ttId=undefined},movingTooltip:function(a,b,c,d){if(this.ttId)alert("tooltip already defined");else{a=wm.createWindow({top:a.pageY,left:a.pageX,width:130,height:60,moveable:false,notResizable:true,className:"add"});this.ttId=a.id;a.innerHTML=b;wm.__marked_info.obj=a;wm.__marked_info.diffX=c;wm.__marked_info.diffY=
d;wm.__marked_info.clicks=0;document.onmousemove=moveManager.moveMarked}}};tempIdGenerator={max_id_number:0,getNewId:function(){return 12}};
widgetGenerator={input:function(a,b){return'<input style="text" id="'+a+'" value="'+(b&&b||"")+'"/>'},textarea:function(a,b){return'<textarea id="'+a+'" value="'+(b&&b||"")+'" rows="5" cols="20"></textarea>'},radioSet:function(a,b,c){for(var d="",e=0;e<b.length;e++){var g=b[e],f="";if(c===g.val)f=' checked="true" ';d+='<input type="radio" name="'+a+'" value="'+g.val+'"'+f+"/>"+g.name+"<br/>"}return d},select:function(a,b,c){a='<select id="'+a+'">';for(var d=0;d<b.length;d++){var e=b[d],g="";if(c===
e.val)g=' selected="true" ';a+='<option value="'+e.val+'"'+g+">"+e.name+"</option>"}a+="</select>";return a},checkbox:function(a,b,c,d){d=d||"";return'<input class="'+d+'" type="checkbox" id="'+a+'"/>'+c},className:function(a){return this.genericWidgetGenerator("className",{className:a})},properties:function(a){return this.genericWidgetGenerator("properties",a)},methods:function(a){return this.genericWidgetGenerator("methods",a)},stateDescription:function(a){return this.genericWidgetGenerator("stateDescription",
{stateDescription:a})},condition:function(a){return this.genericWidgetGenerator("condition",{condition:a})},interfaceName:function(a){return this.genericWidgetGenerator("interfaceName",{interfaceName:a})},removeElementFromList:function(a){$("#"+a+" > .deleted:first").attr("checked","true");$("#"+a).hide()},elementsCounter:0,addElementTxt:function(a,b,c,d,e){var g=this.elementsCounter,f="el"+d+g,i=d+g+"deleted";c='<br/><div id="'+f+'" class="'+c+'">';c+=this.genericWidgetGenerator("",e,widgetDefinition[a][b].elements,
d+g);c+=this.checkbox(i,"","","deleted");c+=this.submitButton("widgetGenerator.removeElementFromList",genericgui.getParams(f),"delete");c+="</div>";this.elementsCounter+=1;return c},addElement:function(a,b,c,d,e,g){$("#"+c).append($(this.addElementTxt(a,b,d,e,g)));$("#"+c).find(".deleted").hide()},genericWidgetGenerator:function(a,b,c,d){var e="",g=widgetDefinition[a];if(c)g=c;d=d&&d||"";for(c=0;c<g.length;c++){var f=g[c],i=b&&b[f.id]||f.def;if(f.type==="input")e+="<span>"+f.description+"</span>"+
this.input(d+f.id,i);else if(f.type==="textarea")e+=f.description+this.textarea(d+f.id,i);else if(f.type==="radio"){var h=f.values;if(typeof h==="function")h=h();e+=f.description+"<br/>"+this.radioSet(d+f.name,h,i)}else if(f.type==="select"){h=f.values;if(typeof h==="function")h=h();e+=f.description+this.select(d+f.id,h,i)}else if(f.type==="list"){var j="id_div"+f.classSelector;e+=this.submitButton("widgetGenerator.addElement",genericgui.getParams(a,c,j,f.classSelector,f.id),"add element");e+=f.description+
"<br/>";h=i&&i.length||1;e+='<div id="'+j+'">';for(j=0;j<h;j++)e+=this.addElementTxt(a,c,f.classSelector,f.id,i&&i[j]||undefined);e+="</div>"}e+="<br/>"}return e},submitButton:function(a,b,c){var d="save";if(typeof c==="string")d=c;return'<input type="submit" value="'+d+'" onclick="'+a+"("+b+');"/>'},cancelButton:function(){return this.submitButton("genericgui.destroyEditAttribForm","","cancel")}};
widgetDefinition={className:[{type:"input",id:"className",description:"Class name: "}],properties:[{type:"input",id:"name",description:"Property name: "},{type:"select",id:"type",name:"type",description:"Property type: ",values:modelManager.getTypes},{type:"radio",id:"visibility",description:"Visibility: ",values:defaults.visSet,name:"visibility",def:defaults.propertyVisibility}],methods:[{type:"input",id:"name",description:"Method name: "},{type:"select",id:"type",name:"type",description:"Method type: ",
values:modelManager.getTypes},{type:"radio",id:"visibility",description:"Visibility: ",values:defaults.visSet,name:"visibility",def:defaults.propertyVisibility},{type:"list",id:"parameters",description:"Parameters: ",classSelector:"methodsparams",elements:[{type:"input",id:"name",description:"name"},{type:"select",id:"type",name:"type",description:"Parameter type: ",values:modelManager.getTypes}]}],stateDescription:[{type:"input",id:"stateDescription",description:"State description: "}],condition:[{type:"textarea",
id:"condition",description:"Condition: "}],interfaceName:[{type:"input",id:"interfaceName",description:"Interface name: "}],initialize:function(){this.properties[1].values=modelManager.getTypes()}};
valueReader={generic:function(a,b,c){var d=a.indexOf(".");if(d!==-1)a=a.substring(0,d);d={};a=widgetDefinition[a];if(b)a=b;c=c&&c||"";for(b=0;b<a.length;b++){var e=a[b].id;if(a[b].type==="input")d[e]=$("#"+c+e).val();else if(a[b].type==="textarea")d[e]=$("#"+c+e).val();else if(a[b].type==="radio")d[e]=$("input[name="+c+a[b].name+"]:checked").val();else if(a[b].type==="select")d[e]=$("#"+c+e).val();else if(a[b].type==="list"){d[e]=[];for(var g=widgetGenerator.elementsCounter,f=0,i=0;i<g;i++)if(!$("#"+
("el"+e+i)+"> .deleted:first").attr("checked")){d[e][f]=valueReader.generic("",a[b].elements,e+i);f+=1}}}widgetGenerator.elementsCounter=0;return d},noObjectValues:["className","stateDescription","condition","interfaceName"]};
viewManager={views:{},connections:{},redrawViews:function(a){this.applyForViews(a,function(b){b.redraw()})},addView:function(a,b){var c=false;for(var d in this.views)if(d===a)c=true;c||(this.views[a]=[]);this.views[a].push(b)},applyForViews:function(a,b){for(var c=0;c<this.views[a].length;c++)b(this.views[a][c])},getView:function(a){for(key in this.views)for(var b=0;b<this.views[key].length;b++)if(this.views[key][b].id===a)return this.views[key][b]},getViewsForModel:function(a){return this.views[a]},
addConnection:function(a){this.connections[a.connection_id]=a},removeConnection:function(a){var b=this.connections[a];b.parentLogic.removeConnectionById(b.connection_id);(b.first?b.lastButton():b.firstButton()).parentLogic.removeConnectionById(b.connection_id);this.delete_wire(b);delete this.connections[a]},delete_wire:function(a){a=a.firstButton();for(var b=new Earray;!a.last;){b.push(a.conn.one.wire);a.label&&$(a.label).remove();a=a.nextBtn}b.push(a.conn.one.wire);b.foreach(function(){$(this).remove()})},
deleteModel:function(a){this.applyForViews(a,function(b){for(var c=b.connections.length,d=new Earray,e=0;e<c;e++)d.push(b.connections[e].id);d.foreach(function(){viewManager.removeConnection(this)});delete b.connections;$(b).remove()});delete this.views[a]},redrawAll:function(){for(var a in this.connections)this.connections[a].redraw();for(a in this.views)for(var b=this.views[a],c=0;c<b.length;c++)b[c].redraw()}};
StateModel=function(a){classObj.call(this,a);if(!a.initial)this.attribs.stateDescription=defaults.stateDescription};StateModel.prototype=new classObj({});ConditionalModel=function(a){classObj.call(this,a);if(!a.initial)this.attribs.conditions=defaults.condition};ConditionalModel.prototype=new classObj({});
makeMoveable=function(a,b){a.updatePos=function(c){return function(d,e){return c.updatePos.call(this,d,e)}}(b);a.getBoundingBox=function(c){return function(){return c.getBoundingBox.call(this)}}(b);if(!a.style.left)a.style.left=0;if(!a.style.top)a.style.top=0;a.style.position="absolute"};
createImageView=function(a){a.width=a.width||defaults.asmViewWidth;a.height=a.height||defaults.asmViewHeight;var b=createBaseView(a);b.baseToSerialize=b.toSerialize;b.bgImage="/site_media/"+a.bgImage;$(b.options).remove();$(b.content).remove();b.realContent=genericgui.createNewDiv();b.realContent.style.position="absolute";b.realContent.style.left=b.realContent.style.top=0;$(b).append($('<img src="'+b.bgImage+'"/>'));b.appendChild(b.realContent);var c=genericgui.createNewDiv();buttonMaker.createMovingBtn(c,
5);makeMoveable(c,b);b.realContent.appendChild(c);$(b).find("div:not(.movingDiv):not(.value)").each(function(){this.className=""});$(b).find("hr").remove();$(b).removeClass("orange");b.origClass="";$(b).find(".movingDiv").removeClass("movingDiv").mouseover(function(){this.className="movingDiv"}).mouseout(function(){this.className=""});b.divs={holder:c};b.afterResize=function(){var d=this.divs.holder;d.style.top=toInt(b.style.height)/3;d.style.left=toInt(b.style.width)/3;$(b).find("img:first").css({width:b.style.width,
height:b.style.height,top:"0px",left:"0px"});this.redraw&&this.redraw()};b.drawBackground=function(){};b.toSerialize=function(){var d=this.baseToSerialize.call(this);d.holder=baseToSerialize(this.divs.holder);return d};if(a.initial){a=a.initial.holder;b.divs.holder.style.top=a.top;b.divs.holder.style.left=a.left}b.getOptions=function(){return $("<div>").append($(widgetGenerator.submitButton("controller.deleteModel",genericgui.getParams(this._modelId),"delete"))).append("<br/>").append(buttonMaker.createConnectBtn(this.id,
"connect",wm.connectAsm))};b.afterResize();return b};createStateView=function(a){a.type="state";a.bgImage="state.gif";var b=createImageView(a);a=genericgui.createEditablePropDiv({par:b,cssClass:"stateDiv",value:"state value",desc:""},"stateDescription");b.divs.holder.appendChild(a);b.redraw=function(){b.drawBackground();var c=modelManager.getModel(this._modelId);$(this).find(".stateDiv:first").children(".value:first").text(c.attribs.stateDescription)};return b};
createConditionalView=function(a){a.type="conditional";a.bgImage="condition.gif";var b=createImageView(a);a=genericgui.createEditablePropDiv({par:b,cssClass:"conditionDiv",value:"condition",desc:"",btnText:"Edit contidion"},"condition");b.divs.holder.appendChild(a);b.redraw=function(){b.drawBackground();var c=modelManager.getModel(this._modelId);$(this).find(".conditionDiv:first").children(".value:first").text(c.attribs.condition)};return b};
asmFactory={creator:{model:{createState:function(a){a=a||idManager.getNewId();return new StateModel({id:a,type:"state"})},createConditional:function(a){a=a||idManager.getNewId();return new ConditionalModel({id:a,type:"conditional"})}},view:{createState:function(a){a.width=a.height=100;return createStateView(a)},createConditional:function(a){a.width=a.height=100;return createConditionalView(a)}}},serializator:{serialize:function(){}},deserializator:{model:{createState:function(a){return new StateModel({initial:a,
id:a.id})},createConditional:function(a){return new ConditionalModel({initial:a,id:a.id})}},view:{create_state:function(a){return factory.creator.view.createState({initial:a,model:a.model,id:a.id})},create_conditional:function(a){return factory.creator.view.createConditional({initial:a,model:a.model,id:a.id})}}},gui:{createGui:function(a){var b=factory.gui.methods,c=BaseGui.createInput;$(c("Add new state")).click(b.newState).appendTo(a);$(c("Add new conditional")).click(b.newConditional).appendTo(a)},
methods:{changeState:function(){},defaultViewPos:{top:100,left:100,moveable:true},newState:function(){controller.createNewState(asmFactory.gui.methods.defaultViewPos)},newConditional:function(){controller.createNewConditional(asmFactory.gui.methods.defaultViewPos)}}}};
